/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var _s=Object.create;var St=Object.defineProperty;var $s=Object.getOwnPropertyDescriptor;var Us=Object.getOwnPropertyNames;var Bs=Object.getPrototypeOf,Vs=Object.prototype.hasOwnProperty;var R=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports),js=(c,e)=>{for(var t in e)St(c,t,{get:e[t],enumerable:!0})},Dr=(c,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Us(e))!Vs.call(c,i)&&i!==t&&St(c,i,{get:()=>e[i],enumerable:!(r=$s(e,i))||r.enumerable});return c};var Ir=(c,e,t)=>(t=c!=null?_s(Bs(c)):{},Dr(e||!c||!c.__esModule?St(t,"default",{value:c,enumerable:!0}):t,c)),Hs=c=>Dr(St({},"__esModule",{value:!0}),c);var Ct=R(ir=>{(function(){ir.defaults={"0.1":{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},"0.2":{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:`
`},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(ir)});var pe=R((Or,Ce)=>{(function(){var c,e,t,r,i,s,a,n=[].slice,l={}.hasOwnProperty;c=function(){var u,g,f,m,y,P;if(P=arguments[0],y=2<=arguments.length?n.call(arguments,1):[],i(Object.assign))Object.assign.apply(null,arguments);else for(u=0,f=y.length;u<f;u++)if(m=y[u],m!=null)for(g in m)l.call(m,g)&&(P[g]=m[g]);return P},i=function(u){return!!u&&Object.prototype.toString.call(u)==="[object Function]"},s=function(u){var g;return!!u&&((g=typeof u)=="function"||g==="object")},t=function(u){return i(Array.isArray)?Array.isArray(u):Object.prototype.toString.call(u)==="[object Array]"},r=function(u){var g;if(t(u))return!u.length;for(g in u)if(l.call(u,g))return!1;return!0},a=function(u){var g,f;return s(u)&&(f=Object.getPrototypeOf(u))&&(g=f.constructor)&&typeof g=="function"&&g instanceof g&&Function.prototype.toString.call(g)===Function.prototype.toString.call(Object)},e=function(u){return i(u.valueOf)?u.valueOf():u},Ce.exports.assign=c,Ce.exports.isFunction=i,Ce.exports.isObject=s,Ce.exports.isArray=t,Ce.exports.isEmpty=r,Ce.exports.isPlainObject=a,Ce.exports.getValue=e}).call(Or)});var sr=R((Rr,Qr)=>{(function(){var c;Qr.exports=c=function(){function e(){}return e.prototype.hasFeature=function(t,r){return!0},e.prototype.createDocumentType=function(t,r,i){throw new Error("This DOM method is not implemented.")},e.prototype.createDocument=function(t,r,i){throw new Error("This DOM method is not implemented.")},e.prototype.createHTMLDocument=function(t){throw new Error("This DOM method is not implemented.")},e.prototype.getFeature=function(t,r){throw new Error("This DOM method is not implemented.")},e}()}).call(Rr)});var Ur=R((_r,$r)=>{(function(){var c;$r.exports=c=function(){function e(){}return e.prototype.handleError=function(t){throw new Error(t)},e}()}).call(_r)});var jr=R((Br,Vr)=>{(function(){var c;Vr.exports=c=function(){function e(t){this.arr=t||[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.arr.length}}),e.prototype.item=function(t){return this.arr[t]||null},e.prototype.contains=function(t){return this.arr.indexOf(t)!==-1},e}()}).call(Br)});var Wr=R((Hr,Xr)=>{(function(){var c,e,t;e=Ur(),t=jr(),Xr.exports=c=function(){function r(){var i;this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new e,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=i=Object.create(this.defaultParams)}return Object.defineProperty(r.prototype,"parameterNames",{get:function(){return new t(Object.keys(this.defaultParams))}}),r.prototype.getParameter=function(i){return this.params.hasOwnProperty(i)?this.params[i]:null},r.prototype.canSetParameter=function(i,s){return!0},r.prototype.setParameter=function(i,s){return s!=null?this.params[i]=s:delete this.params[i]},r}()}).call(Hr)});var W=R((Gr,zr)=>{(function(){zr.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(Gr)});var ar=R((Yr,Kr)=>{(function(){var c,e,t;c=W(),t=oe(),Kr.exports=e=function(){function r(i,s,a){if(this.parent=i,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),s==null)throw new Error("Missing attribute name. "+this.debugInfo(s));this.name=this.stringify.name(s),this.value=this.stringify.attValue(a),this.type=c.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(r.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(r.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(r.prototype,"textContent",{get:function(){return this.value},set:function(i){return this.value=i||""}}),Object.defineProperty(r.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(r.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(r.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(r.prototype,"specified",{get:function(){return!0}}),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(i){return this.options.writer.attribute(this,this.options.writer.filterOptions(i))},r.prototype.debugInfo=function(i){return i=i||this.name,i==null?"parent: <"+this.parent.name+">":"attribute: {"+i+"}, parent: <"+this.parent.name+">"},r.prototype.isEqualNode=function(i){return!(i.namespaceURI!==this.namespaceURI||i.prefix!==this.prefix||i.localName!==this.localName||i.value!==this.value)},r}()}).call(Yr)});var Mt=R((Jr,Zr)=>{(function(){var c;Zr.exports=c=function(){function e(t){this.nodes=t}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.getNamedItem=function(t){return this.nodes[t]},e.prototype.setNamedItem=function(t){var r;return r=this.nodes[t.nodeName],this.nodes[t.nodeName]=t,r||null},e.prototype.removeNamedItem=function(t){var r;return r=this.nodes[t],delete this.nodes[t],r||null},e.prototype.item=function(t){return this.nodes[Object.keys(this.nodes)[t]]||null},e.prototype.getNamedItemNS=function(t,r){throw new Error("This DOM method is not implemented.")},e.prototype.setNamedItemNS=function(t){throw new Error("This DOM method is not implemented.")},e.prototype.removeNamedItemNS=function(t,r){throw new Error("This DOM method is not implemented.")},e}()}).call(Jr)});var At=R((ei,ti)=>{(function(){var c,e,t,r,i,s,a,n,l,u=function(f,m){for(var y in m)g.call(m,y)&&(f[y]=m[y]);function P(){this.constructor=f}return P.prototype=m.prototype,f.prototype=new P,f.__super__=m.prototype,f},g={}.hasOwnProperty;l=pe(),n=l.isObject,a=l.isFunction,s=l.getValue,i=oe(),c=W(),e=ar(),r=Mt(),ti.exports=t=function(f){u(m,f);function m(y,P,I){var A,T,k,w;if(m.__super__.constructor.call(this,y),P==null)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(P),this.type=c.Element,this.attribs={},this.schemaTypeInfo=null,I!=null&&this.attribute(I),y.type===c.Document&&(this.isRoot=!0,this.documentObject=y,y.rootObject=this,y.children)){for(w=y.children,T=0,k=w.length;T<k;T++)if(A=w[T],A.type===c.DocType){A.name=this.name;break}}}return Object.defineProperty(m.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(m.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(m.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(m.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(m.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(m.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(m.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(m.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new r(this.attribs)),this.attributeMap}}),m.prototype.clone=function(){var y,P,I,A;I=Object.create(this),I.isRoot&&(I.documentObject=null),I.attribs={},A=this.attribs;for(P in A)g.call(A,P)&&(y=A[P],I.attribs[P]=y.clone());return I.children=[],this.children.forEach(function(T){var k;return k=T.clone(),k.parent=I,I.children.push(k)}),I},m.prototype.attribute=function(y,P){var I,A;if(y!=null&&(y=s(y)),n(y))for(I in y)g.call(y,I)&&(A=y[I],this.attribute(I,A));else a(P)&&(P=P.apply()),this.options.keepNullAttributes&&P==null?this.attribs[y]=new e(this,y,""):P!=null&&(this.attribs[y]=new e(this,y,P));return this},m.prototype.removeAttribute=function(y){var P,I,A;if(y==null)throw new Error("Missing attribute name. "+this.debugInfo());if(y=s(y),Array.isArray(y))for(I=0,A=y.length;I<A;I++)P=y[I],delete this.attribs[P];else delete this.attribs[y];return this},m.prototype.toString=function(y){return this.options.writer.element(this,this.options.writer.filterOptions(y))},m.prototype.att=function(y,P){return this.attribute(y,P)},m.prototype.a=function(y,P){return this.attribute(y,P)},m.prototype.getAttribute=function(y){return this.attribs.hasOwnProperty(y)?this.attribs[y].value:null},m.prototype.setAttribute=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getAttributeNode=function(y){return this.attribs.hasOwnProperty(y)?this.attribs[y]:null},m.prototype.setAttributeNode=function(y){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.removeAttributeNode=function(y){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagName=function(y){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getAttributeNS=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setAttributeNS=function(y,P,I){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.removeAttributeNS=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getAttributeNodeNS=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setAttributeNodeNS=function(y){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagNameNS=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.hasAttribute=function(y){return this.attribs.hasOwnProperty(y)},m.prototype.hasAttributeNS=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setIdAttribute=function(y,P){return this.attribs.hasOwnProperty(y)?this.attribs[y].isId:P},m.prototype.setIdAttributeNS=function(y,P,I){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setIdAttributeNode=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagName=function(y){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagNameNS=function(y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByClassName=function(y){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.isEqualNode=function(y){var P,I,A;if(!m.__super__.isEqualNode.apply(this,arguments).isEqualNode(y)||y.namespaceURI!==this.namespaceURI||y.prefix!==this.prefix||y.localName!==this.localName||y.attribs.length!==this.attribs.length)return!1;for(P=I=0,A=this.attribs.length-1;0<=A?I<=A:I>=A;P=0<=A?++I:--I)if(!this.attribs[P].isEqualNode(y.attribs[P]))return!1;return!0},m}(i)}).call(ei)});var dt=R((ri,ii)=>{(function(){var c,e,t=function(i,s){for(var a in s)r.call(s,a)&&(i[a]=s[a]);function n(){this.constructor=i}return n.prototype=s.prototype,i.prototype=new n,i.__super__=s.prototype,i},r={}.hasOwnProperty;e=oe(),ii.exports=c=function(i){t(s,i);function s(a){s.__super__.constructor.call(this,a),this.value=""}return Object.defineProperty(s.prototype,"data",{get:function(){return this.value},set:function(a){return this.value=a||""}}),Object.defineProperty(s.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(s.prototype,"textContent",{get:function(){return this.value},set:function(a){return this.value=a||""}}),s.prototype.clone=function(){return Object.create(this)},s.prototype.substringData=function(a,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.appendData=function(a){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.insertData=function(a,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.deleteData=function(a,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.replaceData=function(a,n,l){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.isEqualNode=function(a){return!(!s.__super__.isEqualNode.apply(this,arguments).isEqualNode(a)||a.data!==this.data)},s}(e)}).call(ri)});var Lt=R((si,ai)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;c=W(),t=dt(),ai.exports=e=function(s){r(a,s);function a(n,l){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=c.CData,this.value=this.stringify.cdata(l)}return a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(n){return this.options.writer.cdata(this,this.options.writer.filterOptions(n))},a}(t)}).call(si)});var Nt=R((oi,ni)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;c=W(),e=dt(),ni.exports=t=function(s){r(a,s);function a(n,l){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=c.Comment,this.value=this.stringify.comment(l)}return a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(n){return this.options.writer.comment(this,this.options.writer.filterOptions(n))},a}(e)}).call(oi)});var kt=R((li,ci)=>{(function(){var c,e,t,r,i=function(a,n){for(var l in n)s.call(n,l)&&(a[l]=n[l]);function u(){this.constructor=a}return u.prototype=n.prototype,a.prototype=new u,a.__super__=n.prototype,a},s={}.hasOwnProperty;r=pe().isObject,t=oe(),c=W(),ci.exports=e=function(a){i(n,a);function n(l,u,g,f){var m;n.__super__.constructor.call(this,l),r(u)&&(m=u,u=m.version,g=m.encoding,f=m.standalone),u||(u="1.0"),this.type=c.Declaration,this.version=this.stringify.xmlVersion(u),g!=null&&(this.encoding=this.stringify.xmlEncoding(g)),f!=null&&(this.standalone=this.stringify.xmlStandalone(f))}return n.prototype.toString=function(l){return this.options.writer.declaration(this,this.options.writer.filterOptions(l))},n}(t)}).call(li)});var Ft=R((ui,di)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;t=oe(),c=W(),di.exports=e=function(s){r(a,s);function a(n,l,u,g,f,m){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing DTD element name. "+this.debugInfo());if(u==null)throw new Error("Missing DTD attribute name. "+this.debugInfo(l));if(!g)throw new Error("Missing DTD attribute type. "+this.debugInfo(l));if(!f)throw new Error("Missing DTD attribute default. "+this.debugInfo(l));if(f.indexOf("#")!==0&&(f="#"+f),!f.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(l));if(m&&!f.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(l));this.elementName=this.stringify.name(l),this.type=c.AttributeDeclaration,this.attributeName=this.stringify.name(u),this.attributeType=this.stringify.dtdAttType(g),m&&(this.defaultValue=this.stringify.dtdAttDefault(m)),this.defaultValueType=f}return a.prototype.toString=function(n){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(n))},a}(t)}).call(ui)});var qt=R((pi,hi)=>{(function(){var c,e,t,r,i=function(a,n){for(var l in n)s.call(n,l)&&(a[l]=n[l]);function u(){this.constructor=a}return u.prototype=n.prototype,a.prototype=new u,a.__super__=n.prototype,a},s={}.hasOwnProperty;r=pe().isObject,t=oe(),c=W(),hi.exports=e=function(a){i(n,a);function n(l,u,g,f){if(n.__super__.constructor.call(this,l),g==null)throw new Error("Missing DTD entity name. "+this.debugInfo(g));if(f==null)throw new Error("Missing DTD entity value. "+this.debugInfo(g));if(this.pe=!!u,this.name=this.stringify.name(g),this.type=c.EntityDeclaration,!r(f))this.value=this.stringify.dtdEntityValue(f),this.internal=!0;else{if(!f.pubID&&!f.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(g));if(f.pubID&&!f.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(g));if(this.internal=!1,f.pubID!=null&&(this.pubID=this.stringify.dtdPubID(f.pubID)),f.sysID!=null&&(this.sysID=this.stringify.dtdSysID(f.sysID)),f.nData!=null&&(this.nData=this.stringify.dtdNData(f.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(g))}}return Object.defineProperty(n.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(n.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(n.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(n.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"xmlVersion",{get:function(){return null}}),n.prototype.toString=function(l){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(l))},n}(t)}).call(pi)});var Ot=R((gi,mi)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;t=oe(),c=W(),mi.exports=e=function(s){r(a,s);function a(n,l,u){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing DTD element name. "+this.debugInfo());u||(u="(#PCDATA)"),Array.isArray(u)&&(u="("+u.join(",")+")"),this.name=this.stringify.name(l),this.type=c.ElementDeclaration,this.value=this.stringify.dtdElementValue(u)}return a.prototype.toString=function(n){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(n))},a}(t)}).call(gi)});var Rt=R((fi,yi)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;t=oe(),c=W(),yi.exports=e=function(s){r(a,s);function a(n,l,u){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing DTD notation name. "+this.debugInfo(l));if(!u.pubID&&!u.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(l));this.name=this.stringify.name(l),this.type=c.NotationDeclaration,u.pubID!=null&&(this.pubID=this.stringify.dtdPubID(u.pubID)),u.sysID!=null&&(this.sysID=this.stringify.dtdSysID(u.sysID))}return Object.defineProperty(a.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(a.prototype,"systemId",{get:function(){return this.sysID}}),a.prototype.toString=function(n){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(n))},a}(t)}).call(fi)});var Qt=R((Ei,Pi)=>{(function(){var c,e,t,r,i,s,a,n,l,u=function(f,m){for(var y in m)g.call(m,y)&&(f[y]=m[y]);function P(){this.constructor=f}return P.prototype=m.prototype,f.prototype=new P,f.__super__=m.prototype,f},g={}.hasOwnProperty;l=pe().isObject,n=oe(),c=W(),e=Ft(),r=qt(),t=Ot(),i=Rt(),a=Mt(),Pi.exports=s=function(f){u(m,f);function m(y,P,I){var A,T,k,w,h,p;if(m.__super__.constructor.call(this,y),this.type=c.DocType,y.children){for(w=y.children,T=0,k=w.length;T<k;T++)if(A=w[T],A.type===c.Element){this.name=A.name;break}}this.documentObject=y,l(P)&&(h=P,P=h.pubID,I=h.sysID),I==null&&(p=[P,I],I=p[0],P=p[1]),P!=null&&(this.pubID=this.stringify.dtdPubID(P)),I!=null&&(this.sysID=this.stringify.dtdSysID(I))}return Object.defineProperty(m.prototype,"entities",{get:function(){var y,P,I,A,T;for(A={},T=this.children,P=0,I=T.length;P<I;P++)y=T[P],y.type===c.EntityDeclaration&&!y.pe&&(A[y.name]=y);return new a(A)}}),Object.defineProperty(m.prototype,"notations",{get:function(){var y,P,I,A,T;for(A={},T=this.children,P=0,I=T.length;P<I;P++)y=T[P],y.type===c.NotationDeclaration&&(A[y.name]=y);return new a(A)}}),Object.defineProperty(m.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(m.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(m.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),m.prototype.element=function(y,P){var I;return I=new t(this,y,P),this.children.push(I),this},m.prototype.attList=function(y,P,I,A,T){var k;return k=new e(this,y,P,I,A,T),this.children.push(k),this},m.prototype.entity=function(y,P){var I;return I=new r(this,!1,y,P),this.children.push(I),this},m.prototype.pEntity=function(y,P){var I;return I=new r(this,!0,y,P),this.children.push(I),this},m.prototype.notation=function(y,P){var I;return I=new i(this,y,P),this.children.push(I),this},m.prototype.toString=function(y){return this.options.writer.docType(this,this.options.writer.filterOptions(y))},m.prototype.ele=function(y,P){return this.element(y,P)},m.prototype.att=function(y,P,I,A,T){return this.attList(y,P,I,A,T)},m.prototype.ent=function(y,P){return this.entity(y,P)},m.prototype.pent=function(y,P){return this.pEntity(y,P)},m.prototype.not=function(y,P){return this.notation(y,P)},m.prototype.up=function(){return this.root()||this.documentObject},m.prototype.isEqualNode=function(y){return!(!m.__super__.isEqualNode.apply(this,arguments).isEqualNode(y)||y.name!==this.name||y.publicId!==this.publicId||y.systemId!==this.systemId)},m}(n)}).call(Ei)});var _t=R((wi,vi)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;c=W(),e=oe(),vi.exports=t=function(s){r(a,s);function a(n,l){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing raw text. "+this.debugInfo());this.type=c.Raw,this.value=this.stringify.raw(l)}return a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(n){return this.options.writer.raw(this,this.options.writer.filterOptions(n))},a}(e)}).call(wi)});var $t=R((bi,Si)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;c=W(),e=dt(),Si.exports=t=function(s){r(a,s);function a(n,l){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=c.Text,this.value=this.stringify.text(l)}return Object.defineProperty(a.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(a.prototype,"wholeText",{get:function(){var n,l,u;for(u="",l=this.previousSibling;l;)u=l.data+u,l=l.previousSibling;for(u+=this.data,n=this.nextSibling;n;)u=u+n.data,n=n.nextSibling;return u}}),a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(n){return this.options.writer.text(this,this.options.writer.filterOptions(n))},a.prototype.splitText=function(n){throw new Error("This DOM method is not implemented."+this.debugInfo())},a.prototype.replaceWholeText=function(n){throw new Error("This DOM method is not implemented."+this.debugInfo())},a}(e)}).call(bi)});var Ut=R((xi,Ti)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;c=W(),e=dt(),Ti.exports=t=function(s){r(a,s);function a(n,l,u){if(a.__super__.constructor.call(this,n),l==null)throw new Error("Missing instruction target. "+this.debugInfo());this.type=c.ProcessingInstruction,this.target=this.stringify.insTarget(l),this.name=this.target,u&&(this.value=this.stringify.insValue(u))}return a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(n){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(n))},a.prototype.isEqualNode=function(n){return!(!a.__super__.isEqualNode.apply(this,arguments).isEqualNode(n)||n.target!==this.target)},a}(e)}).call(xi)});var or=R((Di,Ii)=>{(function(){var c,e,t,r=function(s,a){for(var n in a)i.call(a,n)&&(s[n]=a[n]);function l(){this.constructor=s}return l.prototype=a.prototype,s.prototype=new l,s.__super__=a.prototype,s},i={}.hasOwnProperty;t=oe(),c=W(),Ii.exports=e=function(s){r(a,s);function a(n){a.__super__.constructor.call(this,n),this.type=c.Dummy}return a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(n){return""},a}(t)}).call(Di)});var Ai=R((Ci,Mi)=>{(function(){var c;Mi.exports=c=function(){function e(t){this.nodes=t}return Object.defineProperty(e.prototype,"length",{get:function(){return this.nodes.length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.item=function(t){return this.nodes[t]||null},e}()}).call(Ci)});var ki=R((Li,Ni)=>{(function(){Ni.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(Li)});var oe=R((Fi,qi)=>{(function(){var c,e,t,r,i,s,a,n,l,u,g,f,m,y,P,I,A,T,k,w={}.hasOwnProperty;k=pe(),T=k.isObject,A=k.isFunction,I=k.isEmpty,P=k.getValue,n=null,t=null,r=null,i=null,s=null,m=null,y=null,f=null,a=null,e=null,g=null,l=null,c=null,qi.exports=u=function(){function h(p){this.parent=p,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,n||(n=At(),t=Lt(),r=Nt(),i=kt(),s=Qt(),m=_t(),y=$t(),f=Ut(),a=or(),e=W(),g=Ai(),l=Mt(),c=ki())}return Object.defineProperty(h.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(h.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(h.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(h.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(h.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new g(this.children)),this.childNodeList}}),Object.defineProperty(h.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(h.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(h.prototype,"previousSibling",{get:function(){var p;return p=this.parent.children.indexOf(this),this.parent.children[p-1]||null}}),Object.defineProperty(h.prototype,"nextSibling",{get:function(){var p;return p=this.parent.children.indexOf(this),this.parent.children[p+1]||null}}),Object.defineProperty(h.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(h.prototype,"textContent",{get:function(){var p,b,x,v,M;if(this.nodeType===e.Element||this.nodeType===e.DocumentFragment){for(M="",v=this.children,b=0,x=v.length;b<x;b++)p=v[b],p.textContent&&(M+=p.textContent);return M}else return null},set:function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),h.prototype.setParent=function(p){var b,x,v,M,S;for(this.parent=p,p&&(this.options=p.options,this.stringify=p.stringify),M=this.children,S=[],x=0,v=M.length;x<v;x++)b=M[x],S.push(b.setParent(this));return S},h.prototype.element=function(p,b,x){var v,M,S,C,N,q,Q,B,O,z,U;if(q=null,b===null&&x==null&&(O=[{},null],b=O[0],x=O[1]),b==null&&(b={}),b=P(b),T(b)||(z=[b,x],x=z[0],b=z[1]),p!=null&&(p=P(p)),Array.isArray(p))for(S=0,Q=p.length;S<Q;S++)M=p[S],q=this.element(M);else if(A(p))q=this.element(p.apply());else if(T(p)){for(N in p)if(w.call(p,N))if(U=p[N],A(U)&&(U=U.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&N.indexOf(this.stringify.convertAttKey)===0)q=this.attribute(N.substr(this.stringify.convertAttKey.length),U);else if(!this.options.separateArrayItems&&Array.isArray(U)&&I(U))q=this.dummy();else if(T(U)&&I(U))q=this.element(N);else if(!this.options.keepNullNodes&&U==null)q=this.dummy();else if(!this.options.separateArrayItems&&Array.isArray(U))for(C=0,B=U.length;C<B;C++)M=U[C],v={},v[N]=M,q=this.element(v);else T(U)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&N.indexOf(this.stringify.convertTextKey)===0?q=this.element(U):(q=this.element(N),q.element(U)):q=this.element(N,U)}else!this.options.keepNullNodes&&x===null?q=this.dummy():!this.options.ignoreDecorators&&this.stringify.convertTextKey&&p.indexOf(this.stringify.convertTextKey)===0?q=this.text(x):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&p.indexOf(this.stringify.convertCDataKey)===0?q=this.cdata(x):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&p.indexOf(this.stringify.convertCommentKey)===0?q=this.comment(x):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&p.indexOf(this.stringify.convertRawKey)===0?q=this.raw(x):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&p.indexOf(this.stringify.convertPIKey)===0?q=this.instruction(p.substr(this.stringify.convertPIKey.length),x):q=this.node(p,b,x);if(q==null)throw new Error("Could not create any elements with: "+p+". "+this.debugInfo());return q},h.prototype.insertBefore=function(p,b,x){var v,M,S,C,N;if(p!=null&&p.type)return S=p,C=b,S.setParent(this),C?(M=children.indexOf(C),N=children.splice(M),children.push(S),Array.prototype.push.apply(children,N)):children.push(S),S;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(p));return M=this.parent.children.indexOf(this),N=this.parent.children.splice(M),v=this.parent.element(p,b,x),Array.prototype.push.apply(this.parent.children,N),v},h.prototype.insertAfter=function(p,b,x){var v,M,S;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(p));return M=this.parent.children.indexOf(this),S=this.parent.children.splice(M+1),v=this.parent.element(p,b,x),Array.prototype.push.apply(this.parent.children,S),v},h.prototype.remove=function(){var p,b;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return p=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[p,p-p+1].concat(b=[])),this.parent},h.prototype.node=function(p,b,x){var v,M;return p!=null&&(p=P(p)),b||(b={}),b=P(b),T(b)||(M=[b,x],x=M[0],b=M[1]),v=new n(this,p,b),x!=null&&v.text(x),this.children.push(v),v},h.prototype.text=function(p){var b;return T(p)&&this.element(p),b=new y(this,p),this.children.push(b),this},h.prototype.cdata=function(p){var b;return b=new t(this,p),this.children.push(b),this},h.prototype.comment=function(p){var b;return b=new r(this,p),this.children.push(b),this},h.prototype.commentBefore=function(p){var b,x,v;return x=this.parent.children.indexOf(this),v=this.parent.children.splice(x),b=this.parent.comment(p),Array.prototype.push.apply(this.parent.children,v),this},h.prototype.commentAfter=function(p){var b,x,v;return x=this.parent.children.indexOf(this),v=this.parent.children.splice(x+1),b=this.parent.comment(p),Array.prototype.push.apply(this.parent.children,v),this},h.prototype.raw=function(p){var b;return b=new m(this,p),this.children.push(b),this},h.prototype.dummy=function(){var p;return p=new a(this),p},h.prototype.instruction=function(p,b){var x,v,M,S,C;if(p!=null&&(p=P(p)),b!=null&&(b=P(b)),Array.isArray(p))for(S=0,C=p.length;S<C;S++)x=p[S],this.instruction(x);else if(T(p))for(x in p)w.call(p,x)&&(v=p[x],this.instruction(x,v));else A(b)&&(b=b.apply()),M=new f(this,p,b),this.children.push(M);return this},h.prototype.instructionBefore=function(p,b){var x,v,M;return v=this.parent.children.indexOf(this),M=this.parent.children.splice(v),x=this.parent.instruction(p,b),Array.prototype.push.apply(this.parent.children,M),this},h.prototype.instructionAfter=function(p,b){var x,v,M;return v=this.parent.children.indexOf(this),M=this.parent.children.splice(v+1),x=this.parent.instruction(p,b),Array.prototype.push.apply(this.parent.children,M),this},h.prototype.declaration=function(p,b,x){var v,M;return v=this.document(),M=new i(v,p,b,x),v.children.length===0?v.children.unshift(M):v.children[0].type===e.Declaration?v.children[0]=M:v.children.unshift(M),v.root()||v},h.prototype.dtd=function(p,b){var x,v,M,S,C,N,q,Q,B,O;for(v=this.document(),M=new s(v,p,b),B=v.children,S=C=0,q=B.length;C<q;S=++C)if(x=B[S],x.type===e.DocType)return v.children[S]=M,M;for(O=v.children,S=N=0,Q=O.length;N<Q;S=++N)if(x=O[S],x.isRoot)return v.children.splice(S,0,M),M;return v.children.push(M),M},h.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},h.prototype.root=function(){var p;for(p=this;p;){if(p.type===e.Document)return p.rootObject;if(p.isRoot)return p;p=p.parent}},h.prototype.document=function(){var p;for(p=this;p;){if(p.type===e.Document)return p;p=p.parent}},h.prototype.end=function(p){return this.document().end(p)},h.prototype.prev=function(){var p;if(p=this.parent.children.indexOf(this),p<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[p-1]},h.prototype.next=function(){var p;if(p=this.parent.children.indexOf(this),p===-1||p===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[p+1]},h.prototype.importDocument=function(p){var b;return b=p.root().clone(),b.parent=this,b.isRoot=!1,this.children.push(b),this},h.prototype.debugInfo=function(p){var b,x;return p=p||this.name,p==null&&!((b=this.parent)!=null&&b.name)?"":p==null?"parent: <"+this.parent.name+">":(x=this.parent)!=null&&x.name?"node: <"+p+">, parent: <"+this.parent.name+">":"node: <"+p+">"},h.prototype.ele=function(p,b,x){return this.element(p,b,x)},h.prototype.nod=function(p,b,x){return this.node(p,b,x)},h.prototype.txt=function(p){return this.text(p)},h.prototype.dat=function(p){return this.cdata(p)},h.prototype.com=function(p){return this.comment(p)},h.prototype.ins=function(p,b){return this.instruction(p,b)},h.prototype.doc=function(){return this.document()},h.prototype.dec=function(p,b,x){return this.declaration(p,b,x)},h.prototype.e=function(p,b,x){return this.element(p,b,x)},h.prototype.n=function(p,b,x){return this.node(p,b,x)},h.prototype.t=function(p){return this.text(p)},h.prototype.d=function(p){return this.cdata(p)},h.prototype.c=function(p){return this.comment(p)},h.prototype.r=function(p){return this.raw(p)},h.prototype.i=function(p,b){return this.instruction(p,b)},h.prototype.u=function(){return this.up()},h.prototype.importXMLBuilder=function(p){return this.importDocument(p)},h.prototype.replaceChild=function(p,b){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.removeChild=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.appendChild=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.hasChildNodes=function(){return this.children.length!==0},h.prototype.cloneNode=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.isSupported=function(p,b){return!0},h.prototype.hasAttributes=function(){return this.attribs.length!==0},h.prototype.compareDocumentPosition=function(p){var b,x;return b=this,b===p?0:this.document()!==p.document()?(x=c.Disconnected|c.ImplementationSpecific,Math.random()<.5?x|=c.Preceding:x|=c.Following,x):b.isAncestor(p)?c.Contains|c.Preceding:b.isDescendant(p)?c.Contains|c.Following:b.isPreceding(p)?c.Preceding:c.Following},h.prototype.isSameNode=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.lookupPrefix=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.isDefaultNamespace=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.lookupNamespaceURI=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.isEqualNode=function(p){var b,x,v;if(p.nodeType!==this.nodeType||p.children.length!==this.children.length)return!1;for(b=x=0,v=this.children.length-1;0<=v?x<=v:x>=v;b=0<=v?++x:--x)if(!this.children[b].isEqualNode(p.children[b]))return!1;return!0},h.prototype.getFeature=function(p,b){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.setUserData=function(p,b,x){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.getUserData=function(p){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.contains=function(p){return p?p===this||this.isDescendant(p):!1},h.prototype.isDescendant=function(p){var b,x,v,M,S;for(S=this.children,v=0,M=S.length;v<M;v++)if(b=S[v],p===b||(x=b.isDescendant(p),x))return!0;return!1},h.prototype.isAncestor=function(p){return p.isDescendant(this)},h.prototype.isPreceding=function(p){var b,x;return b=this.treePosition(p),x=this.treePosition(this),b===-1||x===-1?!1:b<x},h.prototype.isFollowing=function(p){var b,x;return b=this.treePosition(p),x=this.treePosition(this),b===-1||x===-1?!1:b>x},h.prototype.treePosition=function(p){var b,x;return x=0,b=!1,this.foreachTreeNode(this.document(),function(v){if(x++,!b&&v===p)return b=!0}),b?x:-1},h.prototype.foreachTreeNode=function(p,b){var x,v,M,S,C;for(p||(p=this.document()),S=p.children,v=0,M=S.length;v<M;v++){if(x=S[v],C=b(x))return C;if(C=this.foreachTreeNode(x,b),C)return C}},h}()}).call(Fi)});var nr=R((Oi,Ri)=>{(function(){var c,e=function(r,i){return function(){return r.apply(i,arguments)}},t={}.hasOwnProperty;Ri.exports=c=function(){function r(i){this.assertLegalName=e(this.assertLegalName,this),this.assertLegalChar=e(this.assertLegalChar,this);var s,a,n;i||(i={}),this.options=i,this.options.version||(this.options.version="1.0"),a=i.stringify||{};for(s in a)t.call(a,s)&&(n=a[s],this[s]=n)}return r.prototype.name=function(i){return this.options.noValidation?i:this.assertLegalName(""+i||"")},r.prototype.text=function(i){return this.options.noValidation?i:this.assertLegalChar(this.textEscape(""+i||""))},r.prototype.cdata=function(i){return this.options.noValidation?i:(i=""+i||"",i=i.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(i))},r.prototype.comment=function(i){if(this.options.noValidation)return i;if(i=""+i||"",i.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+i);return this.assertLegalChar(i)},r.prototype.raw=function(i){return this.options.noValidation?i:""+i||""},r.prototype.attValue=function(i){return this.options.noValidation?i:this.assertLegalChar(this.attEscape(i=""+i||""))},r.prototype.insTarget=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.insValue=function(i){if(this.options.noValidation)return i;if(i=""+i||"",i.match(/\?>/))throw new Error("Invalid processing instruction value: "+i);return this.assertLegalChar(i)},r.prototype.xmlVersion=function(i){if(this.options.noValidation)return i;if(i=""+i||"",!i.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+i);return i},r.prototype.xmlEncoding=function(i){if(this.options.noValidation)return i;if(i=""+i||"",!i.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+i);return this.assertLegalChar(i)},r.prototype.xmlStandalone=function(i){return this.options.noValidation?i:i?"yes":"no"},r.prototype.dtdPubID=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdSysID=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdElementValue=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdAttType=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdAttDefault=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdEntityValue=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdNData=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.convertAttKey="@",r.prototype.convertPIKey="?",r.prototype.convertTextKey="#text",r.prototype.convertCDataKey="#cdata",r.prototype.convertCommentKey="#comment",r.prototype.convertRawKey="#raw",r.prototype.assertLegalChar=function(i){var s,a;if(this.options.noValidation)return i;if(s="",this.options.version==="1.0"){if(s=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,a=i.match(s))throw new Error("Invalid character in string: "+i+" at index "+a.index)}else if(this.options.version==="1.1"&&(s=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,a=i.match(s)))throw new Error("Invalid character in string: "+i+" at index "+a.index);return i},r.prototype.assertLegalName=function(i){var s;if(this.options.noValidation)return i;if(this.assertLegalChar(i),s=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!i.match(s))throw new Error("Invalid character in name");return i},r.prototype.textEscape=function(i){var s;return this.options.noValidation?i:(s=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,i.replace(s,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},r.prototype.attEscape=function(i){var s;return this.options.noValidation?i:(s=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,i.replace(s,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},r}()}).call(Oi)});var pt=R((Qi,_i)=>{(function(){_i.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(Qi)});var lr=R(($i,Ui)=>{(function(){var c,e,t,r,i,s,a,n,l,u,g,f,m,y,P,I,A,T={}.hasOwnProperty;A=pe().assign,c=W(),l=kt(),u=Qt(),t=Lt(),r=Nt(),f=At(),y=_t(),P=$t(),m=Ut(),g=or(),i=Ft(),s=Ot(),a=qt(),n=Rt(),e=pt(),Ui.exports=I=function(){function k(w){var h,p,b;w||(w={}),this.options=w,p=w.writer||{};for(h in p)T.call(p,h)&&(b=p[h],this["_"+h]=this[h],this[h]=b)}return k.prototype.filterOptions=function(w){var h,p,b,x,v,M,S,C;return w||(w={}),w=A({},this.options,w),h={writer:this},h.pretty=w.pretty||!1,h.allowEmpty=w.allowEmpty||!1,h.indent=(p=w.indent)!=null?p:"  ",h.newline=(b=w.newline)!=null?b:`
`,h.offset=(x=w.offset)!=null?x:0,h.dontPrettyTextNodes=(v=(M=w.dontPrettyTextNodes)!=null?M:w.dontprettytextnodes)!=null?v:0,h.spaceBeforeSlash=(S=(C=w.spaceBeforeSlash)!=null?C:w.spacebeforeslash)!=null?S:"",h.spaceBeforeSlash===!0&&(h.spaceBeforeSlash=" "),h.suppressPrettyCount=0,h.user={},h.state=e.None,h},k.prototype.indent=function(w,h,p){var b;return!h.pretty||h.suppressPrettyCount?"":h.pretty&&(b=(p||0)+h.offset+1,b>0)?new Array(b).join(h.indent):""},k.prototype.endline=function(w,h,p){return!h.pretty||h.suppressPrettyCount?"":h.newline},k.prototype.attribute=function(w,h,p){var b;return this.openAttribute(w,h,p),b=" "+w.name+'="'+w.value+'"',this.closeAttribute(w,h,p),b},k.prototype.cdata=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<![CDATA[",h.state=e.InsideTag,b+=w.value,h.state=e.CloseTag,b+="]]>"+this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.comment=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<!-- ",h.state=e.InsideTag,b+=w.value,h.state=e.CloseTag,b+=" -->"+this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.declaration=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<?xml",h.state=e.InsideTag,b+=' version="'+w.version+'"',w.encoding!=null&&(b+=' encoding="'+w.encoding+'"'),w.standalone!=null&&(b+=' standalone="'+w.standalone+'"'),h.state=e.CloseTag,b+=h.spaceBeforeSlash+"?>",b+=this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.docType=function(w,h,p){var b,x,v,M,S;if(p||(p=0),this.openNode(w,h,p),h.state=e.OpenTag,M=this.indent(w,h,p),M+="<!DOCTYPE "+w.root().name,w.pubID&&w.sysID?M+=' PUBLIC "'+w.pubID+'" "'+w.sysID+'"':w.sysID&&(M+=' SYSTEM "'+w.sysID+'"'),w.children.length>0){for(M+=" [",M+=this.endline(w,h,p),h.state=e.InsideTag,S=w.children,x=0,v=S.length;x<v;x++)b=S[x],M+=this.writeChildNode(b,h,p+1);h.state=e.CloseTag,M+="]"}return h.state=e.CloseTag,M+=h.spaceBeforeSlash+">",M+=this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),M},k.prototype.element=function(w,h,p){var b,x,v,M,S,C,N,q,Q,B,O,z,U,Le;p||(p=0),B=!1,O="",this.openNode(w,h,p),h.state=e.OpenTag,O+=this.indent(w,h,p)+"<"+w.name,z=w.attribs;for(Q in z)T.call(z,Q)&&(b=z[Q],O+=this.attribute(b,h,p));if(v=w.children.length,M=v===0?null:w.children[0],v===0||w.children.every(function(le){return(le.type===c.Text||le.type===c.Raw)&&le.value===""}))h.allowEmpty?(O+=">",h.state=e.CloseTag,O+="</"+w.name+">"+this.endline(w,h,p)):(h.state=e.CloseTag,O+=h.spaceBeforeSlash+"/>"+this.endline(w,h,p));else if(h.pretty&&v===1&&(M.type===c.Text||M.type===c.Raw)&&M.value!=null)O+=">",h.state=e.InsideTag,h.suppressPrettyCount++,B=!0,O+=this.writeChildNode(M,h,p+1),h.suppressPrettyCount--,B=!1,h.state=e.CloseTag,O+="</"+w.name+">"+this.endline(w,h,p);else{if(h.dontPrettyTextNodes){for(U=w.children,S=0,N=U.length;S<N;S++)if(x=U[S],(x.type===c.Text||x.type===c.Raw)&&x.value!=null){h.suppressPrettyCount++,B=!0;break}}for(O+=">"+this.endline(w,h,p),h.state=e.InsideTag,Le=w.children,C=0,q=Le.length;C<q;C++)x=Le[C],O+=this.writeChildNode(x,h,p+1);h.state=e.CloseTag,O+=this.indent(w,h,p)+"</"+w.name+">",B&&h.suppressPrettyCount--,O+=this.endline(w,h,p),h.state=e.None}return this.closeNode(w,h,p),O},k.prototype.writeChildNode=function(w,h,p){switch(w.type){case c.CData:return this.cdata(w,h,p);case c.Comment:return this.comment(w,h,p);case c.Element:return this.element(w,h,p);case c.Raw:return this.raw(w,h,p);case c.Text:return this.text(w,h,p);case c.ProcessingInstruction:return this.processingInstruction(w,h,p);case c.Dummy:return"";case c.Declaration:return this.declaration(w,h,p);case c.DocType:return this.docType(w,h,p);case c.AttributeDeclaration:return this.dtdAttList(w,h,p);case c.ElementDeclaration:return this.dtdElement(w,h,p);case c.EntityDeclaration:return this.dtdEntity(w,h,p);case c.NotationDeclaration:return this.dtdNotation(w,h,p);default:throw new Error("Unknown XML node type: "+w.constructor.name)}},k.prototype.processingInstruction=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<?",h.state=e.InsideTag,b+=w.target,w.value&&(b+=" "+w.value),h.state=e.CloseTag,b+=h.spaceBeforeSlash+"?>",b+=this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.raw=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p),h.state=e.InsideTag,b+=w.value,h.state=e.CloseTag,b+=this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.text=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p),h.state=e.InsideTag,b+=w.value,h.state=e.CloseTag,b+=this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.dtdAttList=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<!ATTLIST",h.state=e.InsideTag,b+=" "+w.elementName+" "+w.attributeName+" "+w.attributeType,w.defaultValueType!=="#DEFAULT"&&(b+=" "+w.defaultValueType),w.defaultValue&&(b+=' "'+w.defaultValue+'"'),h.state=e.CloseTag,b+=h.spaceBeforeSlash+">"+this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.dtdElement=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<!ELEMENT",h.state=e.InsideTag,b+=" "+w.name+" "+w.value,h.state=e.CloseTag,b+=h.spaceBeforeSlash+">"+this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.dtdEntity=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<!ENTITY",h.state=e.InsideTag,w.pe&&(b+=" %"),b+=" "+w.name,w.value?b+=' "'+w.value+'"':(w.pubID&&w.sysID?b+=' PUBLIC "'+w.pubID+'" "'+w.sysID+'"':w.sysID&&(b+=' SYSTEM "'+w.sysID+'"'),w.nData&&(b+=" NDATA "+w.nData)),h.state=e.CloseTag,b+=h.spaceBeforeSlash+">"+this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.dtdNotation=function(w,h,p){var b;return this.openNode(w,h,p),h.state=e.OpenTag,b=this.indent(w,h,p)+"<!NOTATION",h.state=e.InsideTag,b+=" "+w.name,w.pubID&&w.sysID?b+=' PUBLIC "'+w.pubID+'" "'+w.sysID+'"':w.pubID?b+=' PUBLIC "'+w.pubID+'"':w.sysID&&(b+=' SYSTEM "'+w.sysID+'"'),h.state=e.CloseTag,b+=h.spaceBeforeSlash+">"+this.endline(w,h,p),h.state=e.None,this.closeNode(w,h,p),b},k.prototype.openNode=function(w,h,p){},k.prototype.closeNode=function(w,h,p){},k.prototype.openAttribute=function(w,h,p){},k.prototype.closeAttribute=function(w,h,p){},k}()}).call($i)});var Bt=R((Bi,Vi)=>{(function(){var c,e,t=function(i,s){for(var a in s)r.call(s,a)&&(i[a]=s[a]);function n(){this.constructor=i}return n.prototype=s.prototype,i.prototype=new n,i.__super__=s.prototype,i},r={}.hasOwnProperty;e=lr(),Vi.exports=c=function(i){t(s,i);function s(a){s.__super__.constructor.call(this,a)}return s.prototype.document=function(a,n){var l,u,g,f,m;for(n=this.filterOptions(n),f="",m=a.children,u=0,g=m.length;u<g;u++)l=m[u],f+=this.writeChildNode(l,n,0);return n.pretty&&f.slice(-n.newline.length)===n.newline&&(f=f.slice(0,-n.newline.length)),f},s}(e)}).call(Bi)});var cr=R((ji,Hi)=>{(function(){var c,e,t,r,i,s,a,n,l=function(g,f){for(var m in f)u.call(f,m)&&(g[m]=f[m]);function y(){this.constructor=g}return y.prototype=f.prototype,g.prototype=new y,g.__super__=f.prototype,g},u={}.hasOwnProperty;n=pe().isPlainObject,t=sr(),e=Wr(),i=oe(),c=W(),a=nr(),s=Bt(),Hi.exports=r=function(g){l(f,g);function f(m){f.__super__.constructor.call(this,null),this.name="#document",this.type=c.Document,this.documentURI=null,this.domConfig=new e,m||(m={}),m.writer||(m.writer=new s),this.options=m,this.stringify=new a(m)}return Object.defineProperty(f.prototype,"implementation",{value:new t}),Object.defineProperty(f.prototype,"doctype",{get:function(){var m,y,P,I;for(I=this.children,y=0,P=I.length;y<P;y++)if(m=I[y],m.type===c.DocType)return m;return null}}),Object.defineProperty(f.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(f.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(f.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(f.prototype,"xmlEncoding",{get:function(){return this.children.length!==0&&this.children[0].type===c.Declaration?this.children[0].encoding:null}}),Object.defineProperty(f.prototype,"xmlStandalone",{get:function(){return this.children.length!==0&&this.children[0].type===c.Declaration?this.children[0].standalone==="yes":!1}}),Object.defineProperty(f.prototype,"xmlVersion",{get:function(){return this.children.length!==0&&this.children[0].type===c.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(f.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(f.prototype,"origin",{get:function(){return null}}),Object.defineProperty(f.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(f.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(f.prototype,"contentType",{get:function(){return null}}),f.prototype.end=function(m){var y;return y={},m?n(m)&&(y=m,m=this.options.writer):m=this.options.writer,m.document(this,m.filterOptions(y))},f.prototype.toString=function(m){return this.options.writer.document(this,this.options.writer.filterOptions(m))},f.prototype.createElement=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createTextNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createComment=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createCDATASection=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createProcessingInstruction=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createAttribute=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createEntityReference=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.getElementsByTagName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.importNode=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createElementNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createAttributeNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.getElementsByTagNameNS=function(m,y){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.getElementById=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.adoptNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.renameNode=function(m,y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.getElementsByClassName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createEvent=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createNodeIterator=function(m,y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},f.prototype.createTreeWalker=function(m,y,P){throw new Error("This DOM method is not implemented."+this.debugInfo())},f}(i)}).call(ji)});var Gi=R((Xi,Wi)=>{(function(){var c,e,t,r,i,s,a,n,l,u,g,f,m,y,P,I,A,T,k,w,h,p,b,x,v={}.hasOwnProperty;x=pe(),p=x.isObject,h=x.isFunction,b=x.isPlainObject,w=x.getValue,c=W(),f=cr(),y=At(),r=Lt(),i=Nt(),I=_t(),k=$t(),P=Ut(),u=kt(),g=Qt(),s=Ft(),n=qt(),a=Ot(),l=Rt(),t=ar(),T=nr(),A=Bt(),e=pt(),Wi.exports=m=function(){function M(S,C,N){var q;this.name="?xml",this.type=c.Document,S||(S={}),q={},S.writer?b(S.writer)&&(q=S.writer,S.writer=new A):S.writer=new A,this.options=S,this.writer=S.writer,this.writerOptions=this.writer.filterOptions(q),this.stringify=new T(S),this.onDataCallback=C||function(){},this.onEndCallback=N||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return M.prototype.createChildNode=function(S){var C,N,q,Q,B,O,z,U;switch(S.type){case c.CData:this.cdata(S.value);break;case c.Comment:this.comment(S.value);break;case c.Element:q={},z=S.attribs;for(N in z)v.call(z,N)&&(C=z[N],q[N]=C.value);this.node(S.name,q);break;case c.Dummy:this.dummy();break;case c.Raw:this.raw(S.value);break;case c.Text:this.text(S.value);break;case c.ProcessingInstruction:this.instruction(S.target,S.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+S.constructor.name)}for(U=S.children,B=0,O=U.length;B<O;B++)Q=U[B],this.createChildNode(Q),Q.type===c.Element&&this.up();return this},M.prototype.dummy=function(){return this},M.prototype.node=function(S,C,N){var q;if(S==null)throw new Error("Missing node name.");if(this.root&&this.currentLevel===-1)throw new Error("Document can only have one root node. "+this.debugInfo(S));return this.openCurrent(),S=w(S),C==null&&(C={}),C=w(C),p(C)||(q=[C,N],N=q[0],C=q[1]),this.currentNode=new y(this,S,C),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,N!=null&&this.text(N),this},M.prototype.element=function(S,C,N){var q,Q,B,O,z,U;if(this.currentNode&&this.currentNode.type===c.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(S)||p(S)||h(S))for(O=this.options.noValidation,this.options.noValidation=!0,U=new f(this.options).element("TEMP_ROOT"),U.element(S),this.options.noValidation=O,z=U.children,Q=0,B=z.length;Q<B;Q++)q=z[Q],this.createChildNode(q),q.type===c.Element&&this.up();else this.node(S,C,N);return this},M.prototype.attribute=function(S,C){var N,q;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(S));if(S!=null&&(S=w(S)),p(S))for(N in S)v.call(S,N)&&(q=S[N],this.attribute(N,q));else h(C)&&(C=C.apply()),this.options.keepNullAttributes&&C==null?this.currentNode.attribs[S]=new t(this,S,""):C!=null&&(this.currentNode.attribs[S]=new t(this,S,C));return this},M.prototype.text=function(S){var C;return this.openCurrent(),C=new k(this,S),this.onData(this.writer.text(C,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.cdata=function(S){var C;return this.openCurrent(),C=new r(this,S),this.onData(this.writer.cdata(C,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.comment=function(S){var C;return this.openCurrent(),C=new i(this,S),this.onData(this.writer.comment(C,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.raw=function(S){var C;return this.openCurrent(),C=new I(this,S),this.onData(this.writer.raw(C,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.instruction=function(S,C){var N,q,Q,B,O;if(this.openCurrent(),S!=null&&(S=w(S)),C!=null&&(C=w(C)),Array.isArray(S))for(N=0,B=S.length;N<B;N++)q=S[N],this.instruction(q);else if(p(S))for(q in S)v.call(S,q)&&(Q=S[q],this.instruction(q,Q));else h(C)&&(C=C.apply()),O=new P(this,S,C),this.onData(this.writer.processingInstruction(O,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},M.prototype.declaration=function(S,C,N){var q;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return q=new u(this,S,C,N),this.onData(this.writer.declaration(q,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.doctype=function(S,C,N){if(this.openCurrent(),S==null)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new g(this,C,N),this.currentNode.rootNodeName=S,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},M.prototype.dtdElement=function(S,C){var N;return this.openCurrent(),N=new a(this,S,C),this.onData(this.writer.dtdElement(N,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.attList=function(S,C,N,q,Q){var B;return this.openCurrent(),B=new s(this,S,C,N,q,Q),this.onData(this.writer.dtdAttList(B,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.entity=function(S,C){var N;return this.openCurrent(),N=new n(this,!1,S,C),this.onData(this.writer.dtdEntity(N,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.pEntity=function(S,C){var N;return this.openCurrent(),N=new n(this,!0,S,C),this.onData(this.writer.dtdEntity(N,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.notation=function(S,C){var N;return this.openCurrent(),N=new l(this,S,C),this.onData(this.writer.dtdNotation(N,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},M.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},M.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},M.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},M.prototype.openNode=function(S){var C,N,q,Q;if(!S.isOpen){if(!this.root&&this.currentLevel===0&&S.type===c.Element&&(this.root=S),N="",S.type===c.Element){this.writerOptions.state=e.OpenTag,N=this.writer.indent(S,this.writerOptions,this.currentLevel)+"<"+S.name,Q=S.attribs;for(q in Q)v.call(Q,q)&&(C=Q[q],N+=this.writer.attribute(C,this.writerOptions,this.currentLevel));N+=(S.children?">":"/>")+this.writer.endline(S,this.writerOptions,this.currentLevel),this.writerOptions.state=e.InsideTag}else this.writerOptions.state=e.OpenTag,N=this.writer.indent(S,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+S.rootNodeName,S.pubID&&S.sysID?N+=' PUBLIC "'+S.pubID+'" "'+S.sysID+'"':S.sysID&&(N+=' SYSTEM "'+S.sysID+'"'),S.children?(N+=" [",this.writerOptions.state=e.InsideTag):(this.writerOptions.state=e.CloseTag,N+=">"),N+=this.writer.endline(S,this.writerOptions,this.currentLevel);return this.onData(N,this.currentLevel),S.isOpen=!0}},M.prototype.closeNode=function(S){var C;if(!S.isClosed)return C="",this.writerOptions.state=e.CloseTag,S.type===c.Element?C=this.writer.indent(S,this.writerOptions,this.currentLevel)+"</"+S.name+">"+this.writer.endline(S,this.writerOptions,this.currentLevel):C=this.writer.indent(S,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(S,this.writerOptions,this.currentLevel),this.writerOptions.state=e.None,this.onData(C,this.currentLevel),S.isClosed=!0},M.prototype.onData=function(S,C){return this.documentStarted=!0,this.onDataCallback(S,C+1)},M.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},M.prototype.debugInfo=function(S){return S==null?"":"node: <"+S+">"},M.prototype.ele=function(){return this.element.apply(this,arguments)},M.prototype.nod=function(S,C,N){return this.node(S,C,N)},M.prototype.txt=function(S){return this.text(S)},M.prototype.dat=function(S){return this.cdata(S)},M.prototype.com=function(S){return this.comment(S)},M.prototype.ins=function(S,C){return this.instruction(S,C)},M.prototype.dec=function(S,C,N){return this.declaration(S,C,N)},M.prototype.dtd=function(S,C,N){return this.doctype(S,C,N)},M.prototype.e=function(S,C,N){return this.element(S,C,N)},M.prototype.n=function(S,C,N){return this.node(S,C,N)},M.prototype.t=function(S){return this.text(S)},M.prototype.d=function(S){return this.cdata(S)},M.prototype.c=function(S){return this.comment(S)},M.prototype.r=function(S){return this.raw(S)},M.prototype.i=function(S,C){return this.instruction(S,C)},M.prototype.att=function(){return this.currentNode&&this.currentNode.type===c.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},M.prototype.a=function(){return this.currentNode&&this.currentNode.type===c.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},M.prototype.ent=function(S,C){return this.entity(S,C)},M.prototype.pent=function(S,C){return this.pEntity(S,C)},M.prototype.not=function(S,C){return this.notation(S,C)},M}()}).call(Xi)});var Ki=R((zi,Yi)=>{(function(){var c,e,t,r,i=function(a,n){for(var l in n)s.call(n,l)&&(a[l]=n[l]);function u(){this.constructor=a}return u.prototype=n.prototype,a.prototype=new u,a.__super__=n.prototype,a},s={}.hasOwnProperty;c=W(),r=lr(),e=pt(),Yi.exports=t=function(a){i(n,a);function n(l,u){this.stream=l,n.__super__.constructor.call(this,u)}return n.prototype.endline=function(l,u,g){return l.isLastRootNode&&u.state===e.CloseTag?"":n.__super__.endline.call(this,l,u,g)},n.prototype.document=function(l,u){var g,f,m,y,P,I,A,T,k;for(A=l.children,f=m=0,P=A.length;m<P;f=++m)g=A[f],g.isLastRootNode=f===l.children.length-1;for(u=this.filterOptions(u),T=l.children,k=[],y=0,I=T.length;y<I;y++)g=T[y],k.push(this.writeChildNode(g,u,0));return k},n.prototype.attribute=function(l,u,g){return this.stream.write(n.__super__.attribute.call(this,l,u,g))},n.prototype.cdata=function(l,u,g){return this.stream.write(n.__super__.cdata.call(this,l,u,g))},n.prototype.comment=function(l,u,g){return this.stream.write(n.__super__.comment.call(this,l,u,g))},n.prototype.declaration=function(l,u,g){return this.stream.write(n.__super__.declaration.call(this,l,u,g))},n.prototype.docType=function(l,u,g){var f,m,y,P;if(g||(g=0),this.openNode(l,u,g),u.state=e.OpenTag,this.stream.write(this.indent(l,u,g)),this.stream.write("<!DOCTYPE "+l.root().name),l.pubID&&l.sysID?this.stream.write(' PUBLIC "'+l.pubID+'" "'+l.sysID+'"'):l.sysID&&this.stream.write(' SYSTEM "'+l.sysID+'"'),l.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(l,u,g)),u.state=e.InsideTag,P=l.children,m=0,y=P.length;m<y;m++)f=P[m],this.writeChildNode(f,u,g+1);u.state=e.CloseTag,this.stream.write("]")}return u.state=e.CloseTag,this.stream.write(u.spaceBeforeSlash+">"),this.stream.write(this.endline(l,u,g)),u.state=e.None,this.closeNode(l,u,g)},n.prototype.element=function(l,u,g){var f,m,y,P,I,A,T,k,w,h;g||(g=0),this.openNode(l,u,g),u.state=e.OpenTag,this.stream.write(this.indent(l,u,g)+"<"+l.name),w=l.attribs;for(T in w)s.call(w,T)&&(f=w[T],this.attribute(f,u,g));if(y=l.children.length,P=y===0?null:l.children[0],y===0||l.children.every(function(p){return(p.type===c.Text||p.type===c.Raw)&&p.value===""}))u.allowEmpty?(this.stream.write(">"),u.state=e.CloseTag,this.stream.write("</"+l.name+">")):(u.state=e.CloseTag,this.stream.write(u.spaceBeforeSlash+"/>"));else if(u.pretty&&y===1&&(P.type===c.Text||P.type===c.Raw)&&P.value!=null)this.stream.write(">"),u.state=e.InsideTag,u.suppressPrettyCount++,k=!0,this.writeChildNode(P,u,g+1),u.suppressPrettyCount--,k=!1,u.state=e.CloseTag,this.stream.write("</"+l.name+">");else{for(this.stream.write(">"+this.endline(l,u,g)),u.state=e.InsideTag,h=l.children,I=0,A=h.length;I<A;I++)m=h[I],this.writeChildNode(m,u,g+1);u.state=e.CloseTag,this.stream.write(this.indent(l,u,g)+"</"+l.name+">")}return this.stream.write(this.endline(l,u,g)),u.state=e.None,this.closeNode(l,u,g)},n.prototype.processingInstruction=function(l,u,g){return this.stream.write(n.__super__.processingInstruction.call(this,l,u,g))},n.prototype.raw=function(l,u,g){return this.stream.write(n.__super__.raw.call(this,l,u,g))},n.prototype.text=function(l,u,g){return this.stream.write(n.__super__.text.call(this,l,u,g))},n.prototype.dtdAttList=function(l,u,g){return this.stream.write(n.__super__.dtdAttList.call(this,l,u,g))},n.prototype.dtdElement=function(l,u,g){return this.stream.write(n.__super__.dtdElement.call(this,l,u,g))},n.prototype.dtdEntity=function(l,u,g){return this.stream.write(n.__super__.dtdEntity.call(this,l,u,g))},n.prototype.dtdNotation=function(l,u,g){return this.stream.write(n.__super__.dtdNotation.call(this,l,u,g))},n}(r)}).call(zi)});var Zi=R((Ji,Me)=>{(function(){var c,e,t,r,i,s,a,n,l,u;u=pe(),n=u.assign,l=u.isFunction,t=sr(),r=cr(),i=Gi(),a=Bt(),s=Ki(),c=W(),e=pt(),Me.exports.create=function(g,f,m,y){var P,I;if(g==null)throw new Error("Root element needs a name.");return y=n({},f,m,y),P=new r(y),I=P.element(g),y.headless||(P.declaration(y),(y.pubID!=null||y.sysID!=null)&&P.dtd(y)),I},Me.exports.begin=function(g,f,m){var y;return l(g)&&(y=[g,f],f=y[0],m=y[1],g={}),f?new i(g,f,m):new r(g)},Me.exports.stringWriter=function(g){return new a(g)},Me.exports.streamWriter=function(g,f){return new s(g,f)},Me.exports.implementation=new t,Me.exports.nodeType=c,Me.exports.writerState=e}).call(Ji)});var es=R(ur=>{(function(){"use strict";var c,e,t,r,i,s={}.hasOwnProperty;c=Zi(),e=Ct().defaults,r=function(a){return typeof a=="string"&&(a.indexOf("&")>=0||a.indexOf(">")>=0||a.indexOf("<")>=0)},i=function(a){return"<![CDATA["+t(a)+"]]>"},t=function(a){return a.replace("]]>","]]]]><![CDATA[>")},ur.Builder=function(){function a(n){var l,u,g;this.options={},u=e["0.2"];for(l in u)s.call(u,l)&&(g=u[l],this.options[l]=g);for(l in n)s.call(n,l)&&(g=n[l],this.options[l]=g)}return a.prototype.buildObject=function(n){var l,u,g,f,m;return l=this.options.attrkey,u=this.options.charkey,Object.keys(n).length===1&&this.options.rootName===e["0.2"].rootName?(m=Object.keys(n)[0],n=n[m]):m=this.options.rootName,g=function(y){return function(P,I){var A,T,k,w,h,p;if(typeof I!="object")y.options.cdata&&r(I)?P.raw(i(I)):P.txt(I);else if(Array.isArray(I)){for(w in I)if(s.call(I,w)){T=I[w];for(h in T)k=T[h],P=g(P.ele(h),k).up()}}else for(h in I)if(s.call(I,h))if(T=I[h],h===l){if(typeof T=="object")for(A in T)p=T[A],P=P.att(A,p)}else if(h===u)y.options.cdata&&r(T)?P=P.raw(i(T)):P=P.txt(T);else if(Array.isArray(T))for(w in T)s.call(T,w)&&(k=T[w],typeof k=="string"?y.options.cdata&&r(k)?P=P.ele(h).raw(i(k)).up():P=P.ele(h,k).up():P=g(P.ele(h),k).up());else typeof T=="object"?P=g(P.ele(h),T).up():typeof T=="string"&&y.options.cdata&&r(T)?P=P.ele(h).raw(i(T)).up():(T==null&&(T=""),P=P.ele(h,T.toString()).up());return P}}(this),f=c.create(m,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),g(f,n).end(this.options.renderOpts)},a}()}).call(ur)});var ts=R(Vt=>{(function(c){c.parser=function(E,d){return new t(E,d)},c.SAXParser=t,c.SAXStream=u,c.createStream=l,c.MAX_BUFFER_LENGTH=64*1024;var e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];c.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(E,d){if(!(this instanceof t))return new t(E,d);var L=this;i(L),L.q=L.c="",L.bufferCheckPosition=c.MAX_BUFFER_LENGTH,L.opt=d||{},L.opt.lowercase=L.opt.lowercase||L.opt.lowercasetags,L.looseCase=L.opt.lowercase?"toLowerCase":"toUpperCase",L.tags=[],L.closed=L.closedRoot=L.sawRoot=!1,L.tag=L.error=null,L.strict=!!E,L.noscript=!!(E||L.opt.noscript),L.state=v.BEGIN,L.strictEntities=L.opt.strictEntities,L.ENTITIES=L.strictEntities?Object.create(c.XML_ENTITIES):Object.create(c.ENTITIES),L.attribList=[],L.opt.xmlns&&(L.ns=Object.create(P)),L.opt.unquotedAttributeValues===void 0&&(L.opt.unquotedAttributeValues=!E),L.trackPosition=L.opt.position!==!1,L.trackPosition&&(L.position=L.line=L.column=0),S(L,"onready")}Object.create||(Object.create=function(E){function d(){}d.prototype=E;var L=new d;return L}),Object.keys||(Object.keys=function(E){var d=[];for(var L in E)E.hasOwnProperty(L)&&d.push(L);return d});function r(E){for(var d=Math.max(c.MAX_BUFFER_LENGTH,10),L=0,D=0,V=e.length;D<V;D++){var H=E[e[D]].length;if(H>d)switch(e[D]){case"textNode":N(E);break;case"cdata":C(E,"oncdata",E.cdata),E.cdata="";break;case"script":C(E,"onscript",E.script),E.script="";break;default:Q(E,"Max buffer length exceeded: "+e[D])}L=Math.max(L,H)}var Y=c.MAX_BUFFER_LENGTH-L;E.bufferCheckPosition=Y+E.position}function i(E){for(var d=0,L=e.length;d<L;d++)E[e[d]]=""}function s(E){N(E),E.cdata!==""&&(C(E,"oncdata",E.cdata),E.cdata=""),E.script!==""&&(C(E,"onscript",E.script),E.script="")}t.prototype={end:function(){B(this)},write:Rs,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};var a;try{a=require("stream").Stream}catch(E){a=function(){}}a||(a=function(){});var n=c.EVENTS.filter(function(E){return E!=="error"&&E!=="end"});function l(E,d){return new u(E,d)}function u(E,d){if(!(this instanceof u))return new u(E,d);a.apply(this),this._parser=new t(E,d),this.writable=!0,this.readable=!0;var L=this;this._parser.onend=function(){L.emit("end")},this._parser.onerror=function(D){L.emit("error",D),L._parser.error=null},this._decoder=null,n.forEach(function(D){Object.defineProperty(L,"on"+D,{get:function(){return L._parser["on"+D]},set:function(V){if(!V)return L.removeAllListeners(D),L._parser["on"+D]=V,V;L.on(D,V)},enumerable:!0,configurable:!1})})}u.prototype=Object.create(a.prototype,{constructor:{value:u}}),u.prototype.write=function(E){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(E)){if(!this._decoder){var d=require("string_decoder").StringDecoder;this._decoder=new d("utf8")}E=this._decoder.write(E)}return this._parser.write(E.toString()),this.emit("data",E),!0},u.prototype.end=function(E){return E&&E.length&&this.write(E),this._parser.end(),!0},u.prototype.on=function(E,d){var L=this;return!L._parser["on"+E]&&n.indexOf(E)!==-1&&(L._parser["on"+E]=function(){var D=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);D.splice(0,0,E),L.emit.apply(L,D)}),a.prototype.on.call(L,E,d)};var g="[CDATA[",f="DOCTYPE",m="http://www.w3.org/XML/1998/namespace",y="http://www.w3.org/2000/xmlns/",P={xml:m,xmlns:y},I=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,A=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,T=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,k=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function w(E){return E===" "||E===`
`||E==="\r"||E==="	"}function h(E){return E==='"'||E==="'"}function p(E){return E===">"||w(E)}function b(E,d){return E.test(d)}function x(E,d){return!b(E,d)}var v=0;c.STATE={BEGIN:v++,BEGIN_WHITESPACE:v++,TEXT:v++,TEXT_ENTITY:v++,OPEN_WAKA:v++,SGML_DECL:v++,SGML_DECL_QUOTED:v++,DOCTYPE:v++,DOCTYPE_QUOTED:v++,DOCTYPE_DTD:v++,DOCTYPE_DTD_QUOTED:v++,COMMENT_STARTING:v++,COMMENT:v++,COMMENT_ENDING:v++,COMMENT_ENDED:v++,CDATA:v++,CDATA_ENDING:v++,CDATA_ENDING_2:v++,PROC_INST:v++,PROC_INST_BODY:v++,PROC_INST_ENDING:v++,OPEN_TAG:v++,OPEN_TAG_SLASH:v++,ATTRIB:v++,ATTRIB_NAME:v++,ATTRIB_NAME_SAW_WHITE:v++,ATTRIB_VALUE:v++,ATTRIB_VALUE_QUOTED:v++,ATTRIB_VALUE_CLOSED:v++,ATTRIB_VALUE_UNQUOTED:v++,ATTRIB_VALUE_ENTITY_Q:v++,ATTRIB_VALUE_ENTITY_U:v++,CLOSE_TAG:v++,CLOSE_TAG_SAW_WHITE:v++,SCRIPT:v++,SCRIPT_ENDING:v++},c.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},c.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(c.ENTITIES).forEach(function(E){var d=c.ENTITIES[E],L=typeof d=="number"?String.fromCharCode(d):d;c.ENTITIES[E]=L});for(var M in c.STATE)c.STATE[c.STATE[M]]=M;v=c.STATE;function S(E,d,L){E[d]&&E[d](L)}function C(E,d,L){E.textNode&&N(E),S(E,d,L)}function N(E){E.textNode=q(E.opt,E.textNode),E.textNode&&S(E,"ontext",E.textNode),E.textNode=""}function q(E,d){return E.trim&&(d=d.trim()),E.normalize&&(d=d.replace(/\s+/g," ")),d}function Q(E,d){return N(E),E.trackPosition&&(d+=`
Line: `+E.line+`
Column: `+E.column+`
Char: `+E.c),d=new Error(d),E.error=d,S(E,"onerror",d),E}function B(E){return E.sawRoot&&!E.closedRoot&&O(E,"Unclosed root tag"),E.state!==v.BEGIN&&E.state!==v.BEGIN_WHITESPACE&&E.state!==v.TEXT&&Q(E,"Unexpected end"),N(E),E.c="",E.closed=!0,S(E,"onend"),t.call(E,E.strict,E.opt),E}function O(E,d){if(typeof E!="object"||!(E instanceof t))throw new Error("bad call to strictFail");E.strict&&Q(E,d)}function z(E){E.strict||(E.tagName=E.tagName[E.looseCase]());var d=E.tags[E.tags.length-1]||E,L=E.tag={name:E.tagName,attributes:{}};E.opt.xmlns&&(L.ns=d.ns),E.attribList.length=0,C(E,"onopentagstart",L)}function U(E,d){var L=E.indexOf(":"),D=L<0?["",E]:E.split(":"),V=D[0],H=D[1];return d&&E==="xmlns"&&(V="xmlns",H=""),{prefix:V,local:H}}function Le(E){if(E.strict||(E.attribName=E.attribName[E.looseCase]()),E.attribList.indexOf(E.attribName)!==-1||E.tag.attributes.hasOwnProperty(E.attribName)){E.attribName=E.attribValue="";return}if(E.opt.xmlns){var d=U(E.attribName,!0),L=d.prefix,D=d.local;if(L==="xmlns")if(D==="xml"&&E.attribValue!==m)O(E,"xml: prefix must be bound to "+m+`
Actual: `+E.attribValue);else if(D==="xmlns"&&E.attribValue!==y)O(E,"xmlns: prefix must be bound to "+y+`
Actual: `+E.attribValue);else{var V=E.tag,H=E.tags[E.tags.length-1]||E;V.ns===H.ns&&(V.ns=Object.create(H.ns)),V.ns[D]=E.attribValue}E.attribList.push([E.attribName,E.attribValue])}else E.tag.attributes[E.attribName]=E.attribValue,C(E,"onattribute",{name:E.attribName,value:E.attribValue});E.attribName=E.attribValue=""}function le(E,d){if(E.opt.xmlns){var L=E.tag,D=U(E.tagName);L.prefix=D.prefix,L.local=D.local,L.uri=L.ns[D.prefix]||"",L.prefix&&!L.uri&&(O(E,"Unbound namespace prefix: "+JSON.stringify(E.tagName)),L.uri=D.prefix);var V=E.tags[E.tags.length-1]||E;L.ns&&V.ns!==L.ns&&Object.keys(L.ns).forEach(function(Tr){C(E,"onopennamespace",{prefix:Tr,uri:L.ns[Tr]})});for(var H=0,Y=E.attribList.length;H<Y;H++){var re=E.attribList[H],ie=re[0],Qe=re[1],J=U(ie,!0),me=J.prefix,Qs=J.local,xr=me===""?"":L.ns[me]||"",er={name:ie,value:Qe,prefix:me,local:Qs,uri:xr};me&&me!=="xmlns"&&!xr&&(O(E,"Unbound namespace prefix: "+JSON.stringify(me)),er.uri=me),E.tag.attributes[ie]=er,C(E,"onattribute",er)}E.attribList.length=0}E.tag.isSelfClosing=!!d,E.sawRoot=!0,E.tags.push(E.tag),C(E,"onopentag",E.tag),d||(!E.noscript&&E.tagName.toLowerCase()==="script"?E.state=v.SCRIPT:E.state=v.TEXT,E.tag=null,E.tagName=""),E.attribName=E.attribValue="",E.attribList.length=0}function Jt(E){if(!E.tagName){O(E,"Weird empty close tag."),E.textNode+="</>",E.state=v.TEXT;return}if(E.script){if(E.tagName!=="script"){E.script+="</"+E.tagName+">",E.tagName="",E.state=v.SCRIPT;return}C(E,"onscript",E.script),E.script=""}var d=E.tags.length,L=E.tagName;E.strict||(L=L[E.looseCase]());for(var D=L;d--;){var V=E.tags[d];if(V.name!==D)O(E,"Unexpected close tag");else break}if(d<0){O(E,"Unmatched closing tag: "+E.tagName),E.textNode+="</"+E.tagName+">",E.state=v.TEXT;return}E.tagName=L;for(var H=E.tags.length;H-- >d;){var Y=E.tag=E.tags.pop();E.tagName=E.tag.name,C(E,"onclosetag",E.tagName);var re={};for(var ie in Y.ns)re[ie]=Y.ns[ie];var Qe=E.tags[E.tags.length-1]||E;E.opt.xmlns&&Y.ns!==Qe.ns&&Object.keys(Y.ns).forEach(function(J){var me=Y.ns[J];C(E,"onclosenamespace",{prefix:J,uri:me})})}d===0&&(E.closedRoot=!0),E.tagName=E.attribValue=E.attribName="",E.attribList.length=0,E.state=v.TEXT}function Os(E){var d=E.entity,L=d.toLowerCase(),D,V="";return E.ENTITIES[d]?E.ENTITIES[d]:E.ENTITIES[L]?E.ENTITIES[L]:(d=L,d.charAt(0)==="#"&&(d.charAt(1)==="x"?(d=d.slice(2),D=parseInt(d,16),V=D.toString(16)):(d=d.slice(1),D=parseInt(d,10),V=D.toString(10))),d=d.replace(/^0+/,""),isNaN(D)||V.toLowerCase()!==d||D<0||D>1114111?(O(E,"Invalid character entity"),"&"+E.entity+";"):String.fromCodePoint(D))}function Sr(E,d){d==="<"?(E.state=v.OPEN_WAKA,E.startTagPosition=E.position):w(d)||(O(E,"Non-whitespace before first tag."),E.textNode=d,E.state=v.TEXT)}function Zt(E,d){var L="";return d<E.length&&(L=E.charAt(d)),L}function Rs(E){var d=this;if(this.error)throw this.error;if(d.closed)return Q(d,"Cannot write after close. Assign an onready handler.");if(E===null)return B(d);typeof E=="object"&&(E=E.toString());for(var L=0,D="";D=Zt(E,L++),d.c=D,!!D;)switch(d.trackPosition&&(d.position++,D===`
`?(d.line++,d.column=0):d.column++),d.state){case v.BEGIN:if(d.state=v.BEGIN_WHITESPACE,D==="\uFEFF")continue;Sr(d,D);continue;case v.BEGIN_WHITESPACE:Sr(d,D);continue;case v.TEXT:if(d.sawRoot&&!d.closedRoot){for(var H=L-1;D&&D!=="<"&&D!=="&";)D=Zt(E,L++),D&&d.trackPosition&&(d.position++,D===`
`?(d.line++,d.column=0):d.column++);d.textNode+=E.substring(H,L-1)}D==="<"&&!(d.sawRoot&&d.closedRoot&&!d.strict)?(d.state=v.OPEN_WAKA,d.startTagPosition=d.position):(!w(D)&&(!d.sawRoot||d.closedRoot)&&O(d,"Text data outside of root node."),D==="&"?d.state=v.TEXT_ENTITY:d.textNode+=D);continue;case v.SCRIPT:D==="<"?d.state=v.SCRIPT_ENDING:d.script+=D;continue;case v.SCRIPT_ENDING:D==="/"?d.state=v.CLOSE_TAG:(d.script+="<"+D,d.state=v.SCRIPT);continue;case v.OPEN_WAKA:if(D==="!")d.state=v.SGML_DECL,d.sgmlDecl="";else if(!w(D))if(b(I,D))d.state=v.OPEN_TAG,d.tagName=D;else if(D==="/")d.state=v.CLOSE_TAG,d.tagName="";else if(D==="?")d.state=v.PROC_INST,d.procInstName=d.procInstBody="";else{if(O(d,"Unencoded <"),d.startTagPosition+1<d.position){var V=d.position-d.startTagPosition;D=new Array(V).join(" ")+D}d.textNode+="<"+D,d.state=v.TEXT}continue;case v.SGML_DECL:if(d.sgmlDecl+D==="--"){d.state=v.COMMENT,d.comment="",d.sgmlDecl="";continue}d.doctype&&d.doctype!==!0&&d.sgmlDecl?(d.state=v.DOCTYPE_DTD,d.doctype+="<!"+d.sgmlDecl+D,d.sgmlDecl=""):(d.sgmlDecl+D).toUpperCase()===g?(C(d,"onopencdata"),d.state=v.CDATA,d.sgmlDecl="",d.cdata=""):(d.sgmlDecl+D).toUpperCase()===f?(d.state=v.DOCTYPE,(d.doctype||d.sawRoot)&&O(d,"Inappropriately located doctype declaration"),d.doctype="",d.sgmlDecl=""):D===">"?(C(d,"onsgmldeclaration",d.sgmlDecl),d.sgmlDecl="",d.state=v.TEXT):(h(D)&&(d.state=v.SGML_DECL_QUOTED),d.sgmlDecl+=D);continue;case v.SGML_DECL_QUOTED:D===d.q&&(d.state=v.SGML_DECL,d.q=""),d.sgmlDecl+=D;continue;case v.DOCTYPE:D===">"?(d.state=v.TEXT,C(d,"ondoctype",d.doctype),d.doctype=!0):(d.doctype+=D,D==="["?d.state=v.DOCTYPE_DTD:h(D)&&(d.state=v.DOCTYPE_QUOTED,d.q=D));continue;case v.DOCTYPE_QUOTED:d.doctype+=D,D===d.q&&(d.q="",d.state=v.DOCTYPE);continue;case v.DOCTYPE_DTD:D==="]"?(d.doctype+=D,d.state=v.DOCTYPE):D==="<"?(d.state=v.OPEN_WAKA,d.startTagPosition=d.position):h(D)?(d.doctype+=D,d.state=v.DOCTYPE_DTD_QUOTED,d.q=D):d.doctype+=D;continue;case v.DOCTYPE_DTD_QUOTED:d.doctype+=D,D===d.q&&(d.state=v.DOCTYPE_DTD,d.q="");continue;case v.COMMENT:D==="-"?d.state=v.COMMENT_ENDING:d.comment+=D;continue;case v.COMMENT_ENDING:D==="-"?(d.state=v.COMMENT_ENDED,d.comment=q(d.opt,d.comment),d.comment&&C(d,"oncomment",d.comment),d.comment=""):(d.comment+="-"+D,d.state=v.COMMENT);continue;case v.COMMENT_ENDED:D!==">"?(O(d,"Malformed comment"),d.comment+="--"+D,d.state=v.COMMENT):d.doctype&&d.doctype!==!0?d.state=v.DOCTYPE_DTD:d.state=v.TEXT;continue;case v.CDATA:for(var H=L-1;D&&D!=="]";)D=Zt(E,L++),D&&d.trackPosition&&(d.position++,D===`
`?(d.line++,d.column=0):d.column++);d.cdata+=E.substring(H,L-1),D==="]"&&(d.state=v.CDATA_ENDING);continue;case v.CDATA_ENDING:D==="]"?d.state=v.CDATA_ENDING_2:(d.cdata+="]"+D,d.state=v.CDATA);continue;case v.CDATA_ENDING_2:D===">"?(d.cdata&&C(d,"oncdata",d.cdata),C(d,"onclosecdata"),d.cdata="",d.state=v.TEXT):D==="]"?d.cdata+="]":(d.cdata+="]]"+D,d.state=v.CDATA);continue;case v.PROC_INST:D==="?"?d.state=v.PROC_INST_ENDING:w(D)?d.state=v.PROC_INST_BODY:d.procInstName+=D;continue;case v.PROC_INST_BODY:if(!d.procInstBody&&w(D))continue;D==="?"?d.state=v.PROC_INST_ENDING:d.procInstBody+=D;continue;case v.PROC_INST_ENDING:D===">"?(C(d,"onprocessinginstruction",{name:d.procInstName,body:d.procInstBody}),d.procInstName=d.procInstBody="",d.state=v.TEXT):(d.procInstBody+="?"+D,d.state=v.PROC_INST_BODY);continue;case v.OPEN_TAG:b(A,D)?d.tagName+=D:(z(d),D===">"?le(d):D==="/"?d.state=v.OPEN_TAG_SLASH:(w(D)||O(d,"Invalid character in tag name"),d.state=v.ATTRIB));continue;case v.OPEN_TAG_SLASH:D===">"?(le(d,!0),Jt(d)):(O(d,"Forward-slash in opening tag not followed by >"),d.state=v.ATTRIB);continue;case v.ATTRIB:if(w(D))continue;D===">"?le(d):D==="/"?d.state=v.OPEN_TAG_SLASH:b(I,D)?(d.attribName=D,d.attribValue="",d.state=v.ATTRIB_NAME):O(d,"Invalid attribute name");continue;case v.ATTRIB_NAME:D==="="?d.state=v.ATTRIB_VALUE:D===">"?(O(d,"Attribute without value"),d.attribValue=d.attribName,Le(d),le(d)):w(D)?d.state=v.ATTRIB_NAME_SAW_WHITE:b(A,D)?d.attribName+=D:O(d,"Invalid attribute name");continue;case v.ATTRIB_NAME_SAW_WHITE:if(D==="=")d.state=v.ATTRIB_VALUE;else{if(w(D))continue;O(d,"Attribute without value"),d.tag.attributes[d.attribName]="",d.attribValue="",C(d,"onattribute",{name:d.attribName,value:""}),d.attribName="",D===">"?le(d):b(I,D)?(d.attribName=D,d.state=v.ATTRIB_NAME):(O(d,"Invalid attribute name"),d.state=v.ATTRIB)}continue;case v.ATTRIB_VALUE:if(w(D))continue;h(D)?(d.q=D,d.state=v.ATTRIB_VALUE_QUOTED):(d.opt.unquotedAttributeValues||Q(d,"Unquoted attribute value"),d.state=v.ATTRIB_VALUE_UNQUOTED,d.attribValue=D);continue;case v.ATTRIB_VALUE_QUOTED:if(D!==d.q){D==="&"?d.state=v.ATTRIB_VALUE_ENTITY_Q:d.attribValue+=D;continue}Le(d),d.q="",d.state=v.ATTRIB_VALUE_CLOSED;continue;case v.ATTRIB_VALUE_CLOSED:w(D)?d.state=v.ATTRIB:D===">"?le(d):D==="/"?d.state=v.OPEN_TAG_SLASH:b(I,D)?(O(d,"No whitespace between attributes"),d.attribName=D,d.attribValue="",d.state=v.ATTRIB_NAME):O(d,"Invalid attribute name");continue;case v.ATTRIB_VALUE_UNQUOTED:if(!p(D)){D==="&"?d.state=v.ATTRIB_VALUE_ENTITY_U:d.attribValue+=D;continue}Le(d),D===">"?le(d):d.state=v.ATTRIB;continue;case v.CLOSE_TAG:if(d.tagName)D===">"?Jt(d):b(A,D)?d.tagName+=D:d.script?(d.script+="</"+d.tagName,d.tagName="",d.state=v.SCRIPT):(w(D)||O(d,"Invalid tagname in closing tag"),d.state=v.CLOSE_TAG_SAW_WHITE);else{if(w(D))continue;x(I,D)?d.script?(d.script+="</"+D,d.state=v.SCRIPT):O(d,"Invalid tagname in closing tag."):d.tagName=D}continue;case v.CLOSE_TAG_SAW_WHITE:if(w(D))continue;D===">"?Jt(d):O(d,"Invalid characters in closing tag");continue;case v.TEXT_ENTITY:case v.ATTRIB_VALUE_ENTITY_Q:case v.ATTRIB_VALUE_ENTITY_U:var Y,re;switch(d.state){case v.TEXT_ENTITY:Y=v.TEXT,re="textNode";break;case v.ATTRIB_VALUE_ENTITY_Q:Y=v.ATTRIB_VALUE_QUOTED,re="attribValue";break;case v.ATTRIB_VALUE_ENTITY_U:Y=v.ATTRIB_VALUE_UNQUOTED,re="attribValue";break}if(D===";"){var ie=Os(d);d.opt.unparsedEntities&&!Object.values(c.XML_ENTITIES).includes(ie)?(d.entity="",d.state=Y,d.write(ie)):(d[re]+=ie,d.entity="",d.state=Y)}else b(d.entity.length?k:T,D)?d.entity+=D:(O(d,"Invalid character in entity name"),d[re]+="&"+d.entity+D,d.entity="",d.state=Y);continue;default:throw new Error(d,"Unknown state: "+d.state)}return d.position>=d.bufferCheckPosition&&r(d),d}String.fromCodePoint||function(){var E=String.fromCharCode,d=Math.floor,L=function(){var D=16384,V=[],H,Y,re=-1,ie=arguments.length;if(!ie)return"";for(var Qe="";++re<ie;){var J=Number(arguments[re]);if(!isFinite(J)||J<0||J>1114111||d(J)!==J)throw RangeError("Invalid code point: "+J);J<=65535?V.push(J):(J-=65536,H=(J>>10)+55296,Y=J%1024+56320,V.push(H,Y)),(re+1===ie||V.length>D)&&(Qe+=E.apply(null,V),V.length=0)}return Qe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:L,configurable:!0,writable:!0}):String.fromCodePoint=L}()})(typeof Vt=="undefined"?Vt.sax={}:Vt)});var rs=R(dr=>{(function(){"use strict";dr.stripBOM=function(c){return c[0]==="\uFEFF"?c.substring(1):c}}).call(dr)});var pr=R(qe=>{(function(){"use strict";var c;c=new RegExp(/(?!xmlns)^.*:/),qe.normalize=function(e){return e.toLowerCase()},qe.firstCharLowerCase=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},qe.stripPrefix=function(e){return e.replace(c,"")},qe.parseNumbers=function(e){return isNaN(e)||(e=e%1===0?parseInt(e,10):parseFloat(e)),e},qe.parseBooleans=function(e){return/^(?:true|false)$/i.test(e)&&(e=e.toLowerCase()==="true"),e}}).call(qe)});var is=R(we=>{(function(){"use strict";var c,e,t,r,i,s,a,n,l=function(f,m){return function(){return f.apply(m,arguments)}},u=function(f,m){for(var y in m)g.call(m,y)&&(f[y]=m[y]);function P(){this.constructor=f}return P.prototype=m.prototype,f.prototype=new P,f.__super__=m.prototype,f},g={}.hasOwnProperty;a=ts(),t=require("events"),c=rs(),s=pr(),n=require("timers").setImmediate,e=Ct().defaults,r=function(f){return typeof f=="object"&&f!=null&&Object.keys(f).length===0},i=function(f,m,y){var P,I,A;for(P=0,I=f.length;P<I;P++)A=f[P],m=A(m,y);return m},we.Parser=function(f){u(m,f);function m(y){this.parseStringPromise=l(this.parseStringPromise,this),this.parseString=l(this.parseString,this),this.reset=l(this.reset,this),this.assignOrPush=l(this.assignOrPush,this),this.processAsync=l(this.processAsync,this);var P,I,A;if(!(this instanceof we.Parser))return new we.Parser(y);this.options={},I=e["0.2"];for(P in I)g.call(I,P)&&(A=I[P],this.options[P]=A);for(P in y)g.call(y,P)&&(A=y[P],this.options[P]=A);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(s.normalize)),this.reset()}return m.prototype.processAsync=function(){var y,P;try{return this.remaining.length<=this.options.chunkSize?(y=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(y),this.saxParser.close()):(y=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(y),n(this.processAsync))}catch(I){if(P=I,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(P)}},m.prototype.assignOrPush=function(y,P,I){return P in y?(y[P]instanceof Array||(y[P]=[y[P]]),y[P].push(I)):this.options.explicitArray?y[P]=[I]:y[P]=I},m.prototype.reset=function(){var y,P,I,A;return this.removeAllListeners(),this.saxParser=a.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(T){return function(k){if(T.saxParser.resume(),!T.saxParser.errThrown)return T.saxParser.errThrown=!0,T.emit("error",k)}}(this),this.saxParser.onend=function(T){return function(){if(!T.saxParser.ended)return T.saxParser.ended=!0,T.emit("end",T.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,A=[],y=this.options.attrkey,P=this.options.charkey,this.saxParser.onopentag=function(T){return function(k){var w,h,p,b,x;if(p=Object.create(null),p[P]="",!T.options.ignoreAttrs){x=k.attributes;for(w in x)g.call(x,w)&&(!(y in p)&&!T.options.mergeAttrs&&(p[y]=Object.create(null)),h=T.options.attrValueProcessors?i(T.options.attrValueProcessors,k.attributes[w],w):k.attributes[w],b=T.options.attrNameProcessors?i(T.options.attrNameProcessors,w):w,T.options.mergeAttrs?T.assignOrPush(p,b,h):p[y][b]=h)}return p["#name"]=T.options.tagNameProcessors?i(T.options.tagNameProcessors,k.name):k.name,T.options.xmlns&&(p[T.options.xmlnskey]={uri:k.uri,local:k.local}),A.push(p)}}(this),this.saxParser.onclosetag=function(T){return function(){var k,w,h,p,b,x,v,M,S,C;if(x=A.pop(),b=x["#name"],(!T.options.explicitChildren||!T.options.preserveChildrenOrder)&&delete x["#name"],x.cdata===!0&&(k=x.cdata,delete x.cdata),S=A[A.length-1],x[P].match(/^\s*$/)&&!k?(w=x[P],delete x[P]):(T.options.trim&&(x[P]=x[P].trim()),T.options.normalize&&(x[P]=x[P].replace(/\s{2,}/g," ").trim()),x[P]=T.options.valueProcessors?i(T.options.valueProcessors,x[P],b):x[P],Object.keys(x).length===1&&P in x&&!T.EXPLICIT_CHARKEY&&(x=x[P])),r(x)&&(typeof T.options.emptyTag=="function"?x=T.options.emptyTag():x=T.options.emptyTag!==""?T.options.emptyTag:w),T.options.validator!=null&&(C="/"+function(){var N,q,Q;for(Q=[],N=0,q=A.length;N<q;N++)p=A[N],Q.push(p["#name"]);return Q}().concat(b).join("/"),function(){var N;try{return x=T.options.validator(C,S&&S[b],x)}catch(q){return N=q,T.emit("error",N)}}()),T.options.explicitChildren&&!T.options.mergeAttrs&&typeof x=="object"){if(!T.options.preserveChildrenOrder)p=Object.create(null),T.options.attrkey in x&&(p[T.options.attrkey]=x[T.options.attrkey],delete x[T.options.attrkey]),!T.options.charsAsChildren&&T.options.charkey in x&&(p[T.options.charkey]=x[T.options.charkey],delete x[T.options.charkey]),Object.getOwnPropertyNames(x).length>0&&(p[T.options.childkey]=x),x=p;else if(S){S[T.options.childkey]=S[T.options.childkey]||[],v=Object.create(null);for(h in x)g.call(x,h)&&(v[h]=x[h]);S[T.options.childkey].push(v),delete x["#name"],Object.keys(x).length===1&&P in x&&!T.EXPLICIT_CHARKEY&&(x=x[P])}}return A.length>0?T.assignOrPush(S,b,x):(T.options.explicitRoot&&(M=x,x=Object.create(null),x[b]=M),T.resultObject=x,T.saxParser.ended=!0,T.emit("end",T.resultObject))}}(this),I=function(T){return function(k){var w,h;if(h=A[A.length-1],h)return h[P]+=k,T.options.explicitChildren&&T.options.preserveChildrenOrder&&T.options.charsAsChildren&&(T.options.includeWhiteChars||k.replace(/\\n/g,"").trim()!=="")&&(h[T.options.childkey]=h[T.options.childkey]||[],w={"#name":"__text__"},w[P]=k,T.options.normalize&&(w[P]=w[P].replace(/\s{2,}/g," ").trim()),h[T.options.childkey].push(w)),h}}(this),this.saxParser.ontext=I,this.saxParser.oncdata=function(T){return function(k){var w;if(w=I(k),w)return w.cdata=!0}}(this)},m.prototype.parseString=function(y,P){var I;P!=null&&typeof P=="function"&&(this.on("end",function(A){return this.reset(),P(null,A)}),this.on("error",function(A){return this.reset(),P(A)}));try{return y=y.toString(),y.trim()===""?(this.emit("end",null),!0):(y=c.stripBOM(y),this.options.async?(this.remaining=y,n(this.processAsync),this.saxParser):this.saxParser.write(y).close())}catch(A){if(I=A,this.saxParser.errThrown||this.saxParser.ended){if(this.saxParser.ended)throw I}else return this.emit("error",I),this.saxParser.errThrown=!0}},m.prototype.parseStringPromise=function(y){return new Promise(function(P){return function(I,A){return P.parseString(y,function(T,k){return T?A(T):I(k)})}}(this))},m}(t),we.parseString=function(f,m,y){var P,I,A;return y!=null?(typeof y=="function"&&(P=y),typeof m=="object"&&(I=m)):(typeof m=="function"&&(P=m),I={}),A=new we.Parser(I),A.parseString(f,P)},we.parseStringPromise=function(f,m){var y,P;return typeof m=="object"&&(y=m),P=new we.Parser(y),P.parseStringPromise(f)}}).call(we)});var hr=R(ve=>{(function(){"use strict";var c,e,t,r,i=function(a,n){for(var l in n)s.call(n,l)&&(a[l]=n[l]);function u(){this.constructor=a}return u.prototype=n.prototype,a.prototype=new u,a.__super__=n.prototype,a},s={}.hasOwnProperty;e=Ct(),c=es(),t=is(),r=pr(),ve.defaults=e.defaults,ve.processors=r,ve.ValidationError=function(a){i(n,a);function n(l){this.message=l}return n}(Error),ve.Builder=c.Builder,ve.Parser=t.Parser,ve.parseString=t.parseString,ve.parseStringPromise=t.parseStringPromise}).call(ve)});var os=R((Nn,as)=>{var jt=as.exports={};jt.feed=[["author","creator"],["dc:publisher","publisher"],["dc:creator","creator"],["dc:source","source"],["dc:title","title"],["dc:type","type"],"title","description","author","pubDate","webMaster","managingEditor","generator","link","language","copyright","lastBuildDate","docs","generator","ttl","rating","skipHours","skipDays"];jt.item=[["author","creator"],["dc:creator","creator"],["dc:date","date"],["dc:language","language"],["dc:rights","rights"],["dc:source","source"],["dc:title","title"],"title","link","pubDate","author","summary",["content:encoded","content:encoded",{includeSnippet:!0}],"enclosure","dc:creator","dc:date","comments"];var ss=function(c){return["itunes:"+c,c]};jt.podcastFeed=["author","subtitle","summary","explicit"].map(ss);jt.podcastItem=["author","subtitle","summary","explicit","duration","image","episode","image","season","keywords","episodeType"].map(ss)});var gr=R((kn,Gs)=>{Gs.exports={Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",amp:"&",AMP:"&",andand:"\u2A55",And:"\u2A53",and:"\u2227",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angmsd:"\u2221",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",apacir:"\u2A6F",ap:"\u2248",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",barwed:"\u2305",Barwed:"\u2306",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",because:"\u2235",Because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxdl:"\u2510",boxdL:"\u2555",boxDl:"\u2556",boxDL:"\u2557",boxdr:"\u250C",boxdR:"\u2552",boxDr:"\u2553",boxDR:"\u2554",boxh:"\u2500",boxH:"\u2550",boxhd:"\u252C",boxHd:"\u2564",boxhD:"\u2565",boxHD:"\u2566",boxhu:"\u2534",boxHu:"\u2567",boxhU:"\u2568",boxHU:"\u2569",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxul:"\u2518",boxuL:"\u255B",boxUl:"\u255C",boxUL:"\u255D",boxur:"\u2514",boxuR:"\u2558",boxUr:"\u2559",boxUR:"\u255A",boxv:"\u2502",boxV:"\u2551",boxvh:"\u253C",boxvH:"\u256A",boxVh:"\u256B",boxVH:"\u256C",boxvl:"\u2524",boxvL:"\u2561",boxVl:"\u2562",boxVL:"\u2563",boxvr:"\u251C",boxvR:"\u255E",boxVr:"\u255F",boxVR:"\u2560",bprime:"\u2035",breve:"\u02D8",Breve:"\u02D8",brvbar:"\xA6",bscr:"\u{1D4B7}",Bscr:"\u212C",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsolb:"\u29C5",bsol:"\\",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",cap:"\u2229",Cap:"\u22D2",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",centerdot:"\xB7",CenterDot:"\xB7",cfr:"\u{1D520}",Cfr:"\u212D",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cir:"\u25CB",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",colon:":",Colon:"\u2237",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",conint:"\u222E",Conint:"\u222F",ContourIntegral:"\u222E",copf:"\u{1D554}",Copf:"\u2102",coprod:"\u2210",Coproduct:"\u2210",copy:"\xA9",COPY:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",cross:"\u2717",Cross:"\u2A2F",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",cupbrcap:"\u2A48",cupcap:"\u2A46",CupCap:"\u224D",cup:"\u222A",Cup:"\u22D3",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",dagger:"\u2020",Dagger:"\u2021",daleth:"\u2138",darr:"\u2193",Darr:"\u21A1",dArr:"\u21D3",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",ddagger:"\u2021",ddarr:"\u21CA",DD:"\u2145",dd:"\u2146",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",diamond:"\u22C4",Diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrowBar:"\u2913",downarrow:"\u2193",DownArrow:"\u2193",Downarrow:"\u21D3",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVectorBar:"\u2956",DownLeftVector:"\u21BD",DownRightTeeVector:"\u295F",DownRightVectorBar:"\u2957",DownRightVector:"\u21C1",DownTeeArrow:"\u21A7",DownTee:"\u22A4",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",Ecirc:"\xCA",ecirc:"\xEA",ecir:"\u2256",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",edot:"\u0117",eDot:"\u2251",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp13:"\u2004",emsp14:"\u2005",emsp:"\u2003",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",escr:"\u212F",Escr:"\u2130",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",exponentiale:"\u2147",ExponentialE:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",forall:"\u2200",ForAll:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",fscr:"\u{1D4BB}",Fscr:"\u2131",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",ge:"\u2265",gE:"\u2267",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",gescc:"\u2AA9",ges:"\u2A7E",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",gg:"\u226B",Gg:"\u22D9",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gla:"\u2AA5",gl:"\u2277",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gne:"\u2A88",gnE:"\u2269",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",gtcc:"\u2AA7",gtcir:"\u2A7A",gt:">",GT:">",Gt:"\u226B",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",harrcir:"\u2948",harr:"\u2194",hArr:"\u21D4",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",hfr:"\u{1D525}",Hfr:"\u210C",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",hopf:"\u{1D559}",Hopf:"\u210D",horbar:"\u2015",HorizontalLine:"\u2500",hscr:"\u{1D4BD}",Hscr:"\u210B",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",ifr:"\u{1D526}",Ifr:"\u2111",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",Im:"\u2111",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",incare:"\u2105",in:"\u2208",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",intcal:"\u22BA",int:"\u222B",Int:"\u222C",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",iscr:"\u{1D4BE}",Iscr:"\u2110",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",lang:"\u27E8",Lang:"\u27EA",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",larrb:"\u21E4",larrbfs:"\u291F",larr:"\u2190",Larr:"\u219E",lArr:"\u21D0",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",latail:"\u2919",lAtail:"\u291B",lat:"\u2AAB",late:"\u2AAD",lates:"\u2AAD\uFE00",lbarr:"\u290C",lBarr:"\u290E",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",le:"\u2264",lE:"\u2266",LeftAngleBracket:"\u27E8",LeftArrowBar:"\u21E4",leftarrow:"\u2190",LeftArrow:"\u2190",Leftarrow:"\u21D0",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVectorBar:"\u2959",LeftDownVector:"\u21C3",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",leftrightarrow:"\u2194",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTeeArrow:"\u21A4",LeftTee:"\u22A3",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangleBar:"\u29CF",LeftTriangle:"\u22B2",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVectorBar:"\u2958",LeftUpVector:"\u21BF",LeftVectorBar:"\u2952",LeftVector:"\u21BC",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",lescc:"\u2AA8",les:"\u2A7D",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",llarr:"\u21C7",ll:"\u226A",Ll:"\u22D8",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoustache:"\u23B0",lmoust:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lne:"\u2A87",lnE:"\u2268",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",longleftarrow:"\u27F5",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftrightarrow:"\u27F7",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longmapsto:"\u27FC",longrightarrow:"\u27F6",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",lscr:"\u{1D4C1}",Lscr:"\u2112",lsh:"\u21B0",Lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",ltcc:"\u2AA6",ltcir:"\u2A79",lt:"<",LT:"<",Lt:"\u226A",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",midast:"*",midcir:"\u2AF0",mid:"\u2223",middot:"\xB7",minusb:"\u229F",minus:"\u2212",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",mscr:"\u{1D4C2}",Mscr:"\u2133",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natural:"\u266E",naturals:"\u2115",natur:"\u266E",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",nearhk:"\u2924",nearr:"\u2197",neArr:"\u21D7",nearrow:"\u2197",ne:"\u2260",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nharr:"\u21AE",nhArr:"\u21CE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlarr:"\u219A",nlArr:"\u21CD",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nleftarrow:"\u219A",nLeftarrow:"\u21CD",nleftrightarrow:"\u21AE",nLeftrightarrow:"\u21CE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",nopf:"\u{1D55F}",Nopf:"\u2115",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangle:"\u22EA",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangle:"\u22EB",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",nparallel:"\u2226",npar:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",nprec:"\u2280",npreceq:"\u2AAF\u0338",npre:"\u2AAF\u0338",nrarrc:"\u2933\u0338",nrarr:"\u219B",nrArr:"\u21CF",nrarrw:"\u219D\u0338",nrightarrow:"\u219B",nRightarrow:"\u21CF",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nvdash:"\u22AC",nvDash:"\u22AD",nVdash:"\u22AE",nVDash:"\u22AF",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwarr:"\u2196",nwArr:"\u21D6",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",Ocirc:"\xD4",ocirc:"\xF4",ocir:"\u229A",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",orarr:"\u21BB",Or:"\u2A54",or:"\u2228",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",otimesas:"\u2A36",Otimes:"\u2A37",otimes:"\u2297",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",para:"\xB6",parallel:"\u2225",par:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plus:"+",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",popf:"\u{1D561}",Popf:"\u2119",pound:"\xA3",prap:"\u2AB7",Pr:"\u2ABB",pr:"\u227A",prcue:"\u227C",precapprox:"\u2AB7",prec:"\u227A",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",pre:"\u2AAF",prE:"\u2AB3",precsim:"\u227E",prime:"\u2032",Prime:"\u2033",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportional:"\u221D",Proportion:"\u2237",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",qopf:"\u{1D562}",Qopf:"\u211A",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",quot:'"',QUOT:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",rang:"\u27E9",Rang:"\u27EB",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarr:"\u2192",Rarr:"\u21A0",rArr:"\u21D2",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",ratail:"\u291A",rAtail:"\u291C",ratio:"\u2236",rationals:"\u211A",rbarr:"\u290D",rBarr:"\u290F",RBarr:"\u2910",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",Re:"\u211C",rect:"\u25AD",reg:"\xAE",REG:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",rfr:"\u{1D52F}",Rfr:"\u211C",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrowBar:"\u21E5",rightarrow:"\u2192",RightArrow:"\u2192",Rightarrow:"\u21D2",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVectorBar:"\u2955",RightDownVector:"\u21C2",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTeeArrow:"\u21A6",RightTee:"\u22A2",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangleBar:"\u29D0",RightTriangle:"\u22B3",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVectorBar:"\u2954",RightUpVector:"\u21BE",RightVectorBar:"\u2953",RightVector:"\u21C0",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoustache:"\u23B1",rmoust:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",ropf:"\u{1D563}",Ropf:"\u211D",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",rscr:"\u{1D4C7}",Rscr:"\u211B",rsh:"\u21B1",Rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",Sc:"\u2ABC",sc:"\u227B",sccue:"\u227D",sce:"\u2AB0",scE:"\u2AB4",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdotb:"\u22A1",sdot:"\u22C5",sdote:"\u2A66",searhk:"\u2925",searr:"\u2198",seArr:"\u21D8",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",solbar:"\u233F",solb:"\u29C4",sol:"/",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",square:"\u25A1",Square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squ:"\u25A1",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",sub:"\u2282",Sub:"\u22D0",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",subset:"\u2282",Subset:"\u22D0",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succapprox:"\u2AB8",succ:"\u227B",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",sum:"\u2211",Sum:"\u2211",sung:"\u266A",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",sup:"\u2283",Sup:"\u22D1",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",supset:"\u2283",Supset:"\u22D1",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swarr:"\u2199",swArr:"\u21D9",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",therefore:"\u2234",Therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",ThinSpace:"\u2009",thinsp:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",tilde:"\u02DC",Tilde:"\u223C",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",timesbar:"\u2A31",timesb:"\u22A0",times:"\xD7",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",topbot:"\u2336",topcir:"\u2AF1",top:"\u22A4",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",trade:"\u2122",TRADE:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",uarr:"\u2191",Uarr:"\u219F",uArr:"\u21D1",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrowBar:"\u2912",uparrow:"\u2191",UpArrow:"\u2191",Uparrow:"\u21D1",UpArrowDownArrow:"\u21C5",updownarrow:"\u2195",UpDownArrow:"\u2195",Updownarrow:"\u21D5",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",upsi:"\u03C5",Upsi:"\u03D2",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTeeArrow:"\u21A5",UpTee:"\u22A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",varr:"\u2195",vArr:"\u21D5",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",vBar:"\u2AE8",Vbar:"\u2AEB",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",vdash:"\u22A2",vDash:"\u22A8",Vdash:"\u22A9",VDash:"\u22AB",Vdashl:"\u2AE6",veebar:"\u22BB",vee:"\u2228",Vee:"\u22C1",veeeq:"\u225A",vellip:"\u22EE",verbar:"|",Verbar:"\u2016",vert:"|",Vert:"\u2016",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",wedge:"\u2227",Wedge:"\u22C0",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xharr:"\u27F7",xhArr:"\u27FA",Xi:"\u039E",xi:"\u03BE",xlarr:"\u27F5",xlArr:"\u27F8",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrarr:"\u27F6",xrArr:"\u27F9",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",yuml:"\xFF",Yuml:"\u0178",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",zfr:"\u{1D537}",Zfr:"\u2128",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",zopf:"\u{1D56B}",Zopf:"\u2124",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"}});var ns=R((Fn,zs)=>{zs.exports={Aacute:"\xC1",aacute:"\xE1",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",AElig:"\xC6",aelig:"\xE6",Agrave:"\xC0",agrave:"\xE0",amp:"&",AMP:"&",Aring:"\xC5",aring:"\xE5",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",brvbar:"\xA6",Ccedil:"\xC7",ccedil:"\xE7",cedil:"\xB8",cent:"\xA2",copy:"\xA9",COPY:"\xA9",curren:"\xA4",deg:"\xB0",divide:"\xF7",Eacute:"\xC9",eacute:"\xE9",Ecirc:"\xCA",ecirc:"\xEA",Egrave:"\xC8",egrave:"\xE8",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",frac12:"\xBD",frac14:"\xBC",frac34:"\xBE",gt:">",GT:">",Iacute:"\xCD",iacute:"\xED",Icirc:"\xCE",icirc:"\xEE",iexcl:"\xA1",Igrave:"\xCC",igrave:"\xEC",iquest:"\xBF",Iuml:"\xCF",iuml:"\xEF",laquo:"\xAB",lt:"<",LT:"<",macr:"\xAF",micro:"\xB5",middot:"\xB7",nbsp:"\xA0",not:"\xAC",Ntilde:"\xD1",ntilde:"\xF1",Oacute:"\xD3",oacute:"\xF3",Ocirc:"\xD4",ocirc:"\xF4",Ograve:"\xD2",ograve:"\xF2",ordf:"\xAA",ordm:"\xBA",Oslash:"\xD8",oslash:"\xF8",Otilde:"\xD5",otilde:"\xF5",Ouml:"\xD6",ouml:"\xF6",para:"\xB6",plusmn:"\xB1",pound:"\xA3",quot:'"',QUOT:'"',raquo:"\xBB",reg:"\xAE",REG:"\xAE",sect:"\xA7",shy:"\xAD",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",szlig:"\xDF",THORN:"\xDE",thorn:"\xFE",times:"\xD7",Uacute:"\xDA",uacute:"\xFA",Ucirc:"\xDB",ucirc:"\xFB",Ugrave:"\xD9",ugrave:"\xF9",uml:"\xA8",Uuml:"\xDC",uuml:"\xFC",Yacute:"\xDD",yacute:"\xFD",yen:"\xA5",yuml:"\xFF"}});var mr=R((qn,Ys)=>{Ys.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}});var ls=R((On,Ks)=>{Ks.exports={"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}});var us=R(ht=>{"use strict";var Js=ht&&ht.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(ht,"__esModule",{value:!0});var cs=Js(ls()),Zs=String.fromCodePoint||function(c){var e="";return c>65535&&(c-=65536,e+=String.fromCharCode(c>>>10&1023|55296),c=56320|c&1023),e+=String.fromCharCode(c),e};function ea(c){return c>=55296&&c<=57343||c>1114111?"\uFFFD":(c in cs.default&&(c=cs.default[c]),Zs(c))}ht.default=ea});var yr=R(he=>{"use strict";var Ht=he&&he.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(he,"__esModule",{value:!0});he.decodeHTML=he.decodeHTMLStrict=he.decodeXML=void 0;var fr=Ht(gr()),ta=Ht(ns()),ra=Ht(mr()),ds=Ht(us()),ia=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;he.decodeXML=hs(ra.default);he.decodeHTMLStrict=hs(fr.default);function hs(c){var e=gs(c);return function(t){return String(t).replace(ia,e)}}var ps=function(c,e){return c<e?1:-1};he.decodeHTML=function(){for(var c=Object.keys(ta.default).sort(ps),e=Object.keys(fr.default).sort(ps),t=0,r=0;t<e.length;t++)c[r]===e[t]?(e[t]+=";?",r++):e[t]+=";";var i=new RegExp("&(?:"+e.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),s=gs(fr.default);function a(n){return n.substr(-1)!==";"&&(n+=";"),s(n)}return function(n){return String(n).replace(i,a)}}();function gs(c){return function(t){if(t.charAt(1)==="#"){var r=t.charAt(2);return r==="X"||r==="x"?ds.default(parseInt(t.substr(3),16)):ds.default(parseInt(t.substr(2),10))}return c[t.slice(1,-1)]||t}}});var Pr=R(ae=>{"use strict";var ms=ae&&ae.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(ae,"__esModule",{value:!0});ae.escapeUTF8=ae.escape=ae.encodeNonAsciiHTML=ae.encodeHTML=ae.encodeXML=void 0;var sa=ms(mr()),fs=Es(sa.default),ys=Ps(fs);ae.encodeXML=bs(fs);var aa=ms(gr()),Er=Es(aa.default),oa=Ps(Er);ae.encodeHTML=la(Er,oa);ae.encodeNonAsciiHTML=bs(Er);function Es(c){return Object.keys(c).sort().reduce(function(e,t){return e[c[t]]="&"+t+";",e},{})}function Ps(c){for(var e=[],t=[],r=0,i=Object.keys(c);r<i.length;r++){var s=i[r];s.length===1?e.push("\\"+s):t.push(s)}e.sort();for(var a=0;a<e.length-1;a++){for(var n=a;n<e.length-1&&e[n].charCodeAt(1)+1===e[n+1].charCodeAt(1);)n+=1;var l=1+n-a;l<3||e.splice(a,l,e[a]+"-"+e[n])}return t.unshift("["+e.join("")+"]"),new RegExp(t.join("|"),"g")}var ws=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,na=String.prototype.codePointAt!=null?function(c){return c.codePointAt(0)}:function(c){return(c.charCodeAt(0)-55296)*1024+c.charCodeAt(1)-56320+65536};function Xt(c){return"&#x"+(c.length>1?na(c):c.charCodeAt(0)).toString(16).toUpperCase()+";"}function la(c,e){return function(t){return t.replace(e,function(r){return c[r]}).replace(ws,Xt)}}var vs=new RegExp(ys.source+"|"+ws.source,"g");function ca(c){return c.replace(vs,Xt)}ae.escape=ca;function ua(c){return c.replace(ys,Xt)}ae.escapeUTF8=ua;function bs(c){return function(e){return e.replace(vs,function(t){return c[t]||Xt(t)})}}});var xs=R(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.decodeXMLStrict=_.decodeHTML5Strict=_.decodeHTML4Strict=_.decodeHTML5=_.decodeHTML4=_.decodeHTMLStrict=_.decodeHTML=_.decodeXML=_.encodeHTML5=_.encodeHTML4=_.escapeUTF8=_.escape=_.encodeNonAsciiHTML=_.encodeHTML=_.encodeXML=_.encode=_.decodeStrict=_.decode=void 0;var Wt=yr(),Ss=Pr();function da(c,e){return(!e||e<=0?Wt.decodeXML:Wt.decodeHTML)(c)}_.decode=da;function pa(c,e){return(!e||e<=0?Wt.decodeXML:Wt.decodeHTMLStrict)(c)}_.decodeStrict=pa;function ha(c,e){return(!e||e<=0?Ss.encodeXML:Ss.encodeHTML)(c)}_.encode=ha;var Oe=Pr();Object.defineProperty(_,"encodeXML",{enumerable:!0,get:function(){return Oe.encodeXML}});Object.defineProperty(_,"encodeHTML",{enumerable:!0,get:function(){return Oe.encodeHTML}});Object.defineProperty(_,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Oe.encodeNonAsciiHTML}});Object.defineProperty(_,"escape",{enumerable:!0,get:function(){return Oe.escape}});Object.defineProperty(_,"escapeUTF8",{enumerable:!0,get:function(){return Oe.escapeUTF8}});Object.defineProperty(_,"encodeHTML4",{enumerable:!0,get:function(){return Oe.encodeHTML}});Object.defineProperty(_,"encodeHTML5",{enumerable:!0,get:function(){return Oe.encodeHTML}});var Ae=yr();Object.defineProperty(_,"decodeXML",{enumerable:!0,get:function(){return Ae.decodeXML}});Object.defineProperty(_,"decodeHTML",{enumerable:!0,get:function(){return Ae.decodeHTML}});Object.defineProperty(_,"decodeHTMLStrict",{enumerable:!0,get:function(){return Ae.decodeHTMLStrict}});Object.defineProperty(_,"decodeHTML4",{enumerable:!0,get:function(){return Ae.decodeHTML}});Object.defineProperty(_,"decodeHTML5",{enumerable:!0,get:function(){return Ae.decodeHTML}});Object.defineProperty(_,"decodeHTML4Strict",{enumerable:!0,get:function(){return Ae.decodeHTMLStrict}});Object.defineProperty(_,"decodeHTML5Strict",{enumerable:!0,get:function(){return Ae.decodeHTMLStrict}});Object.defineProperty(_,"decodeXMLStrict",{enumerable:!0,get:function(){return Ae.decodeXML}})});var Ds=R((Un,Ts)=>{var be=Ts.exports={},ga=xs(),ma=hr();be.stripHtml=function(c){return c=c.replace(/([^\n])<\/?(h|br|p|ul|ol|li|blockquote|section|table|tr|div)(?:.|\n)*?>([^\n])/gm,`$1
$3`),c=c.replace(/<(?:.|\n)*?>/gm,""),c};be.getSnippet=function(c){return ga.decodeHTML(be.stripHtml(c)).trim()};be.getLink=function(c,e,t){if(c){for(let r=0;r<c.length;++r)if(c[r].$.rel===e)return c[r].$.href;if(c[t])return c[t].$.href}};be.getContent=function(c){return typeof c._=="string"?c._:typeof c=="object"?new ma.Builder({headless:!0,explicitRoot:!0,rootName:"div",renderOpts:{pretty:!1}}).buildObject(c):c};be.copyFromXML=function(c,e,t){t.forEach(function(r){let i=r,s=r,a={};Array.isArray(r)&&(i=r[0],s=r[1],r.length>2&&(a=r[2]));let{keepArray:n,includeSnippet:l}=a;c[i]!==void 0&&(e[s]=n?c[i]:c[i][0]),e[s]&&typeof e[s]._=="string"&&(e[s]=e[s]._),l&&e[s]&&typeof e[s]=="string"&&(e[s+"Snippet"]=be.getSnippet(e[s]))})};be.maybePromisify=function(c,e){return c?e.then(t=>setTimeout(()=>c(null,t)),t=>setTimeout(()=>c(t))):e};var fa="utf8",ya=/(encoding|charset)\s*=\s*(\S+)/,Ea=["ascii","utf8","utf16le","ucs2","base64","latin1","binary","hex"],Pa={"utf-8":"utf8","iso-8859-1":"latin1"};be.getEncodingFromContentType=function(c){c=c||"";let t=(c.match(ya)||[])[2]||"";return t=t.toLowerCase(),t=Pa[t]||t,(!t||Ea.indexOf(t)===-1)&&(t=fa),t}});var Ms=R((Bn,Cs)=>{"use strict";var wa=require("http"),va=require("https"),ba=hr(),Is=require("url"),Gt=os(),te=Ds(),Sa={"User-Agent":"rss-parser",Accept:"application/rss+xml"},xa=5,Ta=6e4,wr=class{constructor(e={}){e.headers=e.headers||{},e.xml2js=e.xml2js||{},e.customFields=e.customFields||{},e.customFields.item=e.customFields.item||[],e.customFields.feed=e.customFields.feed||[],e.requestOptions=e.requestOptions||{},e.maxRedirects||(e.maxRedirects=xa),e.timeout||(e.timeout=Ta),this.options=e,this.xmlParser=new ba.Parser(this.options.xml2js)}parseString(e,t){let r=new Promise((i,s)=>{this.xmlParser.parseString(e,(a,n)=>{if(a)return s(a);if(!n)return s(new Error("Unable to parse XML."));let l=null;if(n.feed)l=this.buildAtomFeed(n);else if(n.rss&&n.rss.$&&n.rss.$.version&&n.rss.$.version.match(/^2/))l=this.buildRSS2(n);else if(n["rdf:RDF"])l=this.buildRSS1(n);else if(n.rss&&n.rss.$&&n.rss.$.version&&n.rss.$.version.match(/0\.9/))l=this.buildRSS0_9(n);else if(n.rss&&this.options.defaultRSS)switch(this.options.defaultRSS){case .9:l=this.buildRSS0_9(n);break;case 1:l=this.buildRSS1(n);break;case 2:l=this.buildRSS2(n);break;default:return s(new Error("default RSS version not recognized."))}else return s(new Error("Feed not recognized as RSS 1 or 2."));i(l)})});return r=te.maybePromisify(t,r),r}parseURL(e,t,r=0){let i="",s=e.indexOf("https")===0?va.get:wa.get,a=Is.parse(e),n=Object.assign({},Sa,this.options.headers),l=null,u=new Promise((g,f)=>{let m=Object.assign({headers:n},a,this.options.requestOptions);s(m,P=>{if(this.options.maxRedirects&&P.statusCode>=300&&P.statusCode<400&&P.headers.location){if(r===this.options.maxRedirects)return f(new Error("Too many redirects"));{let A=Is.resolve(e,P.headers.location);return this.parseURL(A,null,r+1).then(g,f)}}else if(P.statusCode>=300)return f(new Error("Status code "+P.statusCode));let I=te.getEncodingFromContentType(P.headers["content-type"]);P.setEncoding(I),P.on("data",A=>{i+=A}),P.on("end",()=>this.parseString(i).then(g,f))}).on("error",f),l=setTimeout(()=>f(new Error("Request timed out after "+this.options.timeout+"ms")),this.options.timeout)}).then(g=>(clearTimeout(l),Promise.resolve(g)),g=>(clearTimeout(l),Promise.reject(g)));return u=te.maybePromisify(t,u),u}buildAtomFeed(e){let t={items:[]};if(te.copyFromXML(e.feed,t,this.options.customFields.feed),e.feed.link&&(t.link=te.getLink(e.feed.link,"alternate",0),t.feedUrl=te.getLink(e.feed.link,"self",1)),e.feed.title){let r=e.feed.title[0]||"";r._&&(r=r._),r&&(t.title=r)}return e.feed.updated&&(t.lastBuildDate=e.feed.updated[0]),t.items=(e.feed.entry||[]).map(r=>this.parseItemAtom(r)),t}parseItemAtom(e){let t={};if(te.copyFromXML(e,t,this.options.customFields.item),e.title){let r=e.title[0]||"";r._&&(r=r._),r&&(t.title=r)}return e.link&&e.link.length&&(t.link=te.getLink(e.link,"alternate",0)),e.published&&e.published.length&&e.published[0].length&&(t.pubDate=new Date(e.published[0]).toISOString()),!t.pubDate&&e.updated&&e.updated.length&&e.updated[0].length&&(t.pubDate=new Date(e.updated[0]).toISOString()),e.author&&e.author.length&&e.author[0].name&&e.author[0].name.length&&(t.author=e.author[0].name[0]),e.content&&e.content.length&&(t.content=te.getContent(e.content[0]),t.contentSnippet=te.getSnippet(t.content)),e.summary&&e.summary.length&&(t.summary=te.getContent(e.summary[0])),e.id&&(t.id=e.id[0]),this.setISODate(t),t}buildRSS0_9(e){var t=e.rss.channel[0],r=t.item;return this.buildRSS(t,r)}buildRSS1(e){e=e["rdf:RDF"];let t=e.channel[0],r=e.item;return this.buildRSS(t,r)}buildRSS2(e){let t=e.rss.channel[0],r=t.item,i=this.buildRSS(t,r);return e.rss.$&&e.rss.$["xmlns:itunes"]&&this.decorateItunes(i,t),i}buildRSS(e,t){t=t||[];let r={items:[]},i=Gt.feed.concat(this.options.customFields.feed),s=Gt.item.concat(this.options.customFields.item);if(e["atom:link"]&&e["atom:link"][0]&&e["atom:link"][0].$&&(r.feedUrl=e["atom:link"][0].$.href),e.image&&e.image[0]&&e.image[0].url){r.image={};let n=e.image[0];n.link&&(r.image.link=n.link[0]),n.url&&(r.image.url=n.url[0]),n.title&&(r.image.title=n.title[0]),n.width&&(r.image.width=n.width[0]),n.height&&(r.image.height=n.height[0])}let a=this.generatePaginationLinks(e);return Object.keys(a).length&&(r.paginationLinks=a),te.copyFromXML(e,r,i),r.items=t.map(n=>this.parseItemRss(n,s)),r}parseItemRss(e,t){let r={};return te.copyFromXML(e,r,t),e.enclosure&&(r.enclosure=e.enclosure[0].$),e.description&&(r.content=te.getContent(e.description[0]),r.contentSnippet=te.getSnippet(r.content)),e.guid&&(r.guid=e.guid[0],r.guid._&&(r.guid=r.guid._)),e.$&&e.$["rdf:about"]&&(r["rdf:about"]=e.$["rdf:about"]),e.category&&(r.categories=e.category),this.setISODate(r),r}decorateItunes(e,t){let r=t.item||[],i=[];if(e.itunes={},t["itunes:owner"]){let s={};t["itunes:owner"][0]["itunes:name"]&&(s.name=t["itunes:owner"][0]["itunes:name"][0]),t["itunes:owner"][0]["itunes:email"]&&(s.email=t["itunes:owner"][0]["itunes:email"][0]),e.itunes.owner=s}if(t["itunes:image"]){let s;s=t["itunes:image"][0]&&t["itunes:image"][0].$&&t["itunes:image"][0].$.href?t["itunes:image"][0].$.href:null,s&&(e.itunes.image=s)}if(t["itunes:category"]){let s=t["itunes:category"].map(a=>({name:a&&a.$&&a.$.text,subs:a["itunes:category"]?a["itunes:category"].map(n=>({name:n&&n.$&&n.$.text})):null}));e.itunes.categories=s.map(a=>a.name),e.itunes.categoriesWithSubs=s}if(t["itunes:keywords"])if(t["itunes:keywords"].length>1)e.itunes.keywords=t["itunes:keywords"].map(s=>s&&s.$&&s.$.text);else{let s=t["itunes:keywords"][0];s&&typeof s._=="string"&&(s=s._),s&&s.$&&s.$.text?e.itunes.keywords=s.$.text.split(","):typeof s=="string"&&(e.itunes.keywords=s.split(","))}te.copyFromXML(t,e.itunes,Gt.podcastFeed),r.forEach((s,a)=>{let n=e.items[a];n.itunes={},te.copyFromXML(s,n.itunes,Gt.podcastItem);let l=s["itunes:image"];l&&l[0]&&l[0].$&&l[0].$.href&&(n.itunes.image=l[0].$.href)})}setISODate(e){let t=e.pubDate||e.date;if(t)try{e.isoDate=new Date(t.trim()).toISOString()}catch(r){}}generatePaginationLinks(e){if(!e["atom:link"])return{};let t=["self","first","next","prev","last"];return e["atom:link"].reduce((r,i)=>(!i.$||!t.includes(i.$.rel)||(r[i.$.rel]=i.$.href),r),{})}};Cs.exports=wr});var vr=R((Vn,As)=>{"use strict";As.exports=Ms()});var Ia={};js(Ia,{default:()=>Kt});module.exports=Hs(Ia);var bt=require("obsidian");var fe={dataFolderPath:".obsidian/plugins/podcast-player/data",defaultPlaybackSettings:{volume:1,playbackSpeed:1,skipIntroSeconds:0,skipOutroSeconds:0},autoDownload:!1,maxCacheEpisodes:50,feedUpdateInterval:60,enableNotifications:!0};var ne=require("obsidian");var tr=class c{constructor(){this.logLevel=1;this.prefix="[Podcast Player]"}static getInstance(){return c.instance||(c.instance=new c),c.instance}setLogLevel(e){this.logLevel=e}getLogLevel(){return this.logLevel}debug(e,...t){this.logLevel<=0&&console.debug(`${this.prefix} [DEBUG]`,e,...t)}info(e,...t){this.logLevel<=1&&console.info(`${this.prefix} [INFO]`,e,...t)}warn(e,...t){this.logLevel<=2&&console.warn(`${this.prefix} [WARN]`,e,...t)}error(e,t,...r){this.logLevel<=3&&(t instanceof Error?console.error(`${this.prefix} [ERROR]`,e,t.message,t.stack,...r):console.error(`${this.prefix} [ERROR]`,e,t,...r))}methodEntry(e,t,...r){this.debug(`${e}.${t}() called`,...r)}methodExit(e,t,r){this.debug(`${e}.${t}() completed`,r)}},o=tr.getInstance();var Xs=require("obsidian"),_e=class extends Error{constructor(t,r){super(t);this.code=r;this.name="PodcastPlayerError"}},ue=class extends _e{constructor(t,r,i){super(t,"FEED_PARSE_ERROR");this.feedUrl=r;this.cause=i;this.name="FeedParseError"}},ce=class extends _e{constructor(t,r,i){super(t,"NETWORK_ERROR");this.url=r;this.cause=i;this.name="NetworkError"}},Z=class extends _e{constructor(t,r,i){super(t,"AUDIO_PLAYBACK_ERROR");this.audioUrl=r;this.cause=i;this.name="AudioPlaybackError"}},$=class extends _e{constructor(t,r){super(t,"STORAGE_ERROR");this.path=r;this.name="StorageError"}};async function xt(c,e={}){let{maxRetries:t=3,initialDelay:r=1e3,maxDelay:i=1e4,backoffMultiplier:s=2}=e,a,n=r;for(let l=0;l<=t;l++)try{return await c()}catch(u){a=u,l<t&&(o.warn(`Attempt ${l+1} failed, retrying in ${n}ms...`,u),await Ws(n),n=Math.min(n*s,i))}throw a}function Ws(c){return new Promise(e=>setTimeout(e,c))}function Cr(c,e){try{return JSON.parse(c)}catch(t){return o.warn("Failed to parse JSON",t),e}}var je=class{constructor(e,t){this.vault=e,this.basePath=(0,ne.normalizePath)(t),this.structure=this.buildStructure()}buildStructure(){return{root:this.basePath,subscriptions:(0,ne.normalizePath)(`${this.basePath}/subscriptions`),progress:(0,ne.normalizePath)(`${this.basePath}/progress`),playlists:(0,ne.normalizePath)(`${this.basePath}/playlists`),queues:(0,ne.normalizePath)(`${this.basePath}/queues`),cache:(0,ne.normalizePath)(`${this.basePath}/cache`),cacheFeed:(0,ne.normalizePath)(`${this.basePath}/cache/feeds`),cacheImages:(0,ne.normalizePath)(`${this.basePath}/cache/images`),backups:(0,ne.normalizePath)(`${this.basePath}/backups`)}}getStructure(){return{...this.structure}}getBasePath(){return this.basePath}updateBasePath(e){this.basePath=(0,ne.normalizePath)(e),this.structure=this.buildStructure()}async ensureDirectories(){o.info("Ensuring data directories exist",this.basePath);try{let e=this.vault.adapter;await e.exists(this.basePath)||(o.info("Creating base directory",this.basePath),await e.mkdir(this.basePath));let t=[this.structure.subscriptions,this.structure.progress,this.structure.playlists,this.structure.queues,this.structure.cache,this.structure.cacheFeed,this.structure.cacheImages,this.structure.backups];for(let r of t)await e.exists(r)||(o.debug("Creating directory",r),await e.mkdir(r));o.info("Data directories ready")}catch(e){throw o.error("Failed to create data directories",e),new $("Failed to create data directories",this.basePath)}}getFilePath(e,t){let r=this.structure[e];return(0,ne.normalizePath)(`${r}/${t}`)}async directoryExists(e){try{return await this.vault.adapter.exists(e)}catch(t){return o.error("Failed to check directory existence",t),!1}}async fileExists(e){try{return await this.vault.adapter.exists(e)}catch(t){return o.error("Failed to check file existence",t),!1}}async listFiles(e){let t=this.structure[e];try{let r=this.vault.adapter;return await r.exists(t)?(await r.list(t)).files:[]}catch(r){throw o.error("Failed to list files",r),new $(`Failed to list files in ${t}`,t)}}async deleteFile(e){try{await this.vault.adapter.remove(e),o.debug("Deleted file",e)}catch(t){throw o.error("Failed to delete file",t),new $(`Failed to delete file ${e}`,e)}}async createBackup(e,t){try{let r=await this.vault.adapter.read(e),i=new Date().toISOString().replace(/[:.]/g,"-"),s=t||`backup-${i}.json`,a=this.getFilePath("backups",s);return await this.vault.adapter.write(a,r),o.info("Created backup",a),a}catch(r){throw o.error("Failed to create backup",r),new $(`Failed to create backup of ${e}`,e)}}async cleanupOldBackups(e=5){try{let t=await this.listFiles("backups");if(t.length<=e)return;let r=await Promise.all(t.map(async s=>{let a=await this.vault.adapter.stat(s);return{file:s,mtime:(a==null?void 0:a.mtime)||0}}));r.sort((s,a)=>a.mtime-s.mtime);let i=r.slice(e);for(let{file:s}of i)await this.deleteFile(s),o.debug("Deleted old backup",s);o.info(`Cleaned up ${i.length} old backups`)}catch(t){o.error("Failed to cleanup old backups",t)}}async getDirectorySize(e){try{let t=await this.listFiles(e),r=0;for(let i of t){let s=await this.vault.adapter.stat(i);r+=(s==null?void 0:s.size)||0}return r}catch(t){return o.error("Failed to get directory size",t),0}}};var Tt=require("obsidian");var He=class{constructor(e,t,r="json"){this.vault=e,this.pathManager=t,this.format=r}async readJson(e,t){try{let r=this.vault.adapter;if(!await r.exists(e))return o.debug("File does not exist, returning fallback",e),t;let i=await r.read(e),s=Cr(i,t);return o.debug("Read JSON file",e),s}catch(r){throw o.error("Failed to read JSON file",r),new $(`Failed to read file ${e}`,e)}}async writeJson(e,t,r=!0){try{let i=this.vault.adapter;if(r&&await i.exists(e))try{await this.pathManager.createBackup(e)}catch(a){o.warn("Failed to create backup, continuing",a)}let s=JSON.stringify(t,null,2);await i.write(e,s),o.debug("Wrote JSON file",e)}catch(i){throw o.error("Failed to write JSON file",i),new $(`Failed to write file ${e}`,e)}}async deleteFile(e){try{await this.vault.adapter.remove(e),o.debug("Deleted file",e)}catch(t){throw o.error("Failed to delete file",t),new $(`Failed to delete file ${e}`,e)}}async fileExists(e){try{return await this.vault.adapter.exists(e)}catch(t){return o.error("Failed to check file existence",t),!1}}async listFiles(e){try{let t=this.vault.adapter;return await t.exists(e)?(await t.list(e)).files:[]}catch(t){throw o.error("Failed to list files",t),new $(`Failed to list files in ${e}`,e)}}},ye=class extends He{constructor(e,t,r,i="json"){super(e,t,i),this.filePath=(0,Tt.normalizePath)(r)}async load(){o.methodEntry("SingleFileStore","load",this.filePath);let e=await this.readJson(this.filePath,this.getDefaultValue());return this.validate(e)?(o.methodExit("SingleFileStore","load"),e):(o.warn("Data validation failed, using default value",this.filePath),this.getDefaultValue())}async save(e){if(o.methodEntry("SingleFileStore","save",this.filePath),!this.validate(e))throw new $("Data validation failed",this.filePath);await this.writeJson(this.filePath,e),o.methodExit("SingleFileStore","save")}async clear(){o.methodEntry("SingleFileStore","clear",this.filePath);let e=this.getDefaultValue();await this.save(e),o.methodExit("SingleFileStore","clear")}async delete(){await this.fileExists(this.filePath)&&await this.deleteFile(this.filePath)}},Ee=class extends He{constructor(e,t,r,i="json"){super(e,t,i),this.dirPath=(0,Tt.normalizePath)(r)}getItemFilePath(e){return(0,Tt.normalizePath)(`${this.dirPath}/${e}.json`)}async loadItem(e,t){let r=this.getItemFilePath(e);return await this.readJson(r,t)}async saveItem(e,t){let r=this.getItemFilePath(e);await this.writeJson(r,t)}async deleteItem(e){let t=this.getItemFilePath(e);await this.fileExists(t)&&await this.deleteFile(t)}async listItemIds(){return(await this.listFiles(this.dirPath)).filter(t=>t.endsWith(".json")).map(t=>(t.split("/").pop()||"").replace(".json",""))}async clear(){o.methodEntry("MultiFileStore","clear",this.dirPath);let e=await this.listFiles(this.dirPath);for(let t of e)await this.deleteFile(t);o.methodExit("MultiFileStore","clear")}};var Xe=class Xe extends ye{constructor(e,t){let r=t.getFilePath("subscriptions","subscriptions.json");super(e,t,r)}validate(e){if(!e||typeof e!="object")return o.warn("Invalid subscription data: not an object"),!1;if(!Array.isArray(e.podcasts))return o.warn("Invalid subscription data: podcasts is not an array"),!1;if(typeof e.version!="number")return o.warn("Invalid subscription data: version is not a number"),!1;for(let t of e.podcasts)if(!this.validatePodcast(t))return o.warn("Invalid podcast in subscription data",t),!1;return!0}validatePodcast(e){if(!e||typeof e!="object")return!1;let t=["id","title","feedUrl","subscribedAt"];for(let r of t)if(!(r in e))return o.warn(`Missing required field in podcast: ${r}`),!1;return!0}getDefaultValue(){return{podcasts:[],version:Xe.CURRENT_VERSION}}async getAllPodcasts(){o.methodEntry("SubscriptionStore","getAllPodcasts");let e=await this.load();return o.methodExit("SubscriptionStore","getAllPodcasts"),e.podcasts}async getPodcast(e){o.methodEntry("SubscriptionStore","getPodcast",e);let r=(await this.load()).podcasts.find(i=>i.id===e)||null;return o.methodExit("SubscriptionStore","getPodcast"),r}async getPodcastByFeedUrl(e){o.methodEntry("SubscriptionStore","getPodcastByFeedUrl",e);let r=(await this.load()).podcasts.find(i=>i.feedUrl===e)||null;return o.methodExit("SubscriptionStore","getPodcastByFeedUrl"),r}async addPodcast(e){if(o.methodEntry("SubscriptionStore","addPodcast",e.id),!this.validatePodcast(e))throw new $("Invalid podcast data",this.filePath);let t=await this.load(),r=t.podcasts.findIndex(i=>i.id===e.id);r!==-1?(o.warn("Podcast already exists, updating instead",e.id),t.podcasts[r]=e):t.podcasts.push(e),await this.save(t),o.methodExit("SubscriptionStore","addPodcast")}async updatePodcast(e){if(o.methodEntry("SubscriptionStore","updatePodcast",e.id),!this.validatePodcast(e))throw new $("Invalid podcast data",this.filePath);let t=await this.load(),r=t.podcasts.findIndex(i=>i.id===e.id);if(r===-1)throw new $(`Podcast not found: ${e.id}`,this.filePath);t.podcasts[r]=e,await this.save(t),o.methodExit("SubscriptionStore","updatePodcast")}async removePodcast(e){o.methodEntry("SubscriptionStore","removePodcast",e);let t=await this.load(),r=t.podcasts.findIndex(i=>i.id===e);if(r===-1){o.warn("Podcast not found, nothing to remove",e);return}t.podcasts.splice(r,1),await this.save(t),o.methodExit("SubscriptionStore","removePodcast")}async isSubscribed(e){return(await this.load()).podcasts.some(r=>r.id===e)}async isSubscribedByFeedUrl(e){return(await this.load()).podcasts.some(r=>r.feedUrl===e)}async getSubscriptionCount(){return(await this.load()).podcasts.length}async updatePodcastEpisodes(e,t){o.methodEntry("SubscriptionStore","updatePodcastEpisodes",e);let r=await this.load(),i=r.podcasts.find(s=>s.id===e);if(!i)throw new $(`Podcast not found: ${e}`,this.filePath);i.episodes=t,i.lastFetchedAt=new Date,await this.save(r),o.methodExit("SubscriptionStore","updatePodcastEpisodes")}async updatePodcastSettings(e,t){o.methodEntry("SubscriptionStore","updatePodcastSettings",e);let r=await this.load(),i=r.podcasts.find(s=>s.id===e);if(!i)throw new $(`Podcast not found: ${e}`,this.filePath);i.settings=t,await this.save(r),o.methodExit("SubscriptionStore","updatePodcastSettings")}async getPodcastsNeedingUpdate(e){let t=await this.load(),r=Date.now();return t.podcasts.filter(i=>{if(!i.lastFetchedAt)return!0;let s=new Date(i.lastFetchedAt).getTime();return r-s>=e})}async searchPodcasts(e){let t=await this.load(),r=e.toLowerCase();return t.podcasts.filter(i=>{var n;let s=i.title.toLowerCase().includes(r),a=(n=i.author)==null?void 0:n.toLowerCase().includes(r);return s||a})}async exportSubscriptions(){o.methodEntry("SubscriptionStore","exportSubscriptions");let e=await this.load();return o.methodExit("SubscriptionStore","exportSubscriptions"),e}async importSubscriptions(e,t=!1){if(o.methodEntry("SubscriptionStore","importSubscriptions",`replace=${t}`),!this.validate(e))throw new $("Invalid import data",this.filePath);if(t)await this.save(e);else{let i=[...(await this.load()).podcasts];for(let s of e.podcasts){let a=i.findIndex(n=>n.id===s.id);a!==-1?i[a]=s:i.push(s)}await this.save({podcasts:i,version:Xe.CURRENT_VERSION})}o.methodExit("SubscriptionStore","importSubscriptions")}};Xe.CURRENT_VERSION=1;var We=Xe;function Mr(c){return Math.max(.5,Math.min(3,c))}function Ar(c){return Math.max(0,Math.min(1,c))}var rr=[.5,.75,1,1.25,1.5,1.75,2,2.5,3];function Lr(c){let e=rr.findIndex(t=>t>c);return e===-1?rr[0]:rr[e]}var Nr={SHORT:15,MEDIUM:30,LONG:60};function kr(c,e,t=Nr.SHORT){return Math.min(e,c+t)}function Fr(c,e=Nr.SHORT){return Math.max(0,c-e)}function Ge(c,e,t=30){return e<=0?!1:e-c<=t}var ze=class ze extends ye{constructor(e,t){let r=t.getFilePath("progress","progress.json");super(e,t,r)}validate(e){if(!e||typeof e!="object")return o.warn("Invalid progress data: not an object"),!1;if(!Array.isArray(e.progress))return o.warn("Invalid progress data: progress is not an array"),!1;if(typeof e.version!="number")return o.warn("Invalid progress data: version is not a number"),!1;for(let t of e.progress)if(!this.validateProgress(t))return o.warn("Invalid progress entry in data",t),!1;return!0}validateProgress(e){if(!e||typeof e!="object")return!1;let t=["episodeId","podcastId","position","duration","lastPlayedAt"];for(let r of t)if(!(r in e))return o.warn(`Missing required field in progress: ${r}`),!1;return!(typeof e.position!="number"||e.position<0||typeof e.duration!="number"||e.duration<0||typeof e.completed!="boolean")}getDefaultValue(){return{progress:[],version:ze.CURRENT_VERSION}}async getProgress(e){o.methodEntry("ProgressStore","getProgress",e);let r=(await this.load()).progress.find(i=>i.episodeId===e)||null;return o.methodExit("ProgressStore","getProgress"),r}async getPodcastProgress(e){o.methodEntry("ProgressStore","getPodcastProgress",e);let r=(await this.load()).progress.filter(i=>i.podcastId===e);return o.methodExit("ProgressStore","getPodcastProgress"),r}async getAllProgress(){o.methodEntry("ProgressStore","getAllProgress");let e=await this.load();return o.methodExit("ProgressStore","getAllProgress"),e.progress}async updateProgress(e){if(o.methodEntry("ProgressStore","updateProgress",e.episodeId),!this.validateProgress(e))throw new $("Invalid progress data",this.filePath);let t=await this.load(),r=t.progress.findIndex(i=>i.episodeId===e.episodeId);e.completed=Ge(e.position,e.duration),r!==-1?t.progress[r]=e:t.progress.push(e),await this.save(t),o.methodExit("ProgressStore","updateProgress")}async updatePosition(e,t,r,i){o.methodEntry("ProgressStore","updatePosition",e);let s=await this.getProgress(e),a={episodeId:e,podcastId:t,position:r,duration:i,lastPlayedAt:new Date,completed:Ge(r,i)};await this.updateProgress(a),o.methodExit("ProgressStore","updatePosition")}async markCompleted(e,t,r){o.methodEntry("ProgressStore","markCompleted",e);let i={episodeId:e,podcastId:t,position:r,duration:r,lastPlayedAt:new Date,completed:!0};await this.updateProgress(i),o.methodExit("ProgressStore","markCompleted")}async resetProgress(e){o.methodEntry("ProgressStore","resetProgress",e);let t=await this.load(),r=t.progress.findIndex(i=>i.episodeId===e);r!==-1&&(t.progress.splice(r,1),await this.save(t)),o.methodExit("ProgressStore","resetProgress")}async removeProgress(e){o.methodEntry("ProgressStore","removeProgress",e);let t=await this.load(),r=t.progress.findIndex(i=>i.episodeId===e);r!==-1&&(t.progress.splice(r,1),await this.save(t)),o.methodExit("ProgressStore","removeProgress")}async removePodcastProgress(e){o.methodEntry("ProgressStore","removePodcastProgress",e);let t=await this.load();t.progress=t.progress.filter(r=>r.podcastId!==e),await this.save(t),o.methodExit("ProgressStore","removePodcastProgress")}async getInProgressEpisodes(){return(await this.load()).progress.filter(t=>!t.completed&&t.position>0)}async getCompletedEpisodes(){return(await this.load()).progress.filter(t=>t.completed)}async getRecentlyPlayed(e=10){return[...(await this.load()).progress].sort((i,s)=>{let a=new Date(i.lastPlayedAt).getTime();return new Date(s.lastPlayedAt).getTime()-a}).slice(0,e)}async getCompletionPercentage(e){let t=await this.getProgress(e);return!t||t.duration<=0?0:Math.min(100,Math.max(0,t.position/t.duration*100))}async getTotalListeningTime(){return(await this.load()).progress.reduce((t,r)=>t+r.position,0)}async getPodcastStatistics(e){let t=await this.getPodcastProgress(e);return{totalEpisodes:t.length,completedEpisodes:t.filter(r=>r.completed).length,inProgressEpisodes:t.filter(r=>!r.completed&&r.position>0).length,totalListeningTime:t.reduce((r,i)=>r+i.position,0)}}async cleanupOldProgress(e=100){o.methodEntry("ProgressStore","cleanupOldProgress",`keepRecentCount=${e}`);let t=await this.load(),r=[...t.progress].sort((i,s)=>{let a=new Date(i.lastPlayedAt).getTime();return new Date(s.lastPlayedAt).getTime()-a});t.progress=r.slice(0,e),await this.save(t),o.methodExit("ProgressStore","cleanupOldProgress")}async exportProgress(){o.methodEntry("ProgressStore","exportProgress");let e=await this.load();return o.methodExit("ProgressStore","exportProgress"),e}async importProgress(e,t=!1){if(o.methodEntry("ProgressStore","importProgress",`replace=${t}`),!this.validate(e))throw new $("Invalid import data",this.filePath);if(t)await this.save(e);else{let i=[...(await this.load()).progress];for(let s of e.progress){let a=i.findIndex(n=>n.episodeId===s.episodeId);if(a!==-1){let n=new Date(i[a].lastPlayedAt).getTime();new Date(s.lastPlayedAt).getTime()>n&&(i[a]=s)}else i.push(s)}await this.save({progress:i,version:ze.CURRENT_VERSION})}o.methodExit("ProgressStore","importProgress")}};ze.CURRENT_VERSION=1;var Ye=ze;var qr=require("obsidian");var Ke=class extends ye{constructor(e,t){let r=t.getFilePath("root","settings.json");super(e,t,r)}validate(e){if(!e||typeof e!="object")return o.warn("Invalid settings data: not an object"),!1;if(typeof e.dataFolderPath!="string")return o.warn("Invalid settings: dataFolderPath is not a string"),!1;if(!e.defaultPlaybackSettings||typeof e.defaultPlaybackSettings!="object")return o.warn("Invalid settings: defaultPlaybackSettings is not an object"),!1;let t=e.defaultPlaybackSettings;return typeof t.volume!="number"||typeof t.playbackSpeed!="number"||typeof t.skipIntroSeconds!="number"?(o.warn("Invalid settings: defaultPlaybackSettings has invalid fields"),!1):typeof e.autoDownload!="boolean"?(o.warn("Invalid settings: autoDownload is not a boolean"),!1):typeof e.enableNotifications!="boolean"?(o.warn("Invalid settings: enableNotifications is not a boolean"),!1):typeof e.maxCacheEpisodes!="number"||e.maxCacheEpisodes<0?(o.warn("Invalid settings: maxCacheEpisodes is invalid"),!1):typeof e.feedUpdateInterval!="number"||e.feedUpdateInterval<0?(o.warn("Invalid settings: feedUpdateInterval is invalid"),!1):!0}getDefaultValue(){return{...fe}}async getSettings(){o.methodEntry("SettingsStore","getSettings");let e=await this.load();return o.methodExit("SettingsStore","getSettings"),e}async updateSettings(e){o.methodEntry("SettingsStore","updateSettings"),await this.save(e),o.methodExit("SettingsStore","updateSettings")}async updateSetting(e,t){o.methodEntry("SettingsStore","updateSetting",e);let r=await this.load();r[e]=t,await this.save(r),o.methodExit("SettingsStore","updateSetting")}async getSetting(e){return(await this.load())[e]}async updateDataFolderPath(e){o.methodEntry("SettingsStore","updateDataFolderPath",e),await this.updateSetting("dataFolderPath",(0,qr.normalizePath)(e)),o.methodExit("SettingsStore","updateDataFolderPath")}async updateDefaultVolume(e){o.methodEntry("SettingsStore","updateDefaultVolume",e);let t=await this.load();t.defaultPlaybackSettings.volume=Math.max(0,Math.min(1,e)),await this.save(t),o.methodExit("SettingsStore","updateDefaultVolume")}async updateDefaultPlaybackSpeed(e){o.methodEntry("SettingsStore","updateDefaultPlaybackSpeed",e);let t=await this.load();t.defaultPlaybackSettings.playbackSpeed=Math.max(.5,Math.min(3,e)),await this.save(t),o.methodExit("SettingsStore","updateDefaultPlaybackSpeed")}async updateDefaultSkipIntro(e){o.methodEntry("SettingsStore","updateDefaultSkipIntro",e);let t=await this.load();t.defaultPlaybackSettings.skipIntroSeconds=Math.max(0,e),await this.save(t),o.methodExit("SettingsStore","updateDefaultSkipIntro")}async updateDefaultSkipOutro(e){o.methodEntry("SettingsStore","updateDefaultSkipOutro",e);let t=await this.load();t.defaultPlaybackSettings.skipOutroSeconds=Math.max(0,e),await this.save(t),o.methodExit("SettingsStore","updateDefaultSkipOutro")}async updateAutoDownload(e){o.methodEntry("SettingsStore","updateAutoDownload",e),await this.updateSetting("autoDownload",e),o.methodExit("SettingsStore","updateAutoDownload")}async updateMaxCacheEpisodes(e){o.methodEntry("SettingsStore","updateMaxCacheEpisodes",e),await this.updateSetting("maxCacheEpisodes",Math.max(0,e)),o.methodExit("SettingsStore","updateMaxCacheEpisodes")}async updateFeedUpdateInterval(e){o.methodEntry("SettingsStore","updateFeedUpdateInterval",e),await this.updateSetting("feedUpdateInterval",Math.max(0,e)),o.methodExit("SettingsStore","updateFeedUpdateInterval")}async updateNotifications(e){o.methodEntry("SettingsStore","updateNotifications",e),await this.updateSetting("enableNotifications",e),o.methodExit("SettingsStore","updateNotifications")}async resetToDefaults(){o.methodEntry("SettingsStore","resetToDefaults"),await this.save(this.getDefaultValue()),o.methodExit("SettingsStore","resetToDefaults")}async exportSettings(){o.methodEntry("SettingsStore","exportSettings");let e=await this.load();return o.methodExit("SettingsStore","exportSettings"),e}async importSettings(e){if(o.methodEntry("SettingsStore","importSettings"),!this.validate(e))throw new $("Invalid import settings",this.filePath);await this.save(e),o.methodExit("SettingsStore","importSettings")}async loadWithMigration(){o.methodEntry("SettingsStore","loadWithMigration");let e=await this.load(),t={...this.getDefaultValue(),...e,defaultPlaybackSettings:{...fe.defaultPlaybackSettings,...e.defaultPlaybackSettings}};return JSON.stringify(e)!==JSON.stringify(t)&&(o.info("Migrating settings to current version"),await this.save(t)),o.methodExit("SettingsStore","loadWithMigration"),t}};var Je=class extends Ee{constructor(e,t,r=36e5){let i=t.getStructure().cacheFeed;super(e,t,i),this.defaultTTL=r}validate(e){if(!Array.isArray(e))return o.warn("Invalid feed cache data: not an array"),!1;for(let t of e)if(!this.validateEntry(t))return o.warn("Invalid feed cache entry",t),!1;return!0}validateEntry(e){if(!e||typeof e!="object")return!1;let t=["data","cachedAt","expiresAt","url","feedUrl"];for(let r of t)if(!(r in e))return o.warn(`Missing required field in cache entry: ${r}`),!1;return!0}getDefaultValue(){return[]}async loadAllItems(){let e=await this.listItemIds(),t=[];for(let r of e)try{let i=await this.loadItem(r,null);i&&this.validateEntry(i)&&t.push(i)}catch(i){o.warn(`Failed to load cache entry: ${r}`,i)}return t}async load(){o.methodEntry("FeedCacheStore","load");let e=await this.loadAllItems();return o.methodExit("FeedCacheStore","load"),e}async save(e){if(o.methodEntry("FeedCacheStore","save"),!this.validate(e))throw new $("Invalid feed cache data",this.dirPath);await this.clear();for(let t of e){let r=this.getFeedCacheId(t.feedUrl);await this.saveItem(r,t)}o.methodExit("FeedCacheStore","save")}getFeedCacheId(e){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);t=(t<<5)-t+i,t=t&t}return`feed-${Math.abs(t).toString(36)}`}async getCacheEntry(e){o.methodEntry("FeedCacheStore","getCacheEntry",e);let t=this.getFeedCacheId(e);try{let r=await this.loadItem(t,null);if(!r||!this.validateEntry(r))return o.methodExit("FeedCacheStore","getCacheEntry","invalid entry"),null;let i=new Date,s=new Date(r.expiresAt);return i>s?(o.debug("Cache entry expired",e),await this.deleteItem(t),o.methodExit("FeedCacheStore","getCacheEntry","expired"),null):(o.methodExit("FeedCacheStore","getCacheEntry"),r)}catch(r){return o.warn("Failed to get cache entry",r),o.methodExit("FeedCacheStore","getCacheEntry","error"),null}}async setCacheEntry(e,t,r=this.defaultTTL,i){o.methodEntry("FeedCacheStore","setCacheEntry",e);let s=new Date,a=new Date(s.getTime()+r),n={data:t,cachedAt:s,expiresAt:a,url:e,feedUrl:e,etag:i==null?void 0:i.etag,lastModified:i==null?void 0:i.lastModified},l=this.getFeedCacheId(e);await this.saveItem(l,n),o.methodExit("FeedCacheStore","setCacheEntry")}async removeCacheEntry(e){o.methodEntry("FeedCacheStore","removeCacheEntry",e);let t=this.getFeedCacheId(e);await this.deleteItem(t),o.methodExit("FeedCacheStore","removeCacheEntry")}async cleanupExpired(){o.methodEntry("FeedCacheStore","cleanupExpired");let e=await this.loadAllItems(),t=new Date,r=0;for(let i of e){let s=new Date(i.expiresAt);if(t>s){let a=this.getFeedCacheId(i.feedUrl);await this.deleteItem(a),r++}}o.info(`Cleaned up ${r} expired cache entries`),o.methodExit("FeedCacheStore","cleanupExpired")}async getCacheStats(){let e=await this.loadAllItems(),t=new Date,r=0,i=0;for(let s of e){let a=new Date(s.expiresAt);t>a&&r++,i+=s.data.length}return{totalEntries:e.length,expiredEntries:r,totalSize:i}}},Dt=class Dt{constructor(e,t){this.vault=e,this.pathManager=t,this.indexFilePath=t.getFilePath("cache","image-index.json")}async loadIndex(){try{let e=this.vault.adapter;if(!await e.exists(this.indexFilePath))return this.getDefaultIndex();let t=await e.read(this.indexFilePath),r=JSON.parse(t);return this.validateIndex(r)?r:(o.warn("Invalid image cache index, using default"),this.getDefaultIndex())}catch(e){return o.error("Failed to load image cache index",e),this.getDefaultIndex()}}async saveIndex(e){try{let t=JSON.stringify(e,null,2);await this.vault.adapter.write(this.indexFilePath,t)}catch(t){throw o.error("Failed to save image cache index",t),new $("Failed to save image cache index",this.indexFilePath)}}validateIndex(e){return!(!e||typeof e!="object"||!Array.isArray(e.images)||typeof e.version!="number")}getDefaultIndex(){return{images:[],version:Dt.CURRENT_VERSION}}getImageCacheFilename(e){let t="jpg";try{let a=new URL(e).pathname.match(/\.([a-zA-Z0-9]+)$/);a&&(t=a[1].toLowerCase())}catch(i){}let r=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);r=(r<<5)-r+s,r=r&r}return`image-${Math.abs(r).toString(36)}.${t}`}async getCachedImage(e){o.methodEntry("ImageCacheStore","getCachedImage",e);let r=(await this.loadIndex()).images.find(s=>s.imageUrl===e);return r?await this.vault.adapter.exists(r.localPath)?(o.methodExit("ImageCacheStore","getCachedImage"),r.localPath):(o.warn("Cached image file not found",r.localPath),await this.removeCachedImage(e),o.methodExit("ImageCacheStore","getCachedImage","file missing"),null):(o.methodExit("ImageCacheStore","getCachedImage","not found"),null)}async cacheImage(e,t){o.methodEntry("ImageCacheStore","cacheImage",e);let r=this.getImageCacheFilename(e),i=this.pathManager.getFilePath("cacheImages",r);await this.vault.adapter.writeBinary(i,t);let s=await this.loadIndex();s.images=s.images.filter(n=>n.imageUrl!==e);let a={imageUrl:e,localPath:i,cachedAt:new Date,size:t.byteLength};return s.images.push(a),await this.saveIndex(s),o.methodExit("ImageCacheStore","cacheImage"),i}async removeCachedImage(e){o.methodEntry("ImageCacheStore","removeCachedImage",e);let t=await this.loadIndex(),r=t.images.find(i=>i.imageUrl===e);if(r){try{await this.vault.adapter.remove(r.localPath)}catch(i){o.warn("Failed to delete cached image file",i)}t.images=t.images.filter(i=>i.imageUrl!==e),await this.saveIndex(t)}o.methodExit("ImageCacheStore","removeCachedImage")}async clearAll(){o.methodEntry("ImageCacheStore","clearAll");let e=await this.loadIndex();for(let t of e.images)try{await this.vault.adapter.remove(t.localPath)}catch(r){o.warn(`Failed to delete cached image: ${t.localPath}`,r)}await this.saveIndex(this.getDefaultIndex()),o.methodExit("ImageCacheStore","clearAll")}async getCacheStats(){let e=await this.loadIndex(),t=e.images.reduce((r,i)=>r+i.size,0);return{totalImages:e.images.length,totalSize:t}}async cleanupOldImages(e=100){o.methodEntry("ImageCacheStore","cleanupOldImages",`keepCount=${e}`);let t=await this.loadIndex();if(t.images.length<=e){o.methodExit("ImageCacheStore","cleanupOldImages","nothing to cleanup");return}let r=[...t.images].sort((s,a)=>{let n=new Date(s.cachedAt).getTime();return new Date(a.cachedAt).getTime()-n}),i=r.slice(e);for(let s of i)try{await this.vault.adapter.remove(s.localPath)}catch(a){o.warn(`Failed to delete old image: ${s.localPath}`,a)}t.images=r.slice(0,e),await this.saveIndex(t),o.info(`Cleaned up ${i.length} old cached images`),o.methodExit("ImageCacheStore","cleanupOldImages")}};Dt.CURRENT_VERSION=1;var Ze=Dt;var X=require("obsidian"),et=class extends X.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),this.loadSettings(),e.createEl("h2",{text:"Podcast Player Settings"}),this.addStorageSection(e),this.addPlaybackSection(e),this.addCacheSection(e),this.addSyncSection(e),this.addNotificationSection(e),this.addAdvancedSection(e)}async loadSettings(){this.settings=this.plugin.settings}async saveSettings(){await this.plugin.saveSettings()}addStorageSection(e){e.createEl("h3",{text:"Data Storage"}),new X.Setting(e).setName("Data folder path").setDesc("Folder where podcast data will be stored (relative to vault root)").addText(t=>t.setPlaceholder(".obsidian/plugins/podcast-player/data").setValue(this.settings.dataFolderPath).onChange(async r=>{this.settings.dataFolderPath=r,await this.saveSettings()}))}addPlaybackSection(e){e.createEl("h3",{text:"Default Playback Settings"}),e.createEl("p",{text:"These settings apply to all podcasts by default. Individual podcasts can override these.",cls:"setting-item-description"}),new X.Setting(e).setName("Default volume").setDesc("Default playback volume (0.0 to 1.0)").addSlider(t=>t.setLimits(0,100,5).setValue(this.settings.defaultPlaybackSettings.volume*100).setDynamicTooltip().onChange(async r=>{this.settings.defaultPlaybackSettings.volume=r/100,await this.saveSettings()})),new X.Setting(e).setName("Default playback speed").setDesc("Default playback speed (0.5x to 3.0x)").addSlider(t=>t.setLimits(50,300,5).setValue(this.settings.defaultPlaybackSettings.playbackSpeed*100).setDynamicTooltip().onChange(async r=>{this.settings.defaultPlaybackSettings.playbackSpeed=r/100,await this.saveSettings()})),new X.Setting(e).setName("Skip intro seconds").setDesc("Number of seconds to skip at the beginning of each episode").addText(t=>t.setPlaceholder("0").setValue(String(this.settings.defaultPlaybackSettings.skipIntroSeconds)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>=0&&(this.settings.defaultPlaybackSettings.skipIntroSeconds=i,await this.saveSettings())})),new X.Setting(e).setName("Skip outro seconds").setDesc("Number of seconds to skip at the end of each episode").addText(t=>t.setPlaceholder("0").setValue(String(this.settings.defaultPlaybackSettings.skipOutroSeconds||0)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>=0&&(this.settings.defaultPlaybackSettings.skipOutroSeconds=i,await this.saveSettings())}))}addCacheSection(e){e.createEl("h3",{text:"Download & Cache"}),new X.Setting(e).setName("Auto download new episodes").setDesc("Automatically download new episodes when feeds are updated").addToggle(t=>t.setValue(this.settings.autoDownload).onChange(async r=>{this.settings.autoDownload=r,await this.saveSettings()})),new X.Setting(e).setName("Maximum cached episodes").setDesc("Maximum number of episodes to keep in cache. Older episodes will be removed.").addText(t=>t.setPlaceholder("50").setValue(String(this.settings.maxCacheEpisodes)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>=0&&(this.settings.maxCacheEpisodes=i,await this.saveSettings())}))}addSyncSection(e){e.createEl("h3",{text:"Feed Sync"}),new X.Setting(e).setName("Feed update interval").setDesc("How often to check for new episodes (in minutes)").addDropdown(t=>t.addOption("15","15 minutes").addOption("30","30 minutes").addOption("60","1 hour").addOption("120","2 hours").addOption("360","6 hours").addOption("720","12 hours").addOption("1440","24 hours").setValue(String(this.settings.feedUpdateInterval)).onChange(async r=>{this.settings.feedUpdateInterval=parseInt(r,10),await this.saveSettings()}))}addNotificationSection(e){e.createEl("h3",{text:"Notifications"}),new X.Setting(e).setName("Enable notifications").setDesc("Show notifications for new episodes and playback events").addToggle(t=>t.setValue(this.settings.enableNotifications).onChange(async r=>{this.settings.enableNotifications=r,await this.saveSettings()}))}addAdvancedSection(e){e.createEl("h3",{text:"Advanced"}),new X.Setting(e).setName("Reset to defaults").setDesc("Reset all settings to their default values").addButton(t=>t.setButtonText("Reset").setWarning().onClick(async()=>{confirm("Are you sure you want to reset all settings to defaults? This cannot be undone.")&&(await this.plugin.resetSettings(),this.display(),new X.Notice("Settings reset to defaults"))})),new X.Setting(e).setName("Export settings").setDesc("Export your settings to a JSON file for backup or sharing").addButton(t=>t.setButtonText("Export").onClick(async()=>{await this.exportSettings()})),new X.Setting(e).setName("Import settings").setDesc("Import settings from a JSON file").addButton(t=>t.setButtonText("Import").onClick(async()=>{await this.importSettings()}))}async exportSettings(){try{let e=JSON.stringify(this.settings,null,2),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.download=`podcast-player-settings-${Date.now()}.json`,i.click(),URL.revokeObjectURL(r),new X.Notice("Settings exported successfully")}catch(e){console.error("Failed to export settings:",e),new X.Notice("Failed to export settings")}}async importSettings(){let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async t=>{var s;let i=(s=t.target.files)==null?void 0:s[0];if(i)try{let a=await i.text(),n=JSON.parse(a);if(!n.dataFolderPath||!n.defaultPlaybackSettings)throw new Error("Invalid settings file format");this.settings=n,await this.saveSettings(),this.display(),new X.Notice("Settings imported successfully")}catch(a){console.error("Failed to import settings:",a),new X.Notice("Failed to import settings: Invalid file format")}},e.click()}};var se=require("obsidian"),Se="podcast-player-view",tt=class extends se.ItemView{constructor(t,r){super(t);this.updateInterval=null;this.currentQueueId=null;this.isDraggingProgress=!1;this.lastQueueUpdatedAt=0;this.plugin=r}async onload(){super.onload(),this.registerEvent(this.app.workspace.on("podcast:queue-updated",async t=>{let r=await this.plugin.getQueueManager().getCurrentQueue();r&&r.id===t&&await this.renderPlayer()}))}getViewType(){return Se}getDisplayText(){return"Podcast Player"}getIcon(){return"podcast"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("podcast-player-view"),this.playerContentEl=t.createDiv({cls:"podcast-player-content"}),await this.renderPlayer(),this.startUpdateInterval()}async onClose(){this.stopUpdateInterval()}async renderPlayer(){this.playerContentEl.empty();let t=this.playerContentEl.createDiv({cls:"player-container"});this.renderEpisodeInfo(t),this.renderPlaybackControls(t),this.renderProgressSection(t),this.renderAdvancedControls(t),await this.renderQueueSection(t)}renderEpisodeInfo(t){let r=t.createDiv({cls:"episode-info-section"}),i=r.createEl("img",{cls:"player-podcast-thumbnail",attr:{src:"",alt:"Podcast Artwork"}});i.style.display="none";let s=r.createEl("h3",{text:"No episode playing",cls:"episode-title"}),a=r.createEl("p",{text:"Select a podcast to start",cls:"podcast-name"});r.createDiv({cls:"episode-metadata"}).createSpan({text:"--:--",cls:"episode-duration"})}renderPlaybackControls(t){let r=t.createDiv({cls:"playback-controls-section"}),i=r.createEl("button",{cls:"player-button player-button-prev",attr:{"aria-label":"Previous episode"}});(0,se.setIcon)(i,"skip-back"),i.addEventListener("click",()=>this.handlePrevious());let s=r.createEl("button",{cls:"player-button player-button-skip-back",attr:{"aria-label":"Skip backward 15s"}});(0,se.setIcon)(s,"rewind"),s.addEventListener("click",()=>this.handleSkipBackward());let a=r.createEl("button",{cls:"player-button player-button-play-pause",attr:{"aria-label":"Play/Pause"}});(0,se.setIcon)(a,"play"),a.addEventListener("click",()=>this.handlePlayPause());let n=r.createEl("button",{cls:"player-button player-button-skip-forward",attr:{"aria-label":"Skip forward 30s"}});(0,se.setIcon)(n,"fast-forward"),n.addEventListener("click",()=>this.handleSkipForward());let l=r.createEl("button",{cls:"player-button player-button-next",attr:{"aria-label":"Next episode"}});(0,se.setIcon)(l,"skip-forward"),l.addEventListener("click",()=>this.handleNext())}renderProgressSection(t){let r=t.createDiv({cls:"progress-section"});r.createSpan({text:"0:00",cls:"current-time"});let i=r.createDiv({cls:"progress-bar-container"});i.setAttribute("tabindex","0"),i.setAttribute("aria-label","Seek slider"),i.setAttribute("role","slider");let s=i.createDiv({cls:"progress-bar"}),a=s.createDiv({cls:"progress-fill"});a.style.width="0%";let n=s.createDiv({cls:"progress-bar-thumb"});n.style.left="0%";let l=i.createDiv({cls:"progress-tooltip"});l.textContent="0:00",i.addEventListener("mousedown",u=>{u.preventDefault(),i.focus();let g=this.plugin.playerController,f=g.getState();if(!f.currentEpisode)return;this.isDraggingProgress=!0;let m=f.currentEpisode.duration,y=T=>{let k=i.getBoundingClientRect(),w=T.clientX-k.left,h=Math.max(0,Math.min(1,w/k.width)),p=i.querySelector(".progress-fill"),b=i.querySelector(".progress-bar-thumb"),x=this.playerContentEl.querySelector(".current-time");return p&&(p.style.width=`${h*100}%`),b&&(b.style.left=`${h*100}%`),x&&(x.textContent=this.formatTime(m*h)),h},P=y(u),I=T=>{this.isDraggingProgress&&(P=y(T))},A=async()=>{this.isDraggingProgress=!1,document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",A),await g.seek(m*P)};document.addEventListener("mousemove",I),document.addEventListener("mouseup",A)}),i.addEventListener("keydown",async u=>{let g=this.plugin.playerController,f=g.getState();if(!f.currentEpisode)return;let m=f.currentEpisode.duration,y=f.position,P=y;switch(u.key){case"ArrowLeft":u.preventDefault(),P=Math.max(0,y-5);break;case"ArrowRight":u.preventDefault(),P=Math.min(m,y+5);break;case"Home":u.preventDefault(),P=0;break;case"End":u.preventDefault(),P=m;break;default:return}await g.seek(P)}),i.addEventListener("mousemove",u=>{let f=this.plugin.playerController.getState();if(!f.currentEpisode)return;let m=i.getBoundingClientRect(),y=u.clientX-m.left,P=Math.max(0,Math.min(1,y/m.width)),I=f.currentEpisode.duration;l.textContent=this.formatTime(I*P),l.style.left=`${P*100}%`}),r.createSpan({text:"0:00",cls:"total-time"})}renderAdvancedControls(t){let r=t.createDiv({cls:"advanced-controls-section"}),i=r.createDiv({cls:"control-group volume-control"}),s=i.createSpan({cls:"control-icon volume-icon"});(0,se.setIcon)(s,"volume-2");let a=i.createEl("input",{type:"range",cls:"control-slider volume-slider",attr:{min:"0",max:"100",value:"100",title:"Volume"}}),n=i.createSpan({cls:"control-value-label volume-value",text:"100"});a.addEventListener("input",m=>{let y=m.target,P=parseInt(y.value);n.textContent=String(P),this.handleVolumeChange(P)});let l=r.createDiv({cls:"control-group speed-control"}),u=l.createSpan({cls:"control-icon speed-icon"});(0,se.setIcon)(u,"zap");let g=l.createEl("input",{type:"range",cls:"control-slider speed-slider",attr:{min:"0.5",max:"3.0",step:"0.1",value:"1.0",title:"Playback Speed"}}),f=l.createSpan({cls:"control-value-label speed-value",text:"1.0x"});g.addEventListener("input",m=>{let y=m.target,P=parseFloat(y.value);f.textContent=`${P.toFixed(1)}x`,this.handleSpeedChange(P)})}async handlePlayPause(){console.log("PlayerView: Play/Pause clicked");try{if(!this.plugin){console.error("PlayerView: Plugin instance is missing");return}if(!this.plugin.playerController){console.error("PlayerView: PlayerController is missing");return}let t=this.plugin.playerController,r=t.getState();console.log("PlayerView: Current state",r),r.status==="playing"?await t.pause():(r.status==="paused"||r.status==="stopped")&&await t.play()}catch(t){console.error("Failed to toggle playback:",t)}}async handlePrevious(){try{if(!this.currentQueueId){console.log("No queue selected");return}let r=await this.plugin.getQueueManager().previous(this.currentQueueId);r&&await this.loadEpisodeById(r)}catch(t){console.error("Failed to go to previous episode:",t)}}async handleNext(){try{if(!this.currentQueueId){console.log("No queue selected");return}let r=await this.plugin.getQueueManager().next(this.currentQueueId);r&&await this.loadEpisodeById(r)}catch(t){console.error("Failed to go to next episode:",t)}}async loadEpisodeById(t){try{let i=await this.plugin.getEpisodeManager().getEpisodeWithProgress(t);i&&await this.plugin.playerController.loadEpisode(i,!0,!0)}catch(r){console.error("Failed to load episode:",r)}}async handleSkipBackward(){try{await this.plugin.playerController.skipBackward(15)}catch(t){console.error("Failed to skip backward:",t)}}async handleSkipForward(){try{await this.plugin.playerController.skipForward(30)}catch(t){console.error("Failed to skip forward:",t)}}async handleSeek(t,r){try{let i=this.plugin.playerController,s=i.getState();if(!s.currentEpisode)return;let a=r.getBoundingClientRect(),n=t.clientX-a.left,l=Math.max(0,Math.min(1,n/a.width)),g=s.currentEpisode.duration*l;await i.seek(g)}catch(i){console.error("Failed to seek:",i)}}async handleVolumeChange(t){try{await this.plugin.playerController.setVolume(t/100)}catch(r){console.error("Failed to change volume:",r)}}async handleSpeedChange(t){try{await this.plugin.playerController.setPlaybackSpeed(t)}catch(r){console.error("Failed to change playback speed:",r)}}startUpdateInterval(){this.updateInterval=window.setInterval(()=>{this.updatePlayerState()},1e3)}stopUpdateInterval(){this.updateInterval!==null&&(window.clearInterval(this.updateInterval),this.updateInterval=null)}async updatePlayerState(){try{let r=this.plugin.playerController.getState(),i=this.playerContentEl.querySelector(".episode-title"),s=this.playerContentEl.querySelector(".podcast-name"),a=this.playerContentEl.querySelector(".episode-duration"),n=this.playerContentEl.querySelector(".player-podcast-thumbnail");if(r.currentEpisode){i&&(i.textContent=r.currentEpisode.title),a&&(a.textContent=this.formatTime(r.currentEpisode.duration));let k=r.currentEpisode.podcastId;k?this.plugin.getSubscriptionStore().getPodcast(k).then(w=>{w&&(s&&(s.textContent=w.title),n&&w.imageUrl?(n.src=w.imageUrl,n.style.display="block"):n&&(n.style.display="none"))}):(s&&(s.textContent="Unknown Podcast"),n&&(n.style.display="none"))}else i&&(i.textContent="No episode playing"),s&&(s.textContent="Select a podcast to start"),a&&(a.textContent="--:--"),n&&(n.style.display="none");let l=this.playerContentEl.querySelector(".player-button-play-pause");l&&(0,se.setIcon)(l,r.status==="playing"?"pause":"play");let u=this.playerContentEl.querySelector(".current-time"),g=this.playerContentEl.querySelector(".total-time");u&&(u.textContent=this.formatTime(r.position)),g&&r.currentEpisode&&(g.textContent=this.formatTime(r.currentEpisode.duration));let f=this.playerContentEl.querySelector(".progress-fill"),m=this.playerContentEl.querySelector(".progress-bar-thumb");if(f&&!this.isDraggingProgress)if(r.currentEpisode&&r.currentEpisode.duration>0){let k=Math.min(100,Math.max(0,r.position/r.currentEpisode.duration*100));f.style.width=`${k}%`,m&&(m.style.left=`${k}%`)}else f.style.width="0%",m&&(m.style.left="0%");let y=this.playerContentEl.querySelector(".volume-slider");y&&(y.value=String(r.volume*100));let P=this.playerContentEl.querySelector(".speed-slider"),I=this.playerContentEl.querySelector(".speed-value");P&&document.activeElement!==P&&(P.value=String(r.playbackSpeed)),I&&(I.textContent=`${r.playbackSpeed.toFixed(1)}x`);let T=await this.plugin.getQueueManager().getCurrentQueue();if(T){let k=T.updatedAt instanceof Date?T.updatedAt.getTime():new Date(T.updatedAt).getTime();if(T.id!==this.currentQueueId||k>this.lastQueueUpdatedAt){this.currentQueueId=T.id,this.lastQueueUpdatedAt=k;let w=this.playerContentEl.querySelector(".player-container");if(w){let h=w.querySelector(".queue-section");h&&h.remove(),await this.renderQueueSection(w)}}}}catch(t){console.error("Failed to update player state:",t)}}formatTime(t){let r=Math.floor(t/3600),i=Math.floor(t%3600/60),s=Math.floor(t%60);return r>0?`${r}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${i}:${s.toString().padStart(2,"0")}`}async renderQueueSection(t){let r=t.createDiv({cls:"queue-section"});try{let i=await this.getCurrentQueue(),s=r.createDiv({cls:"queue-header"}),a="Current Queue";if(i&&(i.isPlaylist?a=`Current Playlist: ${i.name.startsWith("Playlist: ")?i.name.substring(10):i.name}`:a=`Current Queue: ${i.name}`),s.createEl("h3",{text:a,cls:"queue-title"}),!i||i.episodeIds.length===0){let n=r.createDiv({cls:"queue-empty-state"});n.createEl("p",{text:"No queue active"}),n.createEl("p",{text:"Add episodes to queue to see them here",cls:"queue-empty-hint"});return}await this.renderQueueEpisodeList(r,i)}catch(i){console.error("Failed to render queue section:",i),r.createDiv({cls:"queue-error-state"}).createEl("p",{text:"Failed to load queue"})}}async getCurrentQueue(){try{let t=this.plugin.getQueueManager(),r=await t.getCurrentQueue();if(r)return this.currentQueueId=r.id,r;if(this.currentQueueId){let s=await t.getQueue(this.currentQueueId);if(s)return t.setCurrentQueue(s.id),s}let i=await t.getAllQueues();return i.length>0?(this.currentQueueId=i[0].id,t.setCurrentQueue(i[0].id),i[0]):null}catch(t){return console.error("Failed to get current queue:",t),null}}async renderQueueEpisodeList(t,r){let i=t.createDiv({cls:"queue-episode-list"});if(r.episodeIds.length===0){i.createEl("p",{text:"Queue is empty",cls:"queue-empty-text"});return}let s=this.plugin.getEpisodeManager(),a=i.createDiv({cls:"queue-info"});a.createSpan({text:`${r.episodeIds.length} episodes`,cls:"queue-count"}),a.createSpan({text:` \u2022 Current: ${r.currentIndex+1}`,cls:"queue-current"});let n=i.createDiv({cls:"queue-episodes"});for(let l=0;l<Math.min(r.episodeIds.length,10);l++){let u=r.episodeIds[l];try{let g=await s.getEpisodeWithProgress(u);g&&this.renderQueueEpisodeItem(n,g,l,r.currentIndex===l)}catch(g){console.error(`Failed to load episode: ${u}`,g)}}r.episodeIds.length>10&&n.createDiv({cls:"queue-more"}).createEl("span",{text:`+ ${r.episodeIds.length-10} more episodes`,cls:"queue-more-text"})}renderQueueEpisodeItem(t,r,i,s){let a=t.createDiv({cls:s?"queue-episode-item current":"queue-episode-item"});a.draggable=!0,a.addEventListener("dragstart",g=>{var f;(f=g.dataTransfer)==null||f.setData("text/plain",i.toString()),a.addClass("dragging"),g.dataTransfer&&(g.dataTransfer.effectAllowed="move")}),a.addEventListener("dragend",()=>{a.removeClass("dragging"),t.querySelectorAll(".queue-episode-item").forEach(g=>g.removeClass("drag-over"))}),a.addEventListener("dragover",g=>{g.preventDefault(),g.dataTransfer&&(g.dataTransfer.dropEffect="move"),a.addClass("drag-over")}),a.addEventListener("dragleave",()=>{a.removeClass("drag-over")}),a.addEventListener("drop",async g=>{var m;g.preventDefault(),a.removeClass("drag-over");let f=parseInt(((m=g.dataTransfer)==null?void 0:m.getData("text/plain"))||"-1");if(f!==-1&&f!==i&&this.currentQueueId)try{await this.plugin.getQueueManager().moveEpisode(this.currentQueueId,f,i),await this.renderPlayer()}catch(y){console.error("Failed to move episode:",y)}});let n=a.createDiv({cls:"queue-episode-action"});if(s){let g=n.createDiv({cls:"icon-current"});(0,se.setIcon)(g,"pause")}else{let g=n.createDiv({cls:"icon-drag"});(0,se.setIcon)(g,"grip-vertical");let f=n.createDiv({cls:"icon-play"});(0,se.setIcon)(f,"play")}let l=a.createDiv({cls:"queue-episode-info"}),u=l.createEl("div",{text:r.title,cls:"queue-episode-title"});r.title.length>40&&(u.textContent=r.title.substring(0,40)+"...",u.setAttribute("title",r.title)),r.duration&&l.createEl("div",{text:this.formatDuration(r.duration),cls:"queue-episode-duration"}),a.addEventListener("click",async()=>{try{let g=this.plugin.getQueueManager();this.currentQueueId&&(await g.jumpTo(this.currentQueueId,i),await this.plugin.playerController.loadEpisode(r,!0,!0),await this.renderPlayer())}catch(g){console.error("Failed to play episode from queue:",g)}})}formatRepeatMode(t){switch(t){case"none":return"Off";case"one":return"One";case"all":return"All"}}formatDuration(t){let r=Math.floor(t/3600),i=Math.floor(t%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}};var F=require("obsidian");var Pe=require("obsidian"),Ne=class extends Pe.Modal{constructor(e,t,r,i){super(e),this.plugin=t,this.episodes=r,this.onSubmit=i}async onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Add to Queue"});let t=this.plugin.getQueueManager(),r=await t.getAllQueues(),i=null;r.length>0&&new Pe.Setting(e).setName("Select queue").setDesc("Choose an existing queue or create a new one").addDropdown(u=>{u.addOption("","Create new queue..."),r.forEach(g=>{u.addOption(g.id,g.name)}),u.onChange(g=>{i=g||null;let f=e.querySelector(".new-queue-setting");f&&(f.style.display=i?"none":"block")})});let s="",a=new Pe.Setting(e).setName("New queue name").setDesc("Enter a name for the new queue").addText(u=>u.setPlaceholder("My Queue").onChange(g=>{s=g}));a.settingEl.addClass("new-queue-setting"),r.length>0&&i&&(a.settingEl.style.display="none");let n=e.createDiv({cls:"episode-info"});this.episodes.length===1?n.createEl("p",{text:`Adding: ${this.episodes[0].title}`}):n.createEl("p",{text:`Adding ${this.episodes.length} episodes`});let l=e.createDiv({cls:"modal-button-container"});l.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),l.createEl("button",{text:"Add",cls:"mod-cta"}).addEventListener("click",async()=>{try{let u;if(i)u=i;else{if(!s.trim()){new Pe.Notice("Please enter a queue name");return}u=(await t.createQueue(s.trim())).id}for(let g of this.episodes)await t.addEpisode(u,g.id);this.onSubmit(u),this.close(),new Pe.Notice("Added to queue successfully")}catch(u){console.error("Failed to add to queue:",u),new Pe.Notice("Failed to add to queue")}})}onClose(){let{contentEl:e}=this;e.empty()}};var de=require("obsidian"),ke=class extends de.Modal{constructor(e,t,r,i){super(e),this.plugin=t,this.episodes=r,this.onSubmit=i}async onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Add to Playlist"});let t=this.plugin.getPlaylistManager(),r=await t.getAllPlaylists(),i=null;r.length>0&&new de.Setting(e).setName("Select playlist").setDesc("Choose an existing playlist or create a new one").addDropdown(g=>{g.addOption("","Create new playlist..."),r.forEach(f=>{g.addOption(f.id,f.name)}),g.onChange(f=>{i=f||null;let m=e.querySelector(".new-playlist-settings");m&&(m.style.display=i?"none":"block")})});let s="",a="",n=e.createDiv({cls:"new-playlist-settings"});new de.Setting(n).setName("Playlist name").setDesc("Enter a name for the new playlist").addText(g=>g.setPlaceholder("My Playlist").onChange(f=>{s=f})),new de.Setting(n).setName("Description (optional)").setDesc("Add a description for the playlist").addTextArea(g=>g.setPlaceholder("Description...").onChange(f=>{a=f})),r.length>0&&i&&(n.style.display="none");let l=e.createDiv({cls:"episode-info"});this.episodes.length===1?l.createEl("p",{text:`Adding: ${this.episodes[0].title}`}):l.createEl("p",{text:`Adding ${this.episodes.length} episodes`});let u=e.createDiv({cls:"modal-button-container"});u.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),u.createEl("button",{text:"Add",cls:"mod-cta"}).addEventListener("click",async()=>{try{let g;if(i)g=i;else{if(!s.trim()){new de.Notice("Please enter a playlist name");return}g=(await t.createPlaylist(s.trim(),a.trim()||void 0)).id}for(let f of this.episodes)await t.addEpisode(g,f.id);this.onSubmit(g),this.close(),new de.Notice("Added to playlist successfully")}catch(g){console.error("Failed to add to playlist:",g),new de.Notice("Failed to add to playlist")}})}onClose(){let{contentEl:e}=this;e.empty()}};var xe=require("obsidian"),rt=class extends xe.Modal{constructor(e,t,r,i,s,a){super(e),this.title=t,this.name=r,this.placeholder=i,this.onSubmit=s,this.onDelete=a}onOpen(){var s;let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),(s=new xe.Setting(e).addText(a=>a.setValue(this.name).setPlaceholder(this.placeholder).onChange(n=>{this.name=n})).controlEl.querySelector("input"))==null||s.focus();let r=e.createDiv({cls:"modal-button-container"});if(r.style.display="flex",r.style.justifyContent="space-between",r.style.marginTop="20px",this.onDelete){let a=new xe.ButtonComponent(r).setButtonText("Delete").setWarning().onClick(()=>{this.onDelete&&(this.onDelete(),this.close())});a.buttonEl.style.marginRight="auto"}let i=r.createDiv();i.style.display="flex",i.style.gap="10px",new xe.ButtonComponent(i).setButtonText("Cancel").onClick(()=>this.close()),new xe.ButtonComponent(i).setButtonText("Save").setCta().onClick(()=>{this.onSubmit(this.name),this.close()}),e.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),this.onSubmit(this.name),this.close())})}onClose(){let{contentEl:e}=this;e.empty()}};var G=require("obsidian"),Fe=class extends G.Modal{constructor(t,r,i){super(t);this.searchResults=[];this.selectedFeeds=new Set;this.currentPage=0;this.resultsPerPage=5;this.searchResultsContainer=null;this.feedUrl="";this.feedUrlInput=null;this.plugin=r,this.onSubmit=i}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("subscribe-podcast-modal"),t.createEl("h2",{text:"Subscribe to Podcast"}),this.renderSearchSection(t),t.createEl("div",{cls:"subscribe-divider",text:"OR"}),this.renderUrlSection(t)}renderSearchSection(t){let r=t.createDiv({cls:"subscribe-search-section"});r.createEl("h3",{text:"Search for Podcasts"});let i=r.createDiv({cls:"subscribe-search-container"}),s="",a=i.createEl("input",{type:"text",placeholder:"Search podcasts...",cls:"subscribe-search-input"});a.addEventListener("input",l=>{s=l.target.value}),a.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),this.performSearch(s))});let n=i.createEl("button",{cls:"subscribe-search-button",attr:{"aria-label":"Search"}});(0,G.setIcon)(n,"search"),n.addEventListener("click",()=>{this.performSearch(s)}),this.searchResultsContainer=r.createDiv({cls:"subscribe-search-results"})}renderUrlSection(t){let r=t.createDiv({cls:"subscribe-url-section"});r.createEl("h3",{text:"Or Enter Feed URL Directly"}),new G.Setting(r).setName("Feed URL").setDesc("Enter the RSS or Atom feed URL of the podcast").addText(a=>{a.setPlaceholder("https://example.com/podcast/feed.xml").setValue(this.feedUrl).onChange(n=>{this.feedUrl=n}),this.feedUrlInput=a.inputEl});let i=r.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"Subscribe",cls:"mod-cta"}).addEventListener("click",async()=>{this.selectedFeeds.size>0?await this.handleSubscribeMultiple(Array.from(this.selectedFeeds)):this.feedUrl.trim()?await this.handleSubscribeByUrl(this.feedUrl.trim()):new G.Notice("Please select a podcast or enter a URL")})}async performSearch(t){if(!t.trim()){new G.Notice("Please enter a search query");return}if(this.searchResultsContainer)try{this.searchResultsContainer.empty(),this.searchResultsContainer.createDiv({cls:"subscribe-loading",text:"Searching..."});let r=this.plugin.getPodcastService();this.searchResults=await r.searchOnline(t,{limit:50}),this.currentPage=0,this.renderSearchResults()}catch(r){console.error("Search failed:",r),this.searchResultsContainer.empty();let i=this.searchResultsContainer.createDiv({cls:"subscribe-error"});i.createEl("p",{text:"\u641C\u5C0B\u5931\u6557"}),i.createEl("p",{text:"\u7121\u6CD5\u9023\u63A5\u5230 iTunes API\u3002\u9019\u53EF\u80FD\u662F\u7531\u65BC\uFF1A",cls:"subscribe-error-detail"});let s=i.createEl("ul",{cls:"subscribe-error-reasons"});s.createEl("li",{text:"\u7DB2\u8DEF\u9023\u7DDA\u554F\u984C"}),s.createEl("li",{text:"Obsidian \u7684\u7DB2\u8DEF\u8ACB\u6C42\u9650\u5236"}),s.createEl("li",{text:"iTunes API \u66AB\u6642\u7121\u6CD5\u4F7F\u7528"}),i.createEl("p",{text:"\u5EFA\u8B70\uFF1A\u8ACB\u5617\u8A66\u76F4\u63A5\u8F38\u5165 RSS Feed URL \u4F86\u8A02\u95B1 Podcast",cls:"subscribe-error-suggestion"})}}renderSearchResults(){if(!this.searchResultsContainer)return;if(this.searchResultsContainer.empty(),this.searchResults.length===0){this.searchResultsContainer.createDiv({cls:"subscribe-no-results",text:"No podcasts found"});return}let t=this.currentPage*this.resultsPerPage,r=Math.min(t+this.resultsPerPage,this.searchResults.length),i=this.searchResults.slice(t,r),s=this.searchResultsContainer.createDiv({cls:"subscribe-results-list"});for(let a of i)this.renderSearchResultItem(s,a);this.searchResults.length>this.resultsPerPage&&this.renderPagination()}renderSearchResultItem(t,r){let i=t.createDiv({cls:"subscribe-result-item"});if(this.selectedFeeds.has(r.feedUrl)&&i.addClass("selected"),r.artworkUrl){let u=i.createEl("img",{cls:"subscribe-result-artwork",attr:{src:r.artworkUrl,alt:r.title}})}else{let u=i.createDiv({cls:"subscribe-result-artwork-placeholder"});(0,G.setIcon)(u,"mic")}let s=i.createDiv({cls:"subscribe-result-info"});if(s.createEl("h4",{text:r.title,cls:"subscribe-result-title"}),r.author&&s.createEl("p",{text:r.author,cls:"subscribe-result-author"}),r.description){let u=s.createEl("p",{text:r.description,cls:"subscribe-result-description"});r.description.length>100&&u.setText(r.description.substring(0,100)+"...")}let n=i.createDiv({cls:"subscribe-result-checkbox-container"}).createEl("input",{type:"checkbox",cls:"subscribe-result-checkbox"});n.checked=this.selectedFeeds.has(r.feedUrl);let l=()=>{this.selectedFeeds.has(r.feedUrl)?(this.selectedFeeds.delete(r.feedUrl),i.removeClass("selected"),n.checked=!1):(this.selectedFeeds.add(r.feedUrl),i.addClass("selected"),n.checked=!0)};n.addEventListener("click",u=>{u.stopPropagation(),l()}),i.addEventListener("click",()=>{l()})}renderPagination(){if(!this.searchResultsContainer)return;let t=Math.ceil(this.searchResults.length/this.resultsPerPage),r=this.searchResultsContainer.createDiv({cls:"subscribe-pagination"}),i=r.createEl("button",{text:"\u2190 Previous",cls:"subscribe-pagination-button"});i.disabled=this.currentPage===0,i.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.renderSearchResults())}),r.createSpan({text:`Page ${this.currentPage+1} of ${t}`,cls:"subscribe-pagination-info"});let s=r.createEl("button",{text:"Next \u2192",cls:"subscribe-pagination-button"});s.disabled=this.currentPage>=t-1,s.addEventListener("click",()=>{this.currentPage<t-1&&(this.currentPage++,this.renderSearchResults())})}async handleSubscribeMultiple(t){if(t.length!==0)try{let r=new G.Notice(`Subscribing to ${t.length} podcasts...`,0),i=this.plugin.getPodcastService(),s=0,a=0;for(let n of t){let l=await i.subscribe(n);l.success?s++:(a++,console.error(`Failed to subscribe to ${n}:`,l.error))}r.hide(),s>0&&(new G.Notice(`Successfully subscribed to ${s} podcasts`),this.close(),this.onSubmit("")),a>0&&new G.Notice(`Failed to subscribe to ${a} podcasts`)}catch(r){console.error("Batch subscription failed:",r),new G.Notice("Failed to subscribe to podcasts")}}async handleSubscribeByUrl(t){if(!t){new G.Notice("Please enter a feed URL");return}if(!this.isValidUrl(t)){new G.Notice("Please enter a valid URL");return}try{let r=new G.Notice("Subscribing to podcast...",0),s=await this.plugin.getPodcastService().subscribe(t);if(r.hide(),s.success&&s.podcast)new G.Notice(`Successfully subscribed to: ${s.podcast.title}`),this.close(),this.onSubmit(s.podcast.id);else{let a=s.error||"Failed to subscribe to podcast";new G.Notice(a)}}catch(r){console.error("Failed to subscribe to podcast:",r);let i="Failed to subscribe to podcast";r instanceof Error&&(r.message.includes("already subscribed")?i="You are already subscribed to this podcast":r.message.includes("Invalid feed")?i="Invalid RSS/Atom feed URL":r.message.includes("Network")?i="Network error. Please check your connection.":r.message.includes("timeout")&&(i="Request timed out. Please try again.")),new G.Notice(i)}}isValidUrl(t){try{let r=new URL(t);return r.protocol==="http:"||r.protocol==="https:"}catch(r){return!1}}onClose(){let{contentEl:t}=this;t.empty(),this.searchResults=[],this.currentPage=0,this.searchResultsContainer=null,this.feedUrl="",this.feedUrlInput=null,this.selectedFeeds.clear()}};var K=require("obsidian"),it=class c extends K.Modal{constructor(e,t,r,i){super(e),this.plugin=t,this.podcast=r,this.onSubmit=i;let s=r.settings||t.settings.defaultPlaybackSettings;this.volume=s.volume,this.playbackSpeed=s.playbackSpeed,this.skipIntroSeconds=s.skipIntroSeconds,this.skipOutroSeconds=s.skipOutroSeconds||0;let a=r.autoAddRule;this.autoAddEnabled=(a==null?void 0:a.enabled)||!1,this.autoAddTargetType=(a==null?void 0:a.targetType)||"queue",this.autoAddTargetId=(a==null?void 0:a.targetId)||"",this.autoAddPosition=(a==null?void 0:a.position)||"bottom"}async onOpen(){let{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:`Settings for ${this.podcast.title}`}),e.createEl("p",{text:"These settings override the global defaults for this podcast only.",cls:"setting-item-description"}),new K.Setting(e).setName("Volume").setDesc("Playback volume for this podcast (0% - 100%)").addSlider(r=>r.setLimits(0,100,5).setValue(this.volume*100).setDynamicTooltip().onChange(i=>{this.volume=i/100})),new K.Setting(e).setName("Playback speed").setDesc("Playback speed for this podcast (0.5x - 3.0x)").addSlider(r=>r.setLimits(50,300,25).setValue(this.playbackSpeed*100).setDynamicTooltip().onChange(i=>{this.playbackSpeed=i/100})),new K.Setting(e).setName("Skip intro").setDesc("Number of seconds to skip at the beginning of each episode").addText(r=>r.setPlaceholder("0").setValue(String(this.skipIntroSeconds)).onChange(i=>{let s=parseInt(i);!isNaN(s)&&s>=0&&(this.skipIntroSeconds=s)})),new K.Setting(e).setName("Skip outro").setDesc("Number of seconds to skip at the end of each episode").addText(r=>r.setPlaceholder("0").setValue(String(this.skipOutroSeconds)).onChange(i=>{let s=parseInt(i);!isNaN(s)&&s>=0&&(this.skipOutroSeconds=s)})),e.createEl("h3",{text:"Auto-add New Episodes"}),new K.Setting(e).setName("Enable auto-add").setDesc("Automatically add new episodes to a playlist or queue").addToggle(r=>r.setValue(this.autoAddEnabled).onChange(async i=>{this.autoAddEnabled=i,this.onOpen()})),this.autoAddEnabled){let r=this.plugin.getPlaylistManager(),i=this.plugin.getQueueManager(),s=await r.getAllPlaylists(),a=await i.getAllQueues();new K.Setting(e).setName("Target").setDesc("Select where to add new episodes").addDropdown(l=>{l.addOption("","Select a target..."),a.length>0&&a.forEach(u=>l.addOption(`queue:${u.id}`,`Queue: ${u.name}`)),s.length>0&&s.forEach(u=>l.addOption(`playlist:${u.id}`,`Playlist: ${u.name}`)),this.autoAddTargetId&&l.setValue(`${this.autoAddTargetType}:${this.autoAddTargetId}`),l.onChange(u=>{if(u){let[g,f]=u.split(":");this.autoAddTargetType=g,this.autoAddTargetId=f}else this.autoAddTargetId=""})}),new K.Setting(e).setName("Position").setDesc("Where to add the episode in the list").addDropdown(l=>l.addOption("top","Top (Beginning)").addOption("bottom","Bottom (End)").setValue(this.autoAddPosition).onChange(u=>{this.autoAddPosition=u}))}let t=e.createDiv({cls:"modal-button-container"});t.createEl("button",{text:"Reset to Global Defaults"}).addEventListener("click",()=>{this.resetToDefaults()}),t.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),t.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{this.handleSave()})}resetToDefaults(){let e=this.plugin.settings.defaultPlaybackSettings;this.volume=e.volume,this.playbackSpeed=e.playbackSpeed,this.skipIntroSeconds=e.skipIntroSeconds,this.skipOutroSeconds=e.skipOutroSeconds||0,this.close(),new c(this.app,this.plugin,this.podcast,this.onSubmit).open()}handleSave(){try{if(this.volume<0||this.volume>1){new K.Notice("Volume must be between 0 and 1");return}if(this.playbackSpeed<.5||this.playbackSpeed>3){new K.Notice("Playback speed must be between 0.5x and 3.0x");return}if(this.skipIntroSeconds<0){new K.Notice("Skip intro seconds must be positive");return}if(this.skipOutroSeconds<0){new K.Notice("Skip outro seconds must be positive");return}let e={volume:this.volume,playbackSpeed:this.playbackSpeed,skipIntroSeconds:this.skipIntroSeconds,skipOutroSeconds:this.skipOutroSeconds},t;if(this.autoAddEnabled){if(!this.autoAddTargetId){new K.Notice("Please select a target for auto-add");return}t={enabled:!0,targetType:this.autoAddTargetType,targetId:this.autoAddTargetId,position:this.autoAddPosition}}else this.podcast.autoAddRule&&(t={...this.podcast.autoAddRule,enabled:!1});this.onSubmit(e,t),this.close(),new K.Notice("Podcast settings saved")}catch(e){console.error("Failed to save podcast settings:",e),new K.Notice("Failed to save settings")}}onClose(){let{contentEl:e}=this;e.empty()}};var ee=require("obsidian");var Te=class extends ee.Modal{constructor(t,r,i){super(t);this.podcast=null;this.plugin=r,this.episode=i}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("episode-detail-modal"),this.modalEl.addClass("episode-detail-modal-container"),await this.loadData(),this.render()}async loadData(){try{let t=this.plugin.getSubscriptionStore();this.podcast=await t.getPodcast(this.episode.podcastId);let i=await this.plugin.getEpisodeManager().getEpisodeWithProgress(this.episode.id);this.progress=i==null?void 0:i.progress}catch(t){console.error("Failed to load episode data:",t)}}render(){let{contentEl:t}=this;t.empty(),this.renderHeader(),this.renderEpisodeInfo(),this.podcast&&this.renderPodcastInfo(),this.progress&&this.renderProgressInfo(),this.renderActions()}renderHeader(){var i,s;let{contentEl:t}=this,r=t.createDiv({cls:"episode-detail-header"});if(this.episode.imageUrl||(i=this.podcast)!=null&&i.imageUrl){let a=this.episode.imageUrl||((s=this.podcast)==null?void 0:s.imageUrl)||"";if(a){let n=r.createEl("img",{cls:"episode-detail-image",attr:{src:a,alt:this.episode.title}})}}r.createEl("h2",{text:this.episode.title,cls:"episode-detail-title"})}renderEpisodeInfo(){let{contentEl:t}=this,r=t.createDiv({cls:"episode-detail-section"});if(r.createEl("h3",{text:"Episode Information"}),this.episode.duration){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Duration: ",cls:"episode-detail-label"}),s.createSpan({text:this.formatDuration(this.episode.duration)})}let i=r.createDiv({cls:"episode-detail-row"});if(i.createSpan({text:"Published: ",cls:"episode-detail-label"}),i.createSpan({text:this.formatDate(this.episode.publishDate)}),this.episode.episodeNumber){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Episode: ",cls:"episode-detail-label"}),s.createSpan({text:`#${this.episode.episodeNumber}`})}if(this.episode.seasonNumber){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Season: ",cls:"episode-detail-label"}),s.createSpan({text:`${this.episode.seasonNumber}`})}if(this.episode.description){r.createEl("h4",{text:"Description",cls:"episode-detail-subsection"});let s=r.createDiv({cls:"episode-detail-description"});s.innerHTML=this.formatDescription(this.episode.description)}}renderPodcastInfo(){if(!this.podcast)return;let{contentEl:t}=this,r=t.createDiv({cls:"episode-detail-section"});r.createEl("h3",{text:"Podcast"});let i=r.createDiv({cls:"episode-detail-row"});if(i.createSpan({text:"Show: ",cls:"episode-detail-label"}),i.createSpan({text:this.podcast.title}),this.podcast.author){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Author: ",cls:"episode-detail-label"}),s.createSpan({text:this.podcast.author})}}renderProgressInfo(){if(!this.progress)return;let{contentEl:t}=this,r=t.createDiv({cls:"episode-detail-section"});r.createEl("h3",{text:"Playback Progress"});let i=r.createDiv({cls:"episode-detail-row"});i.createSpan({text:"Position: ",cls:"episode-detail-label"}),i.createSpan({text:`${this.formatDuration(this.progress.position)} / ${this.formatDuration(this.episode.duration)}`});let s=r.createDiv({cls:"episode-detail-progress-container"}),n=s.createDiv({cls:"episode-detail-progress-bar"}).createDiv({cls:"episode-detail-progress-fill"}),l=this.progress.position/this.episode.duration*100;n.style.width=`${l}%`;let u=s.createSpan({text:`${Math.round(l)}%`,cls:"episode-detail-progress-text"}),f=r.createDiv({cls:"episode-detail-row"}).createSpan({cls:"episode-detail-completed"});if((0,ee.setIcon)(f,"check"),f.createSpan({text:" Completed"}),this.progress.lastPlayedAt){let m=r.createDiv({cls:"episode-detail-row"});m.createSpan({text:"Last played: ",cls:"episode-detail-label"}),m.createSpan({text:this.formatDate(this.progress.lastPlayedAt)})}}renderActions(){let{contentEl:t}=this,r=t.createDiv({cls:"episode-detail-actions"}),i=r.createEl("button",{cls:"mod-cta"});(0,ee.setIcon)(i,"play"),i.createSpan({text:" Play"}),i.addEventListener("click",()=>this.handlePlay());let s=r.createEl("button");(0,ee.setIcon)(s,"list-plus"),s.createSpan({text:" Add to Queue"}),s.addEventListener("click",()=>this.handleAddToQueue());let a=r.createEl("button");(0,ee.setIcon)(a,"folder-plus"),a.createSpan({text:" Add to Playlist"}),a.addEventListener("click",()=>this.handleAddToPlaylist());let n=r.createEl("button");(0,ee.setIcon)(n,"file-text"),n.createSpan({text:" Export to Note"}),n.addEventListener("click",()=>this.handleExportToNote()),r.createEl("button",{text:"Close"}).addEventListener("click",()=>this.close())}async handlePlay(){try{await this.plugin.playerController.loadEpisode(this.episode,!0,!0),new ee.Notice(`Now playing: ${this.episode.title}`),this.close()}catch(t){console.error("Failed to play episode:",t),new ee.Notice("Failed to start playback")}}handleAddToQueue(){new Ne(this.app,this.plugin,[this.episode],t=>{new ee.Notice("Episode added to queue")}).open()}handleAddToPlaylist(){new ke(this.app,this.plugin,[this.episode],t=>{new ee.Notice("Episode added to playlist")}).open()}async handleExportToNote(){if(!this.podcast){new ee.Notice("Failed to find podcast information");return}try{let t=new ee.Notice("Exporting episode to note...",0),i=await this.plugin.getNoteExporter().exportEpisode(this.episode,this.podcast,this.progress);t.hide(),new ee.Notice(`Note created: ${i.name}`),await this.app.workspace.getLeaf(!1).openFile(i),this.close()}catch(t){console.error("Failed to export to note:",t),new ee.Notice("Failed to export to note")}}formatDuration(t){let r=Math.floor(t/3600),i=Math.floor(t%3600/60),s=Math.floor(t%60);return r>0?`${r}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${i}:${s.toString().padStart(2,"0")}`}formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}formatDescription(t){return t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"")}onClose(){let{contentEl:t}=this;t.empty()}};var It=require("obsidian"),st=class extends It.Modal{constructor(t,r,i,s,a){super(t);this.result=null;this.title=r,this.message=i,this.defaultValue=s,this.onSubmit=a}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.title});let r=this.defaultValue;new It.Setting(t).setName(this.message).addText(s=>s.setValue(this.defaultValue).onChange(a=>{r=a}).inputEl.addEventListener("keydown",a=>{a.key==="Enter"&&(a.preventDefault(),this.result=r,this.close())}));let i=t.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.result=null,this.close()}),i.createEl("button",{text:"OK",cls:"mod-cta"}).addEventListener("click",()=>{this.result=r,this.close()})}onClose(){let{contentEl:t}=this;t.empty(),this.onSubmit(this.result)}};var De="podcast-sidebar-view",at=class extends F.ItemView{constructor(t,r){super(t);this.viewMode="podcasts";this.selectedPodcast=null;this.selectedPlaylist=null;this.selectedQueue=null;this.searchQuery="";this.podcastSortBy="title";this.episodeSortBy="date";this.playlistSortBy="date";this.podcastSortDirection="asc";this.episodeSortDirection="desc";this.playlistSortDirection="asc";this.podcastStats=new Map;this.feedsViewMode="feeds";this.dragStartIndex=-1;this.dragType=null;this.dragTargetId=null;this.plugin=r}async onload(){super.onload(),this.registerEvent(this.app.workspace.on("podcast:queue-updated",async t=>{this.selectedQueue&&this.selectedQueue.id===t&&(this.selectedQueue=await this.plugin.getQueueManager().getQueue(t),await this.render())})),this.registerEvent(this.app.workspace.on("podcast:playlist-updated",async t=>{this.selectedPlaylist&&this.selectedPlaylist.id===t&&(this.selectedPlaylist=await this.plugin.getPlaylistManager().getPlaylist(t),await this.render())}))}getViewType(){return De}getDisplayText(){return"Podcasts"}getIcon(){return"podcast"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("podcast-sidebar-view"),this.sidebarContentEl=t.createDiv({cls:"podcast-sidebar-content"}),await this.render()}async onClose(){}async render(){this.sidebarContentEl.empty(),this.renderHeader(),this.renderSearchBox(),this.selectedPodcast?await this.renderEpisodeList():this.selectedPlaylist?await this.renderPlaylistDetails():this.selectedQueue?await this.renderQueueDetails():this.viewMode==="podcasts"?this.feedsViewMode==="episodes"?await this.renderAllEpisodes():await this.renderPodcastList():await this.renderPlaylistList()}renderSearchBox(){let t=this.sidebarContentEl.createDiv({cls:"sidebar-search-container"}),r=this.selectedPodcast?"Search episodes...":this.selectedPlaylist?"Search playlist episodes...":this.viewMode==="podcasts"?"Search podcasts...":"Search playlists...",i=t.createEl("input",{type:"text",placeholder:r,cls:"sidebar-search-input",value:this.searchQuery}),s=t.createEl("button",{cls:"sidebar-search-button",attr:{"aria-label":"Search"}});(0,F.setIcon)(s,"search");let a=()=>{console.log("Performing search with query:",i.value),this.searchQuery=i.value,this.render()};if(s.addEventListener("click",g=>{console.log("Search button clicked"),a()}),i.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),console.log("Enter key pressed"),a())}),this.searchQuery){let g=t.createEl("button",{cls:"sidebar-search-clear",attr:{"aria-label":"Clear search"}});(0,F.setIcon)(g,"x"),g.addEventListener("click",()=>{console.log("Clear search clicked"),this.searchQuery="",this.render()})}let n="asc",l="";this.selectedPodcast||this.selectedPlaylist?(n=this.episodeSortDirection,l=this.episodeSortBy):this.viewMode==="playlists"?(n=this.playlistSortDirection,l=this.playlistSortBy):(n=this.podcastSortDirection,l=this.podcastSortBy);let u=t.createEl("button",{cls:"sort-direction-button",attr:{"aria-label":"Sort options"}});(0,F.setIcon)(u,n==="asc"?"arrow-up":"arrow-down"),u.addEventListener("click",g=>{let f=new F.Menu;f.addItem(m=>m.setIsLabel(!0).setTitle("Sort by")),this.selectedPodcast||this.selectedPlaylist?(f.addItem(m=>m.setTitle("Title").setChecked(l==="title").onClick(()=>{this.episodeSortBy="title",this.render()})),f.addItem(m=>m.setTitle("Date").setChecked(l==="date").onClick(()=>{this.episodeSortBy="date",this.render()})),f.addItem(m=>m.setTitle("Duration").setChecked(l==="duration").onClick(()=>{this.episodeSortBy="duration",this.render()}))):this.viewMode==="playlists"?(f.addItem(m=>m.setTitle("Name").setChecked(l==="name").onClick(()=>{this.playlistSortBy="name",this.render()})),f.addItem(m=>m.setTitle("Date").setChecked(l==="date").onClick(()=>{this.playlistSortBy="date",this.render()})),f.addItem(m=>m.setTitle("Episode Count").setChecked(l==="count").onClick(()=>{this.playlistSortBy="count",this.render()}))):(f.addItem(m=>m.setTitle("Title").setChecked(l==="title").onClick(()=>{this.podcastSortBy="title",this.render()})),f.addItem(m=>m.setTitle("Author").setChecked(l==="author").onClick(()=>{this.podcastSortBy="author",this.render()})),f.addItem(m=>m.setTitle("Subscribed Date").setChecked(l==="date").onClick(()=>{this.podcastSortBy="date",this.render()})),f.addItem(m=>m.setTitle("Latest Episode").setChecked(l==="latest").onClick(()=>{this.podcastSortBy="latest",this.render()})),f.addItem(m=>m.setTitle("Total Episodes").setChecked(l==="count").onClick(()=>{this.podcastSortBy="count",this.render()})),f.addItem(m=>m.setTitle("Unplayed Count").setChecked(l==="unplayed").onClick(()=>{this.podcastSortBy="unplayed",this.render()}))),f.addSeparator(),f.addItem(m=>m.setIsLabel(!0).setTitle("Order")),f.addItem(m=>m.setTitle("Ascending").setChecked(n==="asc").onClick(()=>this.setSortDirection("asc"))),f.addItem(m=>m.setTitle("Descending").setChecked(n==="desc").onClick(()=>this.setSortDirection("desc"))),f.showAtMouseEvent(g)})}setSortDirection(t){this.selectedPodcast||this.selectedPlaylist?this.episodeSortDirection=t:this.viewMode==="playlists"?this.playlistSortDirection=t:this.podcastSortDirection=t,this.render()}renderHeader(){let t=this.sidebarContentEl.createDiv({cls:"sidebar-header"});if(this.selectedPodcast||this.selectedPlaylist||this.selectedQueue){let s=t.createEl("button",{cls:"sidebar-back-button",attr:{"aria-label":"Back to list"}});(0,F.setIcon)(s,"arrow-left"),s.createSpan({text:" Back"}),s.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),console.log("Back button clicked"),this.selectedPodcast=null,this.selectedPlaylist=null,this.selectedQueue=null,this.render()})}let r="";this.selectedPodcast?r=this.selectedPodcast.title:this.selectedPlaylist?r=this.selectedPlaylist.name:this.selectedQueue?r=this.selectedQueue.name:this.viewMode==="podcasts"?r=this.feedsViewMode==="feeds"?"My Feeds":"All Episodes":r="My Lists",t.createEl("h2",{text:r,cls:"sidebar-title"});let i=t.createDiv({cls:"sidebar-actions"});if(!this.selectedPodcast&&!this.selectedPlaylist&&!this.selectedQueue)if(this.viewMode==="podcasts"){let s=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":this.feedsViewMode==="feeds"?"Show all episodes":"Show feeds"}});(0,F.setIcon)(s,this.feedsViewMode==="feeds"?"list":"rss"),s.addEventListener("click",()=>{this.feedsViewMode=this.feedsViewMode==="feeds"?"episodes":"feeds",this.render()});let a=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":"Subscribe to podcast"}});(0,F.setIcon)(a,"plus"),a.addEventListener("click",()=>this.handleAddPodcast());let n=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":"Refresh feeds"}});(0,F.setIcon)(n,"refresh-cw"),n.addEventListener("click",()=>this.handleRefreshFeeds())}else{let s=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":"Create new"}});(0,F.setIcon)(s,"plus"),s.addEventListener("click",a=>{let n=new F.Menu;n.addItem(l=>l.setTitle("New Queue").setIcon("list-ordered").onClick(()=>this.handleCreateQueue())),n.addItem(l=>l.setTitle("New Playlist").setIcon("folder-plus").onClick(()=>this.handleCreatePlaylist())),n.showAtMouseEvent(a)})}else if(this.selectedPodcast){let s=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":"Podcast settings"}});(0,F.setIcon)(s,"settings"),s.addEventListener("click",()=>this.handlePodcastSettings())}else if(this.selectedPlaylist){let s=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":"Rename playlist"}});(0,F.setIcon)(s,"pencil"),s.addEventListener("click",()=>this.handleRenamePlaylist())}else if(this.selectedQueue){let s=i.createEl("button",{cls:"sidebar-action-button",attr:{"aria-label":"Rename queue"}});(0,F.setIcon)(s,"pencil"),s.addEventListener("click",()=>this.handleRenameQueue())}if(!this.selectedPodcast&&!this.selectedPlaylist){let s=this.sidebarContentEl.createDiv({cls:"sidebar-mode-toggle"});s.createEl("button",{text:"Feeds",cls:this.viewMode==="podcasts"?"mode-active":"mode-inactive"}).addEventListener("click",()=>{this.viewMode="podcasts",this.render()}),s.createEl("button",{text:"Lists",cls:this.viewMode==="playlists"?"mode-active":"mode-inactive"}).addEventListener("click",()=>{this.viewMode="playlists",this.render()})}}async renderPodcastList(){let t=this.sidebarContentEl.createDiv({cls:"podcast-list-container"}),r=await this.loadPodcasts();if(await this.loadPodcastStats(r),this.searchQuery&&(r=this.filterPodcasts(r,this.searchQuery)),r=this.sortPodcasts(r,this.podcastSortBy,this.podcastSortDirection),r.length===0){let i=t.createDiv({cls:"empty-state"});this.searchQuery?(i.createEl("p",{text:"No podcasts found"}),i.createEl("p",{text:`No podcasts match "${this.searchQuery}"`,cls:"empty-state-hint"})):(i.createEl("p",{text:"No podcasts yet"}),i.createEl("p",{text:"Click the + button to subscribe to a podcast",cls:"empty-state-hint"}));return}for(let i of r)this.renderPodcastItem(t,i)}async renderAllEpisodes(){let t=this.sidebarContentEl.createDiv({cls:"episode-list-container"}),i=await this.plugin.getSubscriptionStore().getAllPodcasts(),s=[],a=new Map;for(let n of i)a.set(n.id,n),n.episodes&&(s=s.concat(n.episodes));if(this.searchQuery&&(s=this.filterEpisodes(s,this.searchQuery)),s=this.sortEpisodes(s,this.episodeSortBy,this.episodeSortDirection),s.length===0){let n=t.createDiv({cls:"empty-state"});this.searchQuery?(n.createEl("p",{text:"No episodes found"}),n.createEl("p",{text:`No episodes match "${this.searchQuery}"`,cls:"empty-state-hint"})):(n.createEl("p",{text:"No episodes yet"}),n.createEl("p",{text:"Subscribe to podcasts to see episodes here",cls:"empty-state-hint"}));return}for(let n of s){let l=a.get(n.podcastId);this.renderAllEpisodesItem(t,n,l)}}renderAllEpisodesItem(t,r,i){let s=t.createDiv({cls:"episode-item all-episodes-item"}),a=s.createDiv({cls:"episode-info"});a.createEl("div",{text:r.title,cls:"episode-title"});let n=a.createDiv({cls:"episode-meta"});i&&(n.createSpan({text:i.title,cls:"episode-podcast-name"}),n.createSpan({text:" \u2022 ",cls:"episode-meta-separator"})),n.createSpan({text:this.formatDate(new Date(r.publishDate)),cls:"episode-date"}),r.duration&&(n.createSpan({text:" \u2022 ",cls:"episode-meta-separator"}),n.createSpan({text:this.formatDuration(r.duration),cls:"episode-duration"}));let l=s.createDiv({cls:"episode-actions"}),u=l.createEl("button",{cls:"episode-action-button",attr:{"aria-label":"Play episode"}});(0,F.setIcon)(u,"play"),u.addEventListener("click",f=>{f.stopPropagation(),this.handlePlayEpisode(r)});let g=l.createEl("button",{cls:"episode-action-button",attr:{"aria-label":"Add to queue or playlist"}});(0,F.setIcon)(g,"plus"),g.addEventListener("click",f=>{f.stopPropagation(),this.showAddToPlaylistMenu(r,f)}),s.addEventListener("click",()=>this.handleEpisodeClick(r)),s.addEventListener("contextmenu",f=>{f.preventDefault(),this.showEpisodeContextMenu(r,f)})}renderPodcastItem(t,r){var n;let i=t.createDiv({cls:"podcast-item"});if(r.imageUrl){let l=i.createEl("img",{cls:"podcast-image",attr:{src:r.imageUrl,alt:r.title}})}else{let l=i.createDiv({cls:"podcast-image-placeholder"});(0,F.setIcon)(l,"mic")}let s=i.createDiv({cls:"podcast-info"});s.createEl("h3",{text:r.title,cls:"podcast-title"}),s.createEl("p",{text:r.author,cls:"podcast-author"});let a=this.podcastStats.get(r.id);if(a){let l=[];l.push(`${a.totalEpisodes} eps`),a.unplayedEpisodes>0&&l.push(`${a.unplayedEpisodes} new`),s.createDiv({text:l.join(" \u2022 "),cls:"podcast-episode-count"})}else{let l=((n=r.episodes)==null?void 0:n.length)||0;s.createDiv({text:`${l} episodes`,cls:"podcast-episode-count"})}i.addEventListener("click",()=>{this.selectedPodcast=r,this.episodeSortBy="date",this.episodeSortDirection="desc",this.render()}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showPodcastContextMenu(r,l)})}async renderEpisodeList(){if(!this.selectedPodcast)return;let t=this.sidebarContentEl.createDiv({cls:"episode-list-container"}),r=this.selectedPodcast.episodes||[];if(this.searchQuery&&(r=this.filterEpisodes(r,this.searchQuery)),r=this.sortEpisodes(r,this.episodeSortBy,this.episodeSortDirection),r.length===0){let i=t.createDiv({cls:"empty-state"});this.searchQuery?(i.createEl("p",{text:"No episodes found"}),i.createEl("p",{text:`No episodes match "${this.searchQuery}"`,cls:"empty-state-hint"})):(i.createEl("p",{text:"No episodes available"}),i.createEl("p",{text:"Try refreshing the feed",cls:"empty-state-hint"}));return}for(let i of r)this.renderEpisodeItem(t,i)}renderEpisodeItem(t,r){let i=t.createDiv({cls:"episode-item"}),s=i.createDiv({cls:"episode-info"});s.createEl("h4",{text:r.title,cls:"episode-title"});let a=s.createDiv({cls:"episode-metadata"}),n=new Date(r.publishDate);a.createSpan({text:n.toLocaleDateString(),cls:"episode-date"}),r.duration&&a.createSpan({text:` \u2022 ${this.formatDuration(r.duration)}`,cls:"episode-duration"});let l=i.createDiv({cls:"episode-item-actions"}),u=l.createEl("button",{cls:"episode-action-button",attr:{"aria-label":"Play"}});(0,F.setIcon)(u,"play"),u.addEventListener("click",f=>{f.stopPropagation(),this.handlePlayEpisode(r,!0)});let g=l.createEl("button",{cls:"episode-action-button",attr:{"aria-label":"Add to playlist"}});(0,F.setIcon)(g,"plus"),g.addEventListener("click",f=>{f.stopPropagation(),this.showAddToPlaylistMenu(r,f)}),i.addEventListener("click",()=>{this.handleEpisodeClick(r)}),i.addEventListener("contextmenu",f=>{f.preventDefault(),this.showEpisodeContextMenu(r,f)})}async handleAddPodcast(){new Fe(this.app,this.plugin,async t=>{console.log(`Successfully subscribed to podcast: ${t}`),await this.render()}).open()}async handleRefreshFeeds(){try{let t=this.plugin.getFeedSyncManager(),r=new F.Notice("Refreshing feeds...",0),i=await t.syncAll();r.hide(),new F.Notice(`Refreshed ${i.successCount} feeds. ${i.failureCount} failed.`),await this.render()}catch(t){console.error("Failed to refresh feeds:",t),new F.Notice("Failed to refresh feeds")}}handlePodcastSettings(){this.selectedPodcast&&new it(this.app,this.plugin,this.selectedPodcast,async(t,r)=>{try{let i=this.plugin.getSubscriptionStore();this.selectedPodcast.settings=t,this.selectedPodcast.autoAddRule=r,await i.updatePodcast(this.selectedPodcast),new F.Notice("Podcast settings updated"),await this.render()}catch(i){console.error("Failed to save podcast settings:",i),new F.Notice("Failed to save settings")}}).open()}async showAddToPlaylistMenu(t,r){let i=new F.Menu,s=this.plugin.getPlaylistManager(),a=this.plugin.getQueueManager();i.addItem(u=>u.setTitle("Queues").setIsLabel(!0)),(await a.getAllQueues()).forEach(u=>{i.addItem(g=>g.setTitle(u.name).setIcon("list-ordered").onClick(async()=>{try{await a.addEpisode(u.id,t.id),new F.Notice(`Added to queue: ${u.name}`)}catch(f){console.error(f),new F.Notice("Failed to add to queue")}}))}),i.addItem(u=>u.setTitle("New Queue...").setIcon("plus").onClick(async()=>{let g=await this.promptForInput("New Queue","Enter queue name:");if(g){let f=await a.createQueue(g);await a.addEpisode(f.id,t.id),new F.Notice(`Created queue "${g}" and added episode`),await this.render()}})),i.addSeparator(),i.addItem(u=>u.setTitle("Playlists").setIsLabel(!0)),(await s.getAllPlaylists()).forEach(u=>{i.addItem(g=>g.setTitle(u.name).setIcon("list").onClick(async()=>{try{await s.addEpisode(u.id,t.id),new F.Notice(`Added to playlist: ${u.name}`)}catch(f){console.error(f),new F.Notice("Failed to add to playlist")}}))}),i.addItem(u=>u.setTitle("New Playlist...").setIcon("plus").onClick(async()=>{let g=await this.promptForInput("New Playlist","Enter playlist name:");if(g){let f=await s.createPlaylist(g);await s.addEpisode(f.id,t.id),new F.Notice(`Created playlist "${g}" and added episode`),await this.render()}})),i.showAtMouseEvent(r)}async handlePlayPlaylist(t){if(t.episodeIds.length===0){new F.Notice("Playlist is empty");return}let r=this.plugin.getEpisodeManager(),i=t.episodeIds[0],s=await r.getEpisodeWithProgress(i);s?await this.handlePlayEpisode(s,!1,t):new F.Notice("Failed to load first episode of playlist")}async handlePlayEpisode(t,r=!1,i){try{let s=this.plugin.playerController,a=this.plugin.getQueueManager();if(i){let l=(await a.getAllQueues()).find(g=>g.name===`Playlist: ${i.name}`);l||(l=await a.createQueue(`Playlist: ${i.name}`)),await a.updateQueue(l.id,{isPlaylist:!0,sourceId:i.id}),await a.clearQueue(l.id);for(let g of i.episodeIds)await a.addEpisode(l.id,g);let u=i.episodeIds.indexOf(t.id);u!==-1&&await a.jumpTo(l.id,u),a.setCurrentQueue(l.id)}else if(r){let n=await a.getCurrentQueue();if(!n){let l=await a.getAllQueues();l.length>0?n=l[0]:n=await a.createQueue("Default Queue"),a.setCurrentQueue(n.id)}await a.insertEpisode(n.id,t.id,0),await a.jumpTo(n.id,0)}else if(this.selectedPodcast){let n=`Podcast: ${this.selectedPodcast.title}`,l=this.selectedPodcast.episodes||[];this.searchQuery&&(l=this.filterEpisodes(l,this.searchQuery)),l=this.sortEpisodes(l,this.episodeSortBy,this.episodeSortDirection);let g=(await a.getAllQueues()).find(y=>y.name===n);g||(g=await a.createQueue(n)),await a.clearQueue(g.id);let f=l.map(y=>y.id);await a.addEpisodes(g.id,f);let m=f.indexOf(t.id);m!==-1&&await a.jumpTo(g.id,m),a.setCurrentQueue(g.id)}await s.loadEpisode(t,!0,!0),new F.Notice(`Now playing: ${t.title}`)}catch(s){console.error("Failed to play episode:",s),new F.Notice("Failed to start playback")}}handleEpisodeClick(t){new Te(this.app,this.plugin,t).open()}showPodcastContextMenu(t,r){let i=new F.Menu;i.addItem(s=>s.setTitle("View Episodes").setIcon("list").onClick(()=>{this.selectedPodcast=t,this.render()})),i.addItem(s=>s.setTitle("Refresh Feed").setIcon("refresh-cw").onClick(()=>{console.log("Refresh feed:",t.title)})),i.addSeparator(),i.addItem(s=>s.setTitle("Unsubscribe").setIcon("trash").onClick(()=>{console.log("Unsubscribe:",t.title)})),i.showAtMouseEvent(r)}showEpisodeContextMenu(t,r){let i=new F.Menu;i.addItem(s=>s.setTitle("View Details").setIcon("info").onClick(()=>this.handleEpisodeClick(t))),i.addSeparator(),i.addItem(s=>s.setTitle("Play").setIcon("play").onClick(()=>this.handlePlayEpisode(t))),i.addItem(s=>s.setTitle("Add to Queue").setIcon("list-plus").onClick(()=>{new Ne(this.app,this.plugin,[t],a=>{console.log(`Added episode to queue: ${a}`)}).open()})),i.addItem(s=>s.setTitle("Add to Playlist").setIcon("folder-plus").onClick(()=>{new ke(this.app,this.plugin,[t],a=>{console.log(`Added episode to playlist: ${a}`)}).open()})),i.addSeparator(),i.addItem(s=>s.setTitle("Export to Note").setIcon("file-text").onClick(()=>{this.handleExportToNote(t)})),i.showAtMouseEvent(r)}async handleExportToNote(t){try{let r=new F.Notice("Exporting episode to note...",0),s=await this.plugin.getSubscriptionStore().getPodcast(t.podcastId);if(!s){r.hide(),new F.Notice("Failed to find podcast information");return}let n=await this.plugin.getEpisodeManager().getEpisodeWithProgress(t.id),l=n==null?void 0:n.progress,g=await this.plugin.getNoteExporter().exportEpisode(t,s,l);r.hide(),new F.Notice(`Note created: ${g.name}`),await this.app.workspace.getLeaf(!1).openFile(g)}catch(r){console.error("Failed to export to note:",r),new F.Notice("Failed to export to note")}}formatDuration(t){let r=Math.floor(t/3600),i=Math.floor(t%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}async loadPodcasts(){try{return await this.plugin.getSubscriptionStore().getAllPodcasts()}catch(t){return console.error("Failed to load podcasts:",t),[]}}async loadPodcastStats(t){let r=this.plugin.getEpisodeManager();for(let i of t)if(!this.podcastStats.has(i.id)){let s=await r.getPodcastStatistics(i.id);this.podcastStats.set(i.id,s)}}filterPodcasts(t,r){let i=r.toLowerCase();return t.filter(s=>{var a,n;return!!(s.title.toLowerCase().includes(i)||(a=s.author)!=null&&a.toLowerCase().includes(i)||(n=s.description)!=null&&n.toLowerCase().includes(i))})}filterEpisodes(t,r){let i=r.toLowerCase();return t.filter(s=>{var a;return!!(s.title.toLowerCase().includes(i)||(a=s.description)!=null&&a.toLowerCase().includes(i))})}sortPodcasts(t,r,i){return[...t].sort((a,n)=>{var u,g,f,m;let l=0;switch(r){case"title":l=a.title.localeCompare(n.title);break;case"author":l=(a.author||"").localeCompare(n.author||"");break;case"date":let y=new Date(a.subscribedAt).getTime(),P=new Date(n.subscribedAt).getTime();l=y-P;break;case"latest":let I=this.getLatestEpisodeDate(a),A=this.getLatestEpisodeDate(n);l=I-A;break;case"count":let T=((u=this.podcastStats.get(a.id))==null?void 0:u.totalEpisodes)||0,k=((g=this.podcastStats.get(n.id))==null?void 0:g.totalEpisodes)||0;l=T-k;break;case"unplayed":let w=((f=this.podcastStats.get(a.id))==null?void 0:f.unplayedEpisodes)||0,h=((m=this.podcastStats.get(n.id))==null?void 0:m.unplayedEpisodes)||0;l=w-h;break}return i==="asc"?l:-l})}getLatestEpisodeDate(t){if(!t.episodes||t.episodes.length===0)return 0;let r=t.episodes.map(i=>new Date(i.publishDate).getTime());return Math.max(...r)}sortEpisodes(t,r,i){return[...t].sort((a,n)=>{let l=0;switch(r){case"title":l=a.title.localeCompare(n.title);break;case"date":let u=new Date(a.publishDate).getTime(),g=new Date(n.publishDate).getTime();l=u-g;break;case"duration":l=a.duration-n.duration;break}return i==="asc"?l:-l})}async renderPlaylistList(){let t=this.sidebarContentEl.createDiv({cls:"playlist-list-container"}),i=await this.plugin.getQueueManager().getAllQueues();if(i.length>0&&!this.searchQuery){let n=t.createDiv({cls:"queue-section-sidebar"});n.createEl("h4",{text:"Queues",cls:"section-title"});for(let l of i)this.renderQueueAsPlaylistItem(n,l)}let a=await this.plugin.getPlaylistManager().getAllPlaylists();if(this.searchQuery&&(a=this.filterPlaylists(a,this.searchQuery)),a=this.sortPlaylists(a,this.playlistSortBy,this.playlistSortDirection),a.length>0||this.searchQuery){let n=t.createDiv({cls:"playlist-section-sidebar"});if(this.searchQuery||n.createEl("h4",{text:"Playlists",cls:"section-title"}),a.length===0){let l=n.createDiv({cls:"empty-state"});this.searchQuery?(l.createEl("p",{text:"No playlists found"}),l.createEl("p",{text:`No playlists match "${this.searchQuery}"`,cls:"empty-state-hint"})):(l.createEl("p",{text:"No playlists yet"}),l.createEl("p",{text:"Click the + button to create a playlist",cls:"empty-state-hint"}))}else for(let l of a)this.renderPlaylistItem(n,l)}else if(i.length===0){let n=t.createDiv({cls:"empty-state"});n.createEl("p",{text:"No playlists yet"}),n.createEl("p",{text:"Click the + button to create a playlist",cls:"empty-state-hint"})}}renderQueueAsPlaylistItem(t,r){let i=t.createDiv({cls:"playlist-item queue-item"}),s=i.createDiv({cls:"playlist-info"});s.createEl("h3",{text:r.name,cls:"playlist-title"});let a=s.createDiv({cls:"playlist-metadata"});a.createSpan({text:`${r.episodeIds.length} episodes`,cls:"playlist-count"}),a.createSpan({text:` \u2022 Updated ${this.formatDate(r.updatedAt)}`,cls:"playlist-date"});let n=i.createEl("button",{cls:"playlist-play-button",attr:{"aria-label":"Play queue"}});(0,F.setIcon)(n,"play"),n.addEventListener("click",async l=>{l.stopPropagation(),await this.handlePlayQueue(r)}),i.addEventListener("click",()=>{this.showQueueDetails(r)}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showQueueContextMenu(r,l)})}async handlePlayQueue(t){if(t.episodeIds.length===0){new F.Notice("Queue is empty");return}try{this.plugin.getQueueManager().setCurrentQueue(t.id);let i=this.plugin.getEpisodeManager(),s=t.episodeIds[t.currentIndex]||t.episodeIds[0],a=await i.getEpisodeWithProgress(s);a&&await this.plugin.playerController.loadEpisode(a,!0,!0)}catch(r){console.error("Failed to play queue:",r),new F.Notice("Failed to play queue")}}async showQueueDetails(t){this.selectedQueue=t,await this.render()}showQueueContextMenu(t,r){let i=new F.Menu;i.addItem(s=>s.setTitle("View Details").setIcon("list").onClick(()=>{this.showQueueDetails(t)})),i.addItem(s=>s.setTitle("Play").setIcon("play").onClick(async()=>{await this.handlePlayQueue(t)})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(async()=>{let a=await this.promptForInput("Rename Queue","Enter new name:",t.name);if(!(!a||a===t.name))try{await this.plugin.getQueueManager().updateQueue(t.id,{name:a}),new F.Notice("Queue renamed"),await this.render()}catch(n){console.error("Failed to rename queue:",n),new F.Notice("Failed to rename queue")}})),i.addSeparator(),i.addItem(s=>s.setTitle("Clear Queue").setIcon("eraser").onClick(async()=>{try{await this.plugin.getQueueManager().clearQueue(t.id),new F.Notice("Queue cleared"),await this.render()}catch(a){console.error("Failed to clear queue:",a),new F.Notice("Failed to clear queue")}})),i.addItem(s=>s.setTitle("Delete Queue").setIcon("trash").onClick(async()=>{try{await this.plugin.getQueueManager().deleteQueue(t.id),new F.Notice("Queue deleted"),await this.render()}catch(a){console.error("Failed to delete queue:",a),new F.Notice("Failed to delete queue")}})),i.showAtMouseEvent(r)}renderPlaylistItem(t,r){let i=t.createDiv({cls:"playlist-item"}),s=i.createDiv({cls:"playlist-info"});s.createEl("h3",{text:r.name,cls:"playlist-title"}),r.description&&s.createEl("p",{text:r.description,cls:"playlist-description"});let a=s.createDiv({cls:"playlist-metadata"});a.createSpan({text:`${r.episodeIds.length} episodes`,cls:"playlist-count"}),a.createSpan({text:` \u2022 Updated ${this.formatDate(r.updatedAt)}`,cls:"playlist-date"});let n=i.createEl("button",{cls:"playlist-play-button",attr:{"aria-label":"Play playlist"}});(0,F.setIcon)(n,"play"),n.addEventListener("click",l=>{l.stopPropagation(),this.handlePlayPlaylist(r)}),i.addEventListener("click",()=>{this.selectedPlaylist=r,this.render()}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showPlaylistContextMenu(r,l)})}async renderPlaylistDetails(){if(!this.selectedPlaylist)return;let t=this.sidebarContentEl.createDiv({cls:"playlist-details-container"}),r=t.createDiv({cls:"playlist-details-metadata"});this.selectedPlaylist.description&&r.createEl("p",{text:this.selectedPlaylist.description,cls:"playlist-details-description"}),r.createEl("p",{text:`${this.selectedPlaylist.episodeIds.length} episodes \u2022 Created ${this.formatDate(this.selectedPlaylist.createdAt)}`,cls:"playlist-details-info"}),await this.renderPlaylistEpisodeList(t,this.selectedPlaylist.episodeIds)}async renderPlaylistEpisodeList(t,r){if(r.length===0){t.createDiv({cls:"empty-state"}).createEl("p",{text:"No episodes in this playlist"});return}let i=this.plugin.getEpisodeManager(),s=t.createDiv({cls:"playlist-episode-list"});for(let a=0;a<r.length;a++){let n=r[a];try{let l=await i.getEpisodeWithProgress(n);l&&this.renderPlaylistEpisodeItem(s,l,a)}catch(l){console.error(`Failed to load episode: ${n}`,l)}}}renderPlaylistEpisodeItem(t,r,i){let s=t.createDiv({cls:"playlist-episode-item"});s.draggable=!0,s.addEventListener("dragstart",f=>{this.selectedPlaylist&&this.handleDragStart(f,i,"playlist",this.selectedPlaylist.id)}),s.addEventListener("dragover",this.handleDragOver),s.addEventListener("dragenter",this.handleDragEnter),s.addEventListener("dragleave",this.handleDragLeave),s.addEventListener("drop",f=>{this.selectedPlaylist&&this.handleDrop(f,i,"playlist",this.selectedPlaylist.id)});let a=s.createDiv({cls:"playlist-episode-index"});a.textContent=`${i+1}`;let n=s.createDiv({cls:"playlist-episode-info"});n.createEl("h4",{text:r.title,cls:"playlist-episode-title"});let l=n.createDiv({cls:"playlist-episode-metadata"});r.duration&&l.createSpan({text:this.formatDuration(r.duration),cls:"playlist-episode-duration"});let u=s.createEl("button",{cls:"playlist-episode-play",attr:{"aria-label":"Play episode"}});(0,F.setIcon)(u,"play"),u.addEventListener("click",f=>{f.stopPropagation(),this.handlePlayEpisode(r,!1,this.selectedPlaylist||void 0)});let g=s.createEl("button",{cls:"playlist-episode-delete",attr:{"aria-label":"Remove from playlist"}});(0,F.setIcon)(g,"trash"),g.addEventListener("click",async f=>{if(f.stopPropagation(),this.selectedPlaylist){let m=this.plugin.getPlaylistManager();await m.removeEpisode(this.selectedPlaylist.id,r.id),this.selectedPlaylist=await m.getPlaylist(this.selectedPlaylist.id),await this.render()}}),s.addEventListener("click",()=>{this.handleEpisodeClick(r)}),s.addEventListener("contextmenu",f=>{f.preventDefault(),this.showPlaylistEpisodeContextMenu(r,i,f)})}renderQueueEpisodeItem(t,r,i){let s=t.createDiv({cls:"playlist-episode-item"});s.draggable=!0,s.addEventListener("dragstart",f=>{this.selectedQueue&&this.handleDragStart(f,i,"queue",this.selectedQueue.id)}),s.addEventListener("dragover",this.handleDragOver),s.addEventListener("dragenter",this.handleDragEnter),s.addEventListener("dragleave",this.handleDragLeave),s.addEventListener("drop",f=>{this.selectedQueue&&this.handleDrop(f,i,"queue",this.selectedQueue.id)});let a=s.createDiv({cls:"playlist-episode-index"});a.textContent=`${i+1}`;let n=s.createDiv({cls:"playlist-episode-info"});n.createEl("h4",{text:r.title,cls:"playlist-episode-title"});let l=n.createDiv({cls:"playlist-episode-metadata"});r.duration&&l.createSpan({text:this.formatDuration(r.duration),cls:"playlist-episode-duration"});let u=s.createEl("button",{cls:"playlist-episode-play",attr:{"aria-label":"Play episode"}});(0,F.setIcon)(u,"play"),u.addEventListener("click",f=>{f.stopPropagation(),this.handlePlayEpisode(r)});let g=s.createEl("button",{cls:"playlist-episode-delete",attr:{"aria-label":"Remove from queue"}});(0,F.setIcon)(g,"trash"),g.addEventListener("click",async f=>{if(f.stopPropagation(),this.selectedQueue){let m=this.plugin.getQueueManager();await m.removeEpisode(this.selectedQueue.id,r.id),this.selectedQueue=await m.getQueue(this.selectedQueue.id),await this.render()}}),s.addEventListener("click",()=>{this.handleEpisodeClick(r)}),s.addEventListener("contextmenu",f=>{f.preventDefault(),this.showEpisodeContextMenu(r,f)})}handleDragStart(t,r,i,s){this.dragStartIndex=r,this.dragType=i,this.dragTargetId=s,t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",JSON.stringify({index:r,type:i,id:s}))),t.target.addClass("dragging")}handleDragOver(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move"),!1}handleDragEnter(t){var r;(r=t.target.closest(".playlist-episode-item"))==null||r.addClass("drag-over")}handleDragLeave(t){var r;(r=t.target.closest(".playlist-episode-item"))==null||r.removeClass("drag-over")}async handleDrop(t,r,i,s){var a;if(t.stopPropagation(),(a=t.target.closest(".playlist-episode-item"))==null||a.removeClass("drag-over"),!(this.dragStartIndex===r||this.dragType!==i||this.dragTargetId!==s)){try{if(i==="playlist"){let n=this.plugin.getPlaylistManager(),l=await n.getPlaylist(s);if(l){let u=l.episodeIds[this.dragStartIndex];l.episodeIds.splice(this.dragStartIndex,1),l.episodeIds.splice(r,0,u),await n.updatePlaylist(s,{episodeIds:l.episodeIds}),this.selectedPlaylist=l}}else if(i==="queue"){let n=this.plugin.getQueueManager(),l=await n.getQueue(s);if(l){let u=l.episodeIds[this.dragStartIndex];l.episodeIds.splice(this.dragStartIndex,1),l.episodeIds.splice(r,0,u),await n.updateQueue(s,{episodeIds:l.episodeIds}),this.selectedQueue=l}}await this.render()}catch(n){console.error("Failed to reorder:",n),new F.Notice("Failed to reorder items")}finally{document.querySelectorAll(".dragging").forEach(n=>n.removeClass("dragging")),this.dragStartIndex=-1,this.dragType=null,this.dragTargetId=null}return!1}}async handleCreatePlaylist(){try{let t=await this.promptForInput("Create Playlist","Enter playlist name:");if(!t)return;let r=await this.promptForInput("Playlist Description","Enter description (optional):"),s=await this.plugin.getPlaylistManager().createPlaylist(t,r||void 0);new F.Notice(`Playlist "${t}" created`),await this.render()}catch(t){console.error("Failed to create playlist:",t),new F.Notice("Failed to create playlist")}}async handleCreateQueue(){try{let t=await this.promptForInput("Create Queue","Enter queue name:");if(!t)return;await this.plugin.getQueueManager().createQueue(t),new F.Notice(`Queue "${t}" created`),await this.render()}catch(t){console.error("Failed to create queue:",t),new F.Notice("Failed to create queue")}}async handleRenamePlaylist(){this.selectedPlaylist&&new rt(this.app,"Rename Playlist",this.selectedPlaylist.name,"Enter new playlist name",async t=>{if(!(!this.selectedPlaylist||!t||t===this.selectedPlaylist.name))try{let r=this.plugin.getPlaylistManager();await r.updatePlaylist(this.selectedPlaylist.id,{name:t}),new F.Notice(`Playlist renamed to "${t}"`),this.selectedPlaylist=await r.getPlaylist(this.selectedPlaylist.id),await this.render()}catch(r){console.error("Failed to rename playlist:",r),new F.Notice("Failed to rename playlist")}},async()=>{if(this.selectedPlaylist)try{await this.plugin.getPlaylistManager().deletePlaylist(this.selectedPlaylist.id),new F.Notice("Playlist deleted"),this.selectedPlaylist=null,await this.render()}catch(t){console.error("Failed to delete playlist:",t),new F.Notice("Failed to delete playlist")}}).open()}async renderQueueDetails(){if(!this.selectedQueue)return;let t=this.sidebarContentEl.createDiv({cls:"playlist-details-container"}),r=t.createDiv({cls:"playlist-details-header"});r.style.display="flex",r.style.justifyContent="space-between",r.style.alignItems="center",r.style.marginBottom="var(--size-4-3)",r.createDiv({cls:"playlist-details-metadata"}).createEl("p",{text:`${this.selectedQueue.episodeIds.length} episodes`,cls:"playlist-details-count"});let s=r.createEl("button",{text:"Play Queue",cls:"playlist-play-all-button"});(0,F.setIcon)(s,"play"),s.addEventListener("click",()=>{this.selectedQueue&&this.handlePlayQueue(this.selectedQueue)});let a=t.createDiv({cls:"episode-list-container"});if(this.selectedQueue.episodeIds.length===0){a.createDiv({cls:"empty-state"}).createEl("p",{text:"Queue is empty"});return}let n=this.plugin.getEpisodeManager(),l=[];for(let u of this.selectedQueue.episodeIds){let g=await n.getEpisodeWithProgress(u);g&&l.push(g)}l.forEach((u,g)=>{this.renderQueueEpisodeItem(a,u,g)})}async handleRenameQueue(){this.selectedQueue&&new rt(this.app,"Rename Queue",this.selectedQueue.name,"Enter new queue name",async t=>{if(!(!this.selectedQueue||!t||t===this.selectedQueue.name))try{await this.plugin.getQueueManager().updateQueue(this.selectedQueue.id,{name:t}),this.selectedQueue.name=t,new F.Notice("Queue renamed"),await this.render()}catch(r){console.error("Failed to rename queue:",r),new F.Notice("Failed to rename queue")}},async()=>{if(this.selectedQueue)try{await this.plugin.getQueueManager().deleteQueue(this.selectedQueue.id),new F.Notice("Queue deleted"),this.selectedQueue=null,await this.render()}catch(t){console.error("Failed to delete queue:",t),new F.Notice("Failed to delete queue")}}).open()}showPlaylistContextMenu(t,r){let i=new F.Menu;i.addItem(s=>s.setTitle("View Details").setIcon("list").onClick(()=>{this.selectedPlaylist=t,this.render()})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(async()=>{let a=await this.promptForInput("Rename Playlist","Enter new name:",t.name);if(!(!a||a===t.name))try{await this.plugin.getPlaylistManager().updatePlaylist(t.id,{name:a}),new F.Notice("Playlist renamed"),await this.render()}catch(n){console.error("Failed to rename playlist:",n),new F.Notice("Failed to rename playlist")}})),i.addSeparator(),i.addItem(s=>s.setTitle("Delete").setIcon("trash").onClick(async()=>{try{await this.plugin.getPlaylistManager().deletePlaylist(t.id),new F.Notice("Playlist deleted"),await this.render()}catch(a){console.error("Failed to delete playlist:",a),new F.Notice("Failed to delete playlist")}})),i.showAtMouseEvent(r)}showPlaylistEpisodeContextMenu(t,r,i){let s=new F.Menu;s.addItem(a=>a.setTitle("View Details").setIcon("info").onClick(()=>this.handleEpisodeClick(t))),s.addSeparator(),s.addItem(a=>a.setTitle("Play").setIcon("play").onClick(()=>this.handlePlayEpisode(t,!1,this.selectedPlaylist||void 0))),s.addSeparator(),s.addItem(a=>a.setTitle("Remove from Playlist").setIcon("trash").onClick(async()=>{try{if(this.selectedPlaylist){let n=this.plugin.getPlaylistManager();await n.removeEpisode(this.selectedPlaylist.id,t.id),this.selectedPlaylist=await n.getPlaylist(this.selectedPlaylist.id),new F.Notice("Episode removed from playlist"),await this.render()}}catch(n){console.error("Failed to remove episode:",n),new F.Notice("Failed to remove episode")}})),s.showAtMouseEvent(i)}filterPlaylists(t,r){let i=r.toLowerCase();return t.filter(s=>{var a;return!!(s.name.toLowerCase().includes(i)||(a=s.description)!=null&&a.toLowerCase().includes(i))})}sortPlaylists(t,r,i){return[...t].sort((a,n)=>{let l=0;switch(r){case"name":l=a.name.localeCompare(n.name);break;case"date":let u=new Date(a.createdAt).getTime(),g=new Date(n.createdAt).getTime();l=u-g;break;case"count":l=a.episodeIds.length-n.episodeIds.length;break}return i==="asc"?l:-l})}formatDate(t){let i=new Date().getTime()-new Date(t).getTime(),s=Math.floor(i/(1e3*60*60*24));if(s===0)return"today";if(s===1)return"yesterday";if(s<7)return`${s} days ago`;if(s<30){let a=Math.floor(s/7);return`${a} week${a>1?"s":""} ago`}else{let a=Math.floor(s/30);return`${a} month${a>1?"s":""} ago`}}async promptForInput(t,r,i){return new Promise(s=>{new st(this.app,t,r,i||"",n=>s(n)).open()})}async refresh(){await this.render()}};var j=require("obsidian");var Ie="playlist-queue-view",ot=class extends j.ItemView{constructor(t,r){super(t);this.viewMode="playlists";this.selectedPlaylist=null;this.selectedQueue=null;this.searchQuery="";this.sortBy="date";this.sortDirection="desc";this.plugin=r}getViewType(){return Ie}getDisplayText(){return"Playlists & Queues"}getIcon(){return"list-music"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("playlist-queue-view"),this.pqContentEl=t.createDiv({cls:"playlist-queue-content"}),await this.render()}async onClose(){}async render(){this.pqContentEl.empty(),this.renderHeader(),!this.selectedPlaylist&&!this.selectedQueue&&(this.renderSearchBox(),this.renderSortOptions()),this.selectedPlaylist?await this.renderPlaylistDetails():this.selectedQueue?await this.renderQueueDetails():this.viewMode==="playlists"?await this.renderPlaylistList():await this.renderQueueList()}renderSearchBox(){let t=this.pqContentEl.createDiv({cls:"pq-search-container"});if(t.createEl("input",{type:"text",placeholder:`Search ${this.viewMode}...`,cls:"pq-search-input",value:this.searchQuery}).addEventListener("input",i=>{this.searchQuery=i.target.value,this.render()}),this.searchQuery){let i=t.createEl("button",{cls:"pq-search-clear",attr:{"aria-label":"Clear search"}});(0,j.setIcon)(i,"x"),i.addEventListener("click",()=>{this.searchQuery="",this.render()})}}renderSortOptions(){let t=this.pqContentEl.createDiv({cls:"pq-sort-container"}),r=t.createSpan({text:"Sort: ",cls:"sort-label"}),i=t.createEl("select",{cls:"sort-select"}),s=i.createEl("option",{value:"name",text:"Name"}),a=i.createEl("option",{value:"date",text:"Date"}),n=i.createEl("option",{value:"count",text:"Episode Count"});i.value=this.sortBy,i.addEventListener("change",u=>{this.sortBy=u.target.value,this.render()});let l=t.createEl("button",{cls:"sort-direction-button",attr:{"aria-label":"Toggle sort direction"}});(0,j.setIcon)(l,this.sortDirection==="asc"?"arrow-up":"arrow-down"),l.addEventListener("click",()=>{this.sortDirection=this.sortDirection==="asc"?"desc":"asc",this.render()})}renderHeader(){let t=this.pqContentEl.createDiv({cls:"pq-header"});if(this.selectedPlaylist||this.selectedQueue){let s=t.createEl("button",{cls:"pq-back-button",attr:{"aria-label":"Back to list"}});(0,j.setIcon)(s,"arrow-left"),s.createSpan({text:" Back"}),s.addEventListener("click",()=>{this.selectedPlaylist=null,this.selectedQueue=null,this.render()})}let r="";if(this.selectedPlaylist?r=this.selectedPlaylist.name:this.selectedQueue?r=this.selectedQueue.name:r=this.viewMode==="playlists"?"Playlists":"Queues",t.createEl("h2",{text:r,cls:"pq-title"}),!this.selectedPlaylist&&!this.selectedQueue){let s=t.createDiv({cls:"pq-mode-toggle"});s.createEl("button",{text:"Playlists",cls:this.viewMode==="playlists"?"pq-mode-active":"pq-mode-inactive"}).addEventListener("click",()=>{this.viewMode="playlists",this.render()}),s.createEl("button",{text:"Queues",cls:this.viewMode==="queues"?"pq-mode-active":"pq-mode-inactive"}).addEventListener("click",()=>{this.viewMode="queues",this.render()})}let i=t.createDiv({cls:"pq-actions"});if(!this.selectedPlaylist&&!this.selectedQueue){let s=i.createEl("button",{cls:"pq-action-button",attr:{"aria-label":`Create new ${this.viewMode==="playlists"?"playlist":"queue"}`}});(0,j.setIcon)(s,"plus"),s.addEventListener("click",()=>this.handleCreate())}}async renderPlaylistList(){let t=this.pqContentEl.createDiv({cls:"pq-list-container"}),i=await this.plugin.getPlaylistManager().getAllPlaylists();if(this.searchQuery&&(i=this.filterPlaylists(i,this.searchQuery)),i=this.sortPlaylists(i,this.sortBy,this.sortDirection),i.length===0){let s=t.createDiv({cls:"pq-empty-state"});this.searchQuery?(s.createEl("p",{text:"No playlists found"}),s.createEl("p",{text:`No playlists match "${this.searchQuery}"`,cls:"pq-empty-hint"})):(s.createEl("p",{text:"No playlists yet"}),s.createEl("p",{text:"Click the + button to create a playlist",cls:"pq-empty-hint"}));return}for(let s of i)this.renderPlaylistItem(t,s)}renderPlaylistItem(t,r){let i=t.createDiv({cls:"pq-item"}),s=i.createDiv({cls:"pq-item-info"});s.createEl("h3",{text:r.name,cls:"pq-item-title"}),r.description&&s.createEl("p",{text:r.description,cls:"pq-item-description"});let a=s.createDiv({cls:"pq-item-metadata"});a.createSpan({text:`${r.episodeIds.length} episodes`,cls:"pq-item-count"}),a.createSpan({text:` \u2022 Updated ${this.formatDate(r.updatedAt)}`,cls:"pq-item-date"}),i.addEventListener("click",()=>{this.selectedPlaylist=r,this.render()}),i.addEventListener("contextmenu",n=>{n.preventDefault(),this.showPlaylistContextMenu(r,n)})}async renderQueueList(){let t=this.pqContentEl.createDiv({cls:"pq-list-container"}),i=await this.plugin.getQueueManager().getAllQueues();if(this.searchQuery&&(i=this.filterQueues(i,this.searchQuery)),i=this.sortQueues(i,this.sortBy,this.sortDirection),i.length===0){let s=t.createDiv({cls:"pq-empty-state"});this.searchQuery?(s.createEl("p",{text:"No queues found"}),s.createEl("p",{text:`No queues match "${this.searchQuery}"`,cls:"pq-empty-hint"})):(s.createEl("p",{text:"No queues yet"}),s.createEl("p",{text:"Click the + button to create a queue",cls:"pq-empty-hint"}));return}for(let s of i)this.renderQueueItem(t,s)}renderQueueItem(t,r){let i=t.createDiv({cls:"pq-item"}),s=i.createDiv({cls:"pq-item-info"});s.createEl("h3",{text:r.name,cls:"pq-item-title"});let a=s.createDiv({cls:"pq-item-status"});a.createSpan({text:`Shuffle: ${r.shuffle?"On":"Off"}`}),a.createSpan({text:` \u2022 Repeat: ${this.formatRepeatMode(r.repeat)}`});let n=s.createDiv({cls:"pq-item-metadata"});n.createSpan({text:`${r.episodeIds.length} episodes`,cls:"pq-item-count"}),r.episodeIds.length>0&&n.createSpan({text:` \u2022 Current: ${r.currentIndex+1}`,cls:"pq-item-current"}),i.addEventListener("click",()=>{this.selectedQueue=r,this.render()}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showQueueContextMenu(r,l)})}async renderPlaylistDetails(){if(!this.selectedPlaylist)return;let t=this.pqContentEl.createDiv({cls:"pq-details-container"}),r=t.createDiv({cls:"pq-details-metadata"});this.selectedPlaylist.description&&r.createEl("p",{text:this.selectedPlaylist.description,cls:"pq-details-description"}),r.createEl("p",{text:`${this.selectedPlaylist.episodeIds.length} episodes \u2022 Created ${this.formatDate(this.selectedPlaylist.createdAt)}`,cls:"pq-details-info"}),await this.renderEpisodeList(t,this.selectedPlaylist.episodeIds,"playlist")}async renderQueueDetails(){if(!this.selectedQueue)return;let t=this.pqContentEl.createDiv({cls:"pq-details-container"}),r=t.createDiv({cls:"pq-queue-controls"});r.createEl("button",{text:`Shuffle: ${this.selectedQueue.shuffle?"On":"Off"}`,cls:"pq-control-button"}).addEventListener("click",async()=>{if(this.selectedQueue){let a=this.plugin.getQueueManager();await a.toggleShuffle(this.selectedQueue.id),this.selectedQueue=await a.getQueue(this.selectedQueue.id),await this.render()}}),r.createEl("button",{text:`Repeat: ${this.formatRepeatMode(this.selectedQueue.repeat)}`,cls:"pq-control-button"}).addEventListener("click",async()=>{if(this.selectedQueue){let a=this.plugin.getQueueManager(),n=["none","one","all"],l=n.indexOf(this.selectedQueue.repeat),u=n[(l+1)%n.length];await a.setRepeat(this.selectedQueue.id,u),this.selectedQueue=await a.getQueue(this.selectedQueue.id),await this.render()}}),await this.renderEpisodeList(t,this.selectedQueue.episodeIds,"queue",this.selectedQueue.currentIndex)}async renderEpisodeList(t,r,i,s){if(r.length===0){t.createDiv({cls:"pq-empty-state"}).createEl("p",{text:"No episodes in this "+i});return}let a=this.plugin.getEpisodeManager(),n=t.createDiv({cls:"pq-episode-list"});for(let l=0;l<r.length;l++){let u=r[l];try{let g=await a.getEpisodeWithProgress(u);g&&this.renderEpisodeItem(n,g,l,i,l===s)}catch(g){console.error(`Failed to load episode: ${u}`,g)}}}renderEpisodeItem(t,r,i,s,a=!1){let n=t.createDiv({cls:a?"pq-episode-item pq-episode-current":"pq-episode-item"}),l=n.createDiv({cls:"pq-episode-index"});l.textContent=`${i+1}`;let u=n.createDiv({cls:"pq-episode-info"});u.createEl("h4",{text:r.title,cls:"pq-episode-title"});let g=u.createDiv({cls:"pq-episode-metadata"});r.duration&&g.createSpan({text:this.formatDuration(r.duration),cls:"pq-episode-duration"});let f=n.createEl("button",{cls:"pq-episode-play",attr:{"aria-label":"Play episode"}});(0,j.setIcon)(f,"play"),f.addEventListener("click",m=>{m.stopPropagation(),this.handlePlayEpisode(r)}),n.addEventListener("click",()=>{new Te(this.app,this.plugin,r).open()}),n.addEventListener("contextmenu",m=>{m.preventDefault(),this.showEpisodeContextMenu(r,i,s,m)})}async handleCreate(){new j.Notice(`Create new ${this.viewMode==="playlists"?"playlist":"queue"} - Coming soon!`)}async handlePlayEpisode(t){try{await this.plugin.playerController.loadEpisode(t,!0,!0),new j.Notice(`Now playing: ${t.title}`)}catch(r){console.error("Failed to play episode:",r),new j.Notice("Failed to start playback")}}showPlaylistContextMenu(t,r){let i=new j.Menu;i.addItem(s=>s.setTitle("View Details").setIcon("list").onClick(()=>{this.selectedPlaylist=t,this.render()})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(()=>{new j.Notice("Rename playlist - Coming soon!")})),i.addSeparator(),i.addItem(s=>s.setTitle("Delete").setIcon("trash").onClick(async()=>{try{await this.plugin.getPlaylistManager().deletePlaylist(t.id),new j.Notice("Playlist deleted"),await this.render()}catch(a){console.error("Failed to delete playlist:",a),new j.Notice("Failed to delete playlist")}})),i.showAtMouseEvent(r)}showQueueContextMenu(t,r){let i=new j.Menu;i.addItem(s=>s.setTitle("View Details").setIcon("list").onClick(()=>{this.selectedQueue=t,this.render()})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(()=>{new j.Notice("Rename queue - Coming soon!")})),i.addSeparator(),i.addItem(s=>s.setTitle("Clear").setIcon("eraser").onClick(async()=>{try{await this.plugin.getQueueManager().clearQueue(t.id),new j.Notice("Queue cleared"),await this.render()}catch(a){console.error("Failed to clear queue:",a),new j.Notice("Failed to clear queue")}})),i.addItem(s=>s.setTitle("Delete").setIcon("trash").onClick(async()=>{try{await this.plugin.getQueueManager().deleteQueue(t.id),new j.Notice("Queue deleted"),await this.render()}catch(a){console.error("Failed to delete queue:",a),new j.Notice("Failed to delete queue")}})),i.showAtMouseEvent(r)}showEpisodeContextMenu(t,r,i,s){let a=new j.Menu;a.addItem(n=>n.setTitle("View Details").setIcon("info").onClick(()=>{new Te(this.app,this.plugin,t).open()})),a.addSeparator(),a.addItem(n=>n.setTitle("Play").setIcon("play").onClick(()=>this.handlePlayEpisode(t))),a.addSeparator(),a.addItem(n=>n.setTitle("Remove from "+i).setIcon("trash").onClick(async()=>{try{if(i==="playlist"&&this.selectedPlaylist){let l=this.plugin.getPlaylistManager();await l.removeEpisode(this.selectedPlaylist.id,t.id),this.selectedPlaylist=await l.getPlaylist(this.selectedPlaylist.id),new j.Notice("Episode removed from playlist")}else if(i==="queue"&&this.selectedQueue){let l=this.plugin.getQueueManager();await l.removeEpisode(this.selectedQueue.id,t.id),this.selectedQueue=await l.getQueue(this.selectedQueue.id),new j.Notice("Episode removed from queue")}await this.render()}catch(l){console.error("Failed to remove episode:",l),new j.Notice("Failed to remove episode")}})),a.showAtMouseEvent(s)}formatRepeatMode(t){switch(t){case"none":return"Off";case"one":return"One";case"all":return"All"}}formatDuration(t){let r=Math.floor(t/3600),i=Math.floor(t%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}formatDate(t){let i=new Date().getTime()-new Date(t).getTime(),s=Math.floor(i/(1e3*60*60*24));if(s===0)return"today";if(s===1)return"yesterday";if(s<7)return`${s} days ago`;if(s<30){let a=Math.floor(s/7);return`${a} week${a>1?"s":""} ago`}else{let a=Math.floor(s/30);return`${a} month${a>1?"s":""} ago`}}filterPlaylists(t,r){let i=r.toLowerCase();return t.filter(s=>{var a;return!!(s.name.toLowerCase().includes(i)||(a=s.description)!=null&&a.toLowerCase().includes(i))})}filterQueues(t,r){let i=r.toLowerCase();return t.filter(s=>!!s.name.toLowerCase().includes(i))}sortPlaylists(t,r,i){return[...t].sort((a,n)=>{let l=0;switch(r){case"name":l=a.name.localeCompare(n.name);break;case"date":let u=new Date(a.createdAt).getTime(),g=new Date(n.createdAt).getTime();l=u-g;break;case"count":l=a.episodeIds.length-n.episodeIds.length;break}return i==="asc"?l:-l})}sortQueues(t,r,i){return[...t].sort((a,n)=>{let l=0;switch(r){case"name":l=a.name.localeCompare(n.name);break;case"date":let u=new Date(a.createdAt).getTime(),g=new Date(n.createdAt).getTime();l=u-g;break;case"count":l=a.episodeIds.length-n.episodeIds.length;break}return i==="asc"?l:-l})}async refresh(){await this.render()}};var nt=class extends Ee{constructor(e,t){let r=t.getStructure().playlists;super(e,t,r)}async loadItem(e,t){let r=await super.loadItem(e,t);return r&&(typeof r.createdAt=="string"&&(r.createdAt=new Date(r.createdAt)),typeof r.updatedAt=="string"&&(r.updatedAt=new Date(r.updatedAt))),r}validate(e){if(!Array.isArray(e))return o.warn("Invalid playlist data: not an array"),!1;for(let t of e)if(!this.validatePlaylist(t))return o.warn("Invalid playlist",t),!1;return!0}validatePlaylist(e){if(!e||typeof e!="object")return!1;let t=["id","name","episodeIds","createdAt","updatedAt"];for(let r of t)if(!(r in e))return o.warn(`Missing required field in playlist: ${r}`),!1;return Array.isArray(e.episodeIds)?!0:(o.warn("Playlist episodeIds is not an array"),!1)}getDefaultValue(){return[]}async loadAllItems(){let e=await this.listItemIds(),t=[];for(let r of e)try{let i=await this.loadItem(r,null);i&&this.validatePlaylist(i)&&t.push(i)}catch(i){o.warn(`Failed to load playlist: ${r}`,i)}return t}async load(){o.methodEntry("PlaylistStore","load");let e=await this.loadAllItems();return o.methodExit("PlaylistStore","load"),e}async save(e){if(o.methodEntry("PlaylistStore","save"),!this.validate(e))throw new $("Invalid playlist data",this.dirPath);await this.clear();for(let t of e)await this.saveItem(t.id,t);o.methodExit("PlaylistStore","save")}async getPlaylist(e){o.methodEntry("PlaylistStore","getPlaylist",e);try{let t=await this.loadItem(e,null);return!t||!this.validatePlaylist(t)?(o.methodExit("PlaylistStore","getPlaylist","invalid"),null):(o.methodExit("PlaylistStore","getPlaylist"),t)}catch(t){return o.warn("Failed to get playlist",t),o.methodExit("PlaylistStore","getPlaylist","error"),null}}async savePlaylist(e){if(o.methodEntry("PlaylistStore","savePlaylist",e.id),!this.validatePlaylist(e))throw new $("Invalid playlist data",`${this.dirPath}/${e.id}.json`);await this.saveItem(e.id,e),o.methodExit("PlaylistStore","savePlaylist")}async deletePlaylist(e){o.methodEntry("PlaylistStore","deletePlaylist",e),await this.deleteItem(e),o.methodExit("PlaylistStore","deletePlaylist")}async exists(e){return await this.getPlaylist(e)!==null}async getAllIds(){return await this.listItemIds()}async getCount(){return(await this.listItemIds()).length}async clear(){o.methodEntry("PlaylistStore","clear");let e=await this.listItemIds();for(let t of e)await this.deleteItem(t);o.info("All playlists cleared"),o.methodExit("PlaylistStore","clear")}};var lt=class{constructor(e,t){this.playlistStore=e,this.app=t}async createPlaylist(e,t,r){o.methodEntry("PlaylistManager","createPlaylist",e);let i=this.generatePlaylistId(e),s=new Date,a={id:i,name:e,description:t,episodeIds:[],createdAt:s,updatedAt:s,imageUrl:r};return await this.playlistStore.savePlaylist(a),o.info("Playlist created",i),o.methodExit("PlaylistManager","createPlaylist"),a}async getPlaylist(e){o.methodEntry("PlaylistManager","getPlaylist",e);let t=await this.playlistStore.getPlaylist(e);return o.methodExit("PlaylistManager","getPlaylist"),t}async getAllPlaylists(){o.methodEntry("PlaylistManager","getAllPlaylists");let e=await this.playlistStore.load();return e.sort((t,r)=>r.updatedAt.getTime()-t.updatedAt.getTime()),o.methodExit("PlaylistManager","getAllPlaylists"),e}async updatePlaylist(e,t){o.methodEntry("PlaylistManager","updatePlaylist",e);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);let i={...r,...t,id:r.id,createdAt:r.createdAt,updatedAt:new Date};await this.playlistStore.savePlaylist(i),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","updatePlaylist")}async deletePlaylist(e){o.methodEntry("PlaylistManager","deletePlaylist",e),await this.playlistStore.deletePlaylist(e),o.info("Playlist deleted",e),o.methodExit("PlaylistManager","deletePlaylist")}async addEpisode(e,t){o.methodEntry("PlaylistManager","addEpisode",`${e}, ${t}`);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);if(r.episodeIds.includes(t)){o.warn("Episode already in playlist",t);return}r.episodeIds.push(t),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),o.info("Episode added to playlist",t),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","addEpisode")}async addEpisodes(e,t){o.methodEntry("PlaylistManager","addEpisodes",`${e}, count=${t.length}`);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);let i=new Set(r.episodeIds),s=t.filter(a=>!i.has(a));if(s.length===0){o.warn("No new episodes to add");return}r.episodeIds.push(...s),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),o.info(`Added ${s.length} episodes to playlist`),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","addEpisodes")}async removeEpisode(e,t){o.methodEntry("PlaylistManager","removeEpisode",`${e}, ${t}`);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);let i=r.episodeIds.indexOf(t);if(i===-1){o.warn("Episode not found in playlist",t);return}r.episodeIds.splice(i,1),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),o.info("Episode removed from playlist",t),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","removeEpisode")}async removeEpisodes(e,t){o.methodEntry("PlaylistManager","removeEpisodes",`${e}, count=${t.length}`);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);let i=new Set(t);r.episodeIds=r.episodeIds.filter(s=>!i.has(s)),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),o.info(`Removed ${t.length} episodes from playlist`),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","removeEpisodes")}async reorderEpisodes(e,t){o.methodEntry("PlaylistManager","reorderEpisodes",e);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);let i=new Set(r.episodeIds);if(!t.every(a=>i.has(a)))throw new Error("Invalid episode IDs in reorder request");r.episodeIds=t,r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),o.info("Playlist episodes reordered"),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","reorderEpisodes")}async moveEpisode(e,t,r){o.methodEntry("PlaylistManager","moveEpisode",`${e}, ${t}, to=${r}`);let i=await this.playlistStore.getPlaylist(e);if(!i)throw new Error(`Playlist not found: ${e}`);let s=i.episodeIds.indexOf(t);if(s===-1)throw new Error(`Episode not found in playlist: ${t}`);i.episodeIds.splice(s,1);let a=Math.max(0,Math.min(r,i.episodeIds.length));i.episodeIds.splice(a,0,t),i.updatedAt=new Date,await this.playlistStore.savePlaylist(i),o.info("Episode moved in playlist"),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","moveEpisode")}async clearPlaylist(e){o.methodEntry("PlaylistManager","clearPlaylist",e);let t=await this.playlistStore.getPlaylist(e);if(!t)throw new Error(`Playlist not found: ${e}`);t.episodeIds=[],t.updatedAt=new Date,await this.playlistStore.savePlaylist(t),o.info("Playlist cleared"),this.app&&this.app.workspace.trigger("podcast:playlist-updated",e),o.methodExit("PlaylistManager","clearPlaylist")}async getEpisodeCount(e){let t=await this.playlistStore.getPlaylist(e);return t?t.episodeIds.length:0}async hasEpisode(e,t){let r=await this.playlistStore.getPlaylist(e);return r?r.episodeIds.includes(t):!1}async searchPlaylists(e){o.methodEntry("PlaylistManager","searchPlaylists",e);let t=await this.getAllPlaylists(),r=e.toLowerCase(),i=t.filter(s=>{var l;let a=s.name.toLowerCase().includes(r),n=(l=s.description)==null?void 0:l.toLowerCase().includes(r);return a||n});return o.methodExit("PlaylistManager","searchPlaylists",`results=${i.length}`),i}async duplicatePlaylist(e,t){o.methodEntry("PlaylistManager","duplicatePlaylist",e);let r=await this.playlistStore.getPlaylist(e);if(!r)throw new Error(`Playlist not found: ${e}`);let i=t||`${r.name} (Copy)`,s=await this.createPlaylist(i,r.description,r.imageUrl);return s.episodeIds=[...r.episodeIds],await this.playlistStore.savePlaylist(s),o.info("Playlist duplicated",s.id),o.methodExit("PlaylistManager","duplicatePlaylist"),s}async mergePlaylists(e,t){o.methodEntry("PlaylistManager","mergePlaylists",`count=${e.length}`);let r=[];for(let a of e){let n=await this.playlistStore.getPlaylist(a);n&&r.push(...n.episodeIds)}let i=Array.from(new Set(r)),s=await this.createPlaylist(t);return s.episodeIds=i,await this.playlistStore.savePlaylist(s),o.info("Playlists merged",s.id),o.methodExit("PlaylistManager","mergePlaylists"),s}async getPlaylistCount(){return await this.playlistStore.getCount()}generatePlaylistId(e){let t=Date.now(),r=Math.random().toString(36).substring(2,8);return`playlist-${t}-${r}`}async exportPlaylist(e){let t=await this.playlistStore.getPlaylist(e);if(!t)throw new Error(`Playlist not found: ${e}`);return t}async importPlaylist(e){return o.methodEntry("PlaylistManager","importPlaylist",e.id),await this.playlistStore.exists(e.id)&&(e.id=this.generatePlaylistId(e.name)),await this.playlistStore.savePlaylist(e),o.info("Playlist imported",e.id),o.methodExit("PlaylistManager","importPlaylist"),e}};var ct=class extends Ee{constructor(e,t){let r=t.getStructure().queues;super(e,t,r)}async loadItem(e,t){let r=await super.loadItem(e,t);return r&&(typeof r.createdAt=="string"&&(r.createdAt=new Date(r.createdAt)),typeof r.updatedAt=="string"&&(r.updatedAt=new Date(r.updatedAt))),r}validate(e){if(!Array.isArray(e))return o.warn("Invalid queue data: not an array"),!1;for(let t of e)if(!this.validateQueue(t))return o.warn("Invalid queue",t),!1;return!0}validateQueue(e){if(!e||typeof e!="object")return!1;let t=["id","name","episodeIds","currentIndex","autoPlayNext","shuffle","repeat","createdAt","updatedAt"];for(let r of t)if(!(r in e))return o.warn(`Missing required field in queue: ${r}`),!1;return Array.isArray(e.episodeIds)?typeof e.currentIndex!="number"?(o.warn("Queue currentIndex is not a number"),!1):typeof e.autoPlayNext!="boolean"?(o.warn("Queue autoPlayNext is not a boolean"),!1):typeof e.shuffle!="boolean"?(o.warn("Queue shuffle is not a boolean"),!1):["none","one","all"].includes(e.repeat)?!0:(o.warn("Queue repeat has invalid value"),!1):(o.warn("Queue episodeIds is not an array"),!1)}getDefaultValue(){return[]}async loadAllItems(){let e=await this.listItemIds(),t=[];for(let r of e)try{let i=await this.loadItem(r,null);i&&this.validateQueue(i)&&t.push(i)}catch(i){o.warn(`Failed to load queue: ${r}`,i)}return t}async load(){o.methodEntry("QueueStore","load");let e=await this.loadAllItems();return o.methodExit("QueueStore","load"),e}async save(e){if(o.methodEntry("QueueStore","save"),!this.validate(e))throw new $("Invalid queue data",this.dirPath);await this.clear();for(let t of e)await this.saveItem(t.id,t);o.methodExit("QueueStore","save")}async getQueue(e){o.methodEntry("QueueStore","getQueue",e);try{let t=await this.loadItem(e,null);return!t||!this.validateQueue(t)?(o.methodExit("QueueStore","getQueue","invalid"),null):(o.methodExit("QueueStore","getQueue"),t)}catch(t){return o.warn("Failed to get queue",t),o.methodExit("QueueStore","getQueue","error"),null}}async saveQueue(e){if(o.methodEntry("QueueStore","saveQueue",e.id),!this.validateQueue(e))throw new $("Invalid queue data",`${this.dirPath}/${e.id}.json`);await this.saveItem(e.id,e),o.methodExit("QueueStore","saveQueue")}async deleteQueue(e){o.methodEntry("QueueStore","deleteQueue",e),await this.deleteItem(e),o.methodExit("QueueStore","deleteQueue")}async exists(e){return await this.getQueue(e)!==null}async getAllIds(){return await this.listItemIds()}async getCount(){return(await this.listItemIds()).length}async clear(){o.methodEntry("QueueStore","clear");let e=await this.listItemIds();for(let t of e)await this.deleteItem(t);o.info("All queues cleared"),o.methodExit("QueueStore","clear")}};var ut=class{constructor(e,t){this.currentQueueId=null;this.queueStore=e,this.app=t}async createQueue(e){o.methodEntry("QueueManager","createQueue",e);let t=this.generateQueueId(e),r=new Date,i={id:t,name:e,episodeIds:[],currentIndex:0,autoPlayNext:!0,shuffle:!1,repeat:"none",createdAt:r,updatedAt:r};return await this.queueStore.saveQueue(i),o.info("Queue created",t),o.methodExit("QueueManager","createQueue"),i}async getQueue(e){o.methodEntry("QueueManager","getQueue",e);let t=await this.queueStore.getQueue(e);return o.methodExit("QueueManager","getQueue"),t}async getAllQueues(){o.methodEntry("QueueManager","getAllQueues");let e=await this.queueStore.load();return e.sort((t,r)=>r.updatedAt.getTime()-t.updatedAt.getTime()),o.methodExit("QueueManager","getAllQueues"),e}async updateQueue(e,t){o.methodEntry("QueueManager","updateQueue",e);let r=await this.queueStore.getQueue(e);if(!r)throw new Error(`Queue not found: ${e}`);let i={...r,...t,id:r.id,createdAt:r.createdAt,updatedAt:new Date};await this.queueStore.saveQueue(i),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","updateQueue")}async deleteQueue(e){o.methodEntry("QueueManager","deleteQueue",e),await this.queueStore.deleteQueue(e),this.currentQueueId===e&&(this.currentQueueId=null),o.info("Queue deleted",e),o.methodExit("QueueManager","deleteQueue")}setCurrentQueue(e){o.methodEntry("QueueManager","setCurrentQueue",e),this.currentQueueId=e,o.methodExit("QueueManager","setCurrentQueue")}async getCurrentQueue(){return this.currentQueueId?await this.getQueue(this.currentQueueId):null}async addEpisode(e,t){o.methodEntry("QueueManager","addEpisode",`${e}, ${t}`);let r=await this.queueStore.getQueue(e);if(!r)throw new Error(`Queue not found: ${e}`);r.episodeIds.push(t),r.updatedAt=new Date,await this.queueStore.saveQueue(r),o.info("Episode added to queue",t),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","addEpisode")}async addEpisodes(e,t){o.methodEntry("QueueManager","addEpisodes",`${e}, count=${t.length}`);let r=await this.queueStore.getQueue(e);if(!r)throw new Error(`Queue not found: ${e}`);r.episodeIds.push(...t),r.updatedAt=new Date,await this.queueStore.saveQueue(r),o.info(`Added ${t.length} episodes to queue`),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","addEpisodes")}async insertEpisode(e,t,r){o.methodEntry("QueueManager","insertEpisode",`${e}, ${t}, index=${r}`);let i=await this.queueStore.getQueue(e);if(!i)throw new Error(`Queue not found: ${e}`);let s=Math.max(0,Math.min(r,i.episodeIds.length));i.episodeIds.splice(s,0,t),i.updatedAt=new Date,await this.queueStore.saveQueue(i),o.info("Episode inserted into queue",t),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","insertEpisode")}async removeEpisode(e,t){o.methodEntry("QueueManager","removeEpisode",`${e}, ${t}`);let r=await this.queueStore.getQueue(e);if(!r)throw new Error(`Queue not found: ${e}`);let i=r.episodeIds.indexOf(t);if(i===-1){o.warn("Episode not found in queue",t);return}r.episodeIds.splice(i,1),i<r.currentIndex?r.currentIndex=Math.max(0,r.currentIndex-1):i===r.currentIndex&&(r.currentIndex=Math.min(r.currentIndex,r.episodeIds.length-1)),r.updatedAt=new Date,await this.queueStore.saveQueue(r),o.info("Episode removed from queue",t),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","removeEpisode")}async clearQueue(e){o.methodEntry("QueueManager","clearQueue",e);let t=await this.queueStore.getQueue(e);if(!t)throw new Error(`Queue not found: ${e}`);t.episodeIds=[],t.currentIndex=0,t.updatedAt=new Date,await this.queueStore.saveQueue(t),o.info("Queue cleared"),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","clearQueue")}async getCurrentEpisodeId(e){let t=await this.queueStore.getQueue(e);return!t||t.episodeIds.length===0||t.currentIndex<0||t.currentIndex>=t.episodeIds.length?null:t.episodeIds[t.currentIndex]}async next(e){o.methodEntry("QueueManager","next",e);let t=await this.queueStore.getQueue(e);if(!t||t.episodeIds.length===0)return o.methodExit("QueueManager","next","no queue or empty"),null;if(t.repeat==="one")return o.methodExit("QueueManager","next","repeat one"),t.episodeIds[t.currentIndex];if(t.currentIndex++,t.currentIndex>=t.episodeIds.length)if(t.repeat==="all")t.currentIndex=0;else return t.currentIndex=t.episodeIds.length-1,await this.queueStore.saveQueue(t),o.methodExit("QueueManager","next","end of queue"),null;t.updatedAt=new Date,await this.queueStore.saveQueue(t);let r=t.episodeIds[t.currentIndex];return o.info("Moved to next episode",r),o.methodExit("QueueManager","next"),r}async nextAndRemovePlayed(e){o.methodEntry("QueueManager","nextAndRemovePlayed",e);let t=await this.queueStore.getQueue(e);if(!t||t.episodeIds.length===0)return o.methodExit("QueueManager","nextAndRemovePlayed","no queue or empty"),null;if(t.repeat==="one")return o.methodExit("QueueManager","nextAndRemovePlayed","repeat one"),t.episodeIds[t.currentIndex];if(t.isPlaylist){if(t.currentIndex++,t.currentIndex>=t.episodeIds.length)if(t.repeat==="all")t.currentIndex=0;else return t.currentIndex=0,t.updatedAt=new Date,await this.queueStore.saveQueue(t),o.methodExit("QueueManager","nextAndRemovePlayed","end of playlist"),null;return t.updatedAt=new Date,await this.queueStore.saveQueue(t),t.episodeIds[t.currentIndex]}let r=t.episodeIds[t.currentIndex];if(t.episodeIds.splice(t.currentIndex,1),t.episodeIds.length===0)return t.currentIndex=0,t.updatedAt=new Date,await this.queueStore.saveQueue(t),o.info("Queue is now empty after removing played episode",r),o.methodExit("QueueManager","nextAndRemovePlayed","queue empty"),null;if(t.currentIndex>=t.episodeIds.length)if(t.repeat==="all")t.currentIndex=0;else return t.currentIndex=0,t.updatedAt=new Date,await this.queueStore.saveQueue(t),o.info("End of queue, removed played episode",r),o.methodExit("QueueManager","nextAndRemovePlayed","end of queue"),null;t.updatedAt=new Date,await this.queueStore.saveQueue(t);let i=t.episodeIds[t.currentIndex];return o.info("Moved to next episode and removed played",{played:r,next:i}),o.methodExit("QueueManager","nextAndRemovePlayed"),i}async previous(e){o.methodEntry("QueueManager","previous",e);let t=await this.queueStore.getQueue(e);if(!t||t.episodeIds.length===0)return o.methodExit("QueueManager","previous","no queue or empty"),null;if(t.repeat==="one")return o.methodExit("QueueManager","previous","repeat one"),t.episodeIds[t.currentIndex];t.currentIndex--,t.currentIndex<0&&(t.repeat==="all"?t.currentIndex=t.episodeIds.length-1:t.currentIndex=0),t.updatedAt=new Date,await this.queueStore.saveQueue(t);let r=t.episodeIds[t.currentIndex];return o.info("Moved to previous episode",r),o.methodExit("QueueManager","previous"),r}async jumpTo(e,t){o.methodEntry("QueueManager","jumpTo",`${e}, index=${t}`);let r=await this.queueStore.getQueue(e);if(!r||r.episodeIds.length===0)return o.methodExit("QueueManager","jumpTo","no queue or empty"),null;if(t<0||t>=r.episodeIds.length)return o.warn("Invalid index",t),o.methodExit("QueueManager","jumpTo","invalid index"),null;r.currentIndex=t,r.updatedAt=new Date,await this.queueStore.saveQueue(r);let i=r.episodeIds[r.currentIndex];return o.info("Jumped to episode",i),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","jumpTo"),i}async moveEpisode(e,t,r){o.methodEntry("QueueManager","moveEpisode",`${e}, ${t} -> ${r}`);let i=await this.queueStore.getQueue(e);if(!i)throw new Error(`Queue not found: ${e}`);if(t<0||t>=i.episodeIds.length||r<0||r>=i.episodeIds.length){o.warn("Invalid index",t,r);return}let s=i.episodeIds[t];i.episodeIds.splice(t,1),i.episodeIds.splice(r,0,s),i.currentIndex===t?i.currentIndex=r:i.currentIndex>t&&i.currentIndex<=r?i.currentIndex--:i.currentIndex<t&&i.currentIndex>=r&&i.currentIndex++,i.updatedAt=new Date,await this.queueStore.saveQueue(i),o.info("Episode moved",s),this.app&&this.app.workspace.trigger("podcast:queue-updated",e),o.methodExit("QueueManager","moveEpisode")}async toggleShuffle(e){o.methodEntry("QueueManager","toggleShuffle",e);let t=await this.queueStore.getQueue(e);if(!t)throw new Error(`Queue not found: ${e}`);if(t.shuffle=!t.shuffle,t.updatedAt=new Date,t.shuffle&&t.episodeIds.length>0){let r=t.episodeIds[t.currentIndex];this.shuffleArray(t.episodeIds),t.currentIndex=t.episodeIds.indexOf(r)}return await this.queueStore.saveQueue(t),o.info("Shuffle toggled",t.shuffle),o.methodExit("QueueManager","toggleShuffle"),t.shuffle}async setRepeat(e,t){o.methodEntry("QueueManager","setRepeat",`${e}, ${t}`);let r=await this.queueStore.getQueue(e);if(!r)throw new Error(`Queue not found: ${e}`);r.repeat=t,r.updatedAt=new Date,await this.queueStore.saveQueue(r),o.info("Repeat mode set",t),o.methodExit("QueueManager","setRepeat")}async cycleRepeat(e){let t=await this.queueStore.getQueue(e);if(!t)throw new Error(`Queue not found: ${e}`);let r=t.repeat==="none"?"one":t.repeat==="one"?"all":"none";return await this.setRepeat(e,r),r}async setAutoPlayNext(e,t){o.methodEntry("QueueManager","setAutoPlayNext",`${e}, ${t}`);let r=await this.queueStore.getQueue(e);if(!r)throw new Error(`Queue not found: ${e}`);r.autoPlayNext=t,r.updatedAt=new Date,await this.queueStore.saveQueue(r),o.info("Auto play next set",t),o.methodExit("QueueManager","setAutoPlayNext")}async getEpisodeCount(e){let t=await this.queueStore.getQueue(e);return t?t.episodeIds.length:0}async hasNext(e){let t=await this.queueStore.getQueue(e);return!t||t.episodeIds.length===0?!1:t.repeat!=="none"?!0:t.currentIndex<t.episodeIds.length-1}async hasPrevious(e){let t=await this.queueStore.getQueue(e);return!t||t.episodeIds.length===0?!1:t.repeat==="all"?!0:t.currentIndex>0}async getQueueCount(){return await this.queueStore.getCount()}generateQueueId(e){let t=Date.now(),r=Math.random().toString(36).substring(2,8);return`queue-${t}-${r}`}shuffleArray(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}};var Ls=Ir(vr());var $e=class{constructor(){this.parser=new Ls.default({customFields:{feed:["itunes:image","itunes:author","itunes:summary","itunes:category","itunes:owner"],item:["itunes:image","itunes:duration","itunes:episode","itunes:season","itunes:episodeType","itunes:author","itunes:summary"]}})}async parseFromString(e,t){o.methodEntry("RSSParser","parseFromString",t);try{let r=await this.parser.parseString(e),i=this.extractPodcastData(r,t),s=this.extractEpisodesData(r,i.id);return o.info(`Parsed RSS feed: ${i.title}, ${s.length} episodes`),o.methodExit("RSSParser","parseFromString"),{podcast:i,episodes:s}}catch(r){throw o.error("Failed to parse RSS feed",r),new ue("Failed to parse RSS feed",t,r)}}async parseFromUrl(e){o.methodEntry("RSSParser","parseFromUrl",e);try{let t=await this.parser.parseURL(e),r=this.extractPodcastData(t,e),i=this.extractEpisodesData(t,r.id);return o.info(`Parsed RSS feed: ${r.title}, ${i.length} episodes`),o.methodExit("RSSParser","parseFromUrl"),{podcast:r,episodes:i}}catch(t){throw o.error("Failed to parse RSS feed from URL",t),new ue("Failed to parse RSS feed from URL",e,t)}}extractPodcastData(e,t){var m,y,P,I,A,T,k,w,h,p,b,x,v,M,S,C;let r=this.generatePodcastId(t),i=((m=e.title)==null?void 0:m.trim())||"Untitled Podcast",s=((P=(y=e.itunes)==null?void 0:y.author)==null?void 0:P.trim())||((T=(A=(I=e.itunes)==null?void 0:I.owner)==null?void 0:A.name)==null?void 0:T.trim())||"Unknown Author",a=((w=(k=e.itunes)==null?void 0:k.summary)==null?void 0:w.trim())||((h=e.description)==null?void 0:h.trim())||"No description available",n;typeof((p=e.itunes)==null?void 0:p.image)=="string"?n=e.itunes.image:(b=e.itunes)!=null&&b.image&&typeof e.itunes.image=="object"&&"href"in e.itunes.image?n=e.itunes.image.href:(x=e.image)!=null&&x.url&&(n=e.image.url);let l=(v=e.link)==null?void 0:v.trim(),u=(S=(M=e.itunes)==null?void 0:M.categories)==null?void 0:S.filter(N=>typeof N=="string"),g=(C=e.language)==null?void 0:C.trim();return{id:r,title:i,author:s,description:a,feedUrl:t,imageUrl:n,websiteUrl:l,categories:u,language:g,subscribedAt:new Date,lastFetchedAt:new Date}}extractEpisodesData(e,t){if(!e.items||e.items.length===0)return o.warn("No episodes found in RSS feed"),[];let r=[];for(let i of e.items)try{let s=this.extractEpisodeData(i,t);s&&r.push(s)}catch(s){o.warn("Failed to parse episode, skipping",s)}return r}extractEpisodeData(e,t){var A,T,k,w,h,p,b,x,v,M,S,C,N,q;if(!((A=e.enclosure)!=null&&A.url))return o.warn("Episode missing audio URL, skipping"),null;let r=e.enclosure.url.trim(),i=this.generateEpisodeId(e.guid||r),s=((T=e.title)==null?void 0:T.trim())||"Untitled Episode",a=((w=(k=e.itunes)==null?void 0:k.summary)==null?void 0:w.trim())||((h=e.content)==null?void 0:h.trim())||((p=e.description)==null?void 0:p.trim())||"No description available",n=this.parseDuration((b=e.itunes)==null?void 0:b.duration),l=e.pubDate?new Date(e.pubDate):new Date,u=(x=e.itunes)!=null&&x.episode?parseInt(e.itunes.episode,10):void 0,g=(v=e.itunes)!=null&&v.season?parseInt(e.itunes.season,10):void 0,f;if((M=e.itunes)!=null&&M.episodeType){let Q=e.itunes.episodeType.toLowerCase();(Q==="full"||Q==="trailer"||Q==="bonus")&&(f=Q)}let m;typeof((S=e.itunes)==null?void 0:S.image)=="string"?m=e.itunes.image:(C=e.itunes)!=null&&C.image&&typeof e.itunes.image=="object"&&"href"in e.itunes.image&&(m=e.itunes.image.href);let y=e.enclosure.length?parseInt(e.enclosure.length,10):void 0,P=(N=e.enclosure.type)==null?void 0:N.trim();return{id:i,podcastId:t,title:s,description:a,audioUrl:r,duration:n,publishDate:l,episodeNumber:u,seasonNumber:g,episodeType:f,imageUrl:m,fileSize:y,mimeType:P,guid:(q=e.guid)==null?void 0:q.trim()}}parseDuration(e){if(!e)return 0;let t=e.trim(),r=parseInt(t,10);if(!isNaN(r)&&t===r.toString())return r;let i=t.split(":").map(s=>parseInt(s,10));if(i.some(isNaN))return o.warn(`Invalid duration format: ${e}`),0;if(i.length===3){let[s,a,n]=i;return s*3600+a*60+n}else if(i.length===2){let[s,a]=i;return s*60+a}else if(i.length===1)return i[0];return o.warn(`Invalid duration format: ${e}`),0}generatePodcastId(e){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);t=(t<<5)-t+i,t=t&t}return`podcast-${Math.abs(t).toString(36)}`}generateEpisodeId(e){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);t=(t<<5)-t+i,t=t&t}return`episode-${Math.abs(t).toString(36)}`}static validateXML(e){if(!e||typeof e!="string")return!1;let t=e.trim();return!(!t.startsWith("<?xml")&&!t.startsWith("<rss")||!t.includes("<rss"))}};var Ns=Ir(vr());var Ue=class{constructor(){this.parser=new Ns.default({customFields:{feed:["subtitle","author"],item:["summary","author"]}})}async parseFromString(e,t){o.methodEntry("AtomParser","parseFromString",t);try{let r=await this.parser.parseString(e),i=this.extractPodcastData(r,t),s=this.extractEpisodesData(r,i.id);return o.info(`Parsed Atom feed: ${i.title}, ${s.length} episodes`),o.methodExit("AtomParser","parseFromString"),{podcast:i,episodes:s}}catch(r){throw o.error("Failed to parse Atom feed",r),new ue("Failed to parse Atom feed",t,r)}}async parseFromUrl(e){o.methodEntry("AtomParser","parseFromUrl",e);try{let t=await this.parser.parseURL(e),r=this.extractPodcastData(t,e),i=this.extractEpisodesData(t,r.id);return o.info(`Parsed Atom feed: ${r.title}, ${i.length} episodes`),o.methodExit("AtomParser","parseFromUrl"),{podcast:r,episodes:i}}catch(t){throw o.error("Failed to parse Atom feed from URL",t),new ue("Failed to parse Atom feed from URL",e,t)}}extractPodcastData(e,t){var f,m,y,P,I,A,T;let r=this.generatePodcastId(t),i=((f=e.title)==null?void 0:f.trim())||"Untitled Podcast",s=((m=e.author)==null?void 0:m.trim())||"Unknown Author",a=((y=e.subtitle)==null?void 0:y.trim())||"No description available",n=(I=(P=e.image)==null?void 0:P.url)==null?void 0:I.trim(),l=(A=e.link)==null?void 0:A.trim(),u=(T=e.language)==null?void 0:T.trim();return{id:r,title:i,author:s,description:a,feedUrl:t,imageUrl:n,websiteUrl:l,language:u,subscribedAt:new Date,lastFetchedAt:new Date}}extractEpisodesData(e,t){if(!e.items||e.items.length===0)return o.warn("No episodes found in Atom feed"),[];let r=[];for(let i of e.items)try{let s=this.extractEpisodeData(i,t);s&&r.push(s)}catch(s){o.warn("Failed to parse episode, skipping",s)}return r}extractEpisodeData(e,t){var m,y,P,I,A,T;if(!((m=e.enclosure)!=null&&m.url))return o.warn("Episode missing audio URL, skipping"),null;let r=e.enclosure.url.trim(),i=this.generateEpisodeId(e.id||r),s=((y=e.title)==null?void 0:y.trim())||"Untitled Episode",a=((P=e.content)==null?void 0:P.trim())||((I=e.summary)==null?void 0:I.trim())||"No description available",n=0,l=e.pubDate?new Date(e.pubDate):new Date,u=e.enclosure.length?parseInt(e.enclosure.length,10):void 0,g=(A=e.enclosure.type)==null?void 0:A.trim();return{id:i,podcastId:t,title:s,description:a,audioUrl:r,duration:n,publishDate:l,fileSize:u,mimeType:g,guid:(T=e.id)==null?void 0:T.trim()}}generatePodcastId(e){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);t=(t<<5)-t+i,t=t&t}return`podcast-${Math.abs(t).toString(36)}`}generateEpisodeId(e){let t=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);t=(t<<5)-t+i,t=t&t}return`episode-${Math.abs(t).toString(36)}`}static validateXML(e){if(!e||typeof e!="string")return!1;let t=e.trim();return!(!t.startsWith("<?xml")&&!t.startsWith("<feed")||!t.includes("<feed")||!t.includes('xmlns="http://www.w3.org/2005/Atom"'))}};var ks=require("obsidian");var Re=class{constructor(e){this.cacheStore=null;this.rssParser=new $e,this.atomParser=new Ue,this.cacheStore=e||null}async fetchFeed(e,t={}){o.methodEntry("FeedService","fetchFeed",e);let{useCache:r=!0,cacheTTL:i=36e5,timeout:s=3e4,userAgent:a="Obsidian Podcast Player",etag:n,lastModified:l}=t;if(r&&this.cacheStore){let P=await this.getCachedFeed(e);if(P)return o.info("Using cached feed data"),o.methodExit("FeedService","fetchFeed","from cache"),P}let{xml:u,responseEtag:g,responseLastModified:f}=await this.fetchFeedXML(e,s,a,n,l),m=this.detectFeedType(u),y;if(m==="rss")y=await this.rssParser.parseFromString(u,e);else if(m==="atom")y=await this.atomParser.parseFromString(u,e);else try{y=await this.rssParser.parseFromString(u,e)}catch(P){y=await this.atomParser.parseFromString(u,e)}return this.cacheStore&&await this.cacheFeed(e,u,i,{etag:g,lastModified:f}),o.methodExit("FeedService","fetchFeed"),y}async updateFeed(e){var a;o.methodEntry("FeedService","updateFeed",e.id);let{podcast:t,episodes:r}=await this.fetchFeed(e.feedUrl,{useCache:!1}),i=new Set(((a=e.episodes)==null?void 0:a.map(n=>n.id))||[]),s=r.filter(n=>!i.has(n.id));return o.info(`Feed updated: ${s.length} new episodes`),o.methodExit("FeedService","updateFeed"),{podcast:t,episodes:r,newEpisodes:s}}async fetchFeedXML(e,t,r,i,s){o.debug("Fetching feed XML",e);try{let a=await xt(async()=>{let g={"User-Agent":r,Accept:"application/rss+xml, application/atom+xml, application/xml, text/xml"};i&&(g["If-None-Match"]=i),s&&(g["If-Modified-Since"]=s);let m=await(0,ks.requestUrl)({url:e,method:"GET",headers:g,throw:!1});if(m.status===304)throw new Error("NOT_MODIFIED");if(m.status>=400)throw new ce(`HTTP ${m.status}: Failed to fetch feed`,e);return m},{maxRetries:3,initialDelay:1e3,maxDelay:1e4}),n=a.text,l=a.headers.etag,u=a.headers["last-modified"];return{xml:n,responseEtag:l,responseLastModified:u}}catch(a){throw a instanceof Error&&a.message==="NOT_MODIFIED"?a:(o.error("Failed to fetch feed XML",a),new ce("Failed to fetch feed",e,a))}}detectFeedType(e){let t=e.trim().toLowerCase();return t.includes("<rss")?"rss":t.includes("<feed")&&t.includes('xmlns="http://www.w3.org/2005/atom"')?"atom":$e.validateXML(e)?"rss":Ue.validateXML(e)?"atom":"unknown"}async getCachedFeed(e){if(!this.cacheStore)return null;try{let t=await this.cacheStore.getCacheEntry(e);if(!t)return null;let r=this.detectFeedType(t.data);return r==="rss"?await this.rssParser.parseFromString(t.data,e):r==="atom"?await this.atomParser.parseFromString(t.data,e):null}catch(t){return o.warn("Failed to get cached feed",t),null}}async cacheFeed(e,t,r,i){if(this.cacheStore)try{await this.cacheStore.setCacheEntry(e,t,r,i),o.debug("Feed cached successfully")}catch(s){o.warn("Failed to cache feed",s)}}async clearCache(e){this.cacheStore&&(e?(await this.cacheStore.removeCacheEntry(e),o.info("Feed cache cleared",e)):(await this.cacheStore.clear(),o.info("All feed caches cleared")))}static validateFeedUrl(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch(t){return!1}}};var br=require("obsidian"),gt=class{constructor(e,t,r,i,s=36e5){this.syncTimer=null;this.isSyncing=!1;this.lastSyncTime=null;this.feedService=e,this.subscriptionStore=t,this.queueManager=r,this.playlistManager=i,this.syncInterval=s}startAutoSync(){if(o.methodEntry("FeedSyncManager","startAutoSync"),this.syncTimer){o.warn("Auto sync already running");return}this.syncAll({force:!1}).catch(e=>{o.error("Initial sync failed",e)}),this.syncTimer=setInterval(()=>{this.syncAll({force:!1}).catch(e=>{o.error("Auto sync failed",e)})},this.syncInterval),o.info(`Auto sync started (interval: ${this.syncInterval}ms)`),o.methodExit("FeedSyncManager","startAutoSync")}stopAutoSync(){o.methodEntry("FeedSyncManager","stopAutoSync"),this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null,o.info("Auto sync stopped")),o.methodExit("FeedSyncManager","stopAutoSync")}async syncAll(e={}){if(o.methodEntry("FeedSyncManager","syncAll"),this.isSyncing)throw o.warn("Sync already in progress"),new Error("Sync already in progress");this.isSyncing=!0;let t=new Date;try{let{force:r=!1,concurrency:i=3,updateInterval:s=this.syncInterval}=e,a=await this.subscriptionStore.getAllPodcasts(),n=r?a:a.filter(f=>this.shouldUpdate(f,s));o.info(`Syncing ${n.length} of ${a.length} podcasts`);let l=await this.batchUpdate(n,i),u=new Date,g={totalPodcasts:n.length,successCount:l.filter(f=>f.success).length,failureCount:l.filter(f=>!f.success).length,totalNewEpisodes:l.reduce((f,m)=>f+m.newEpisodesCount,0),results:l,startedAt:t,completedAt:u};return this.lastSyncTime=u,o.info(`Sync completed: ${g.successCount} succeeded, ${g.failureCount} failed, ${g.totalNewEpisodes} new episodes`),o.methodExit("FeedSyncManager","syncAll"),g}finally{this.isSyncing=!1}}async syncPodcasts(e,t={}){if(o.methodEntry("FeedSyncManager","syncPodcasts",`count=${e.length}`),this.isSyncing)throw o.warn("Sync already in progress"),new Error("Sync already in progress");this.isSyncing=!0;let r=new Date;try{let{concurrency:i=3}=t,s=[];for(let u of e){let g=await this.subscriptionStore.getPodcast(u);g&&s.push(g)}o.info(`Syncing ${s.length} specific podcasts`);let a=await this.batchUpdate(s,i),n=new Date,l={totalPodcasts:s.length,successCount:a.filter(u=>u.success).length,failureCount:a.filter(u=>!u.success).length,totalNewEpisodes:a.reduce((u,g)=>u+g.newEpisodesCount,0),results:a,startedAt:r,completedAt:n};return o.info(`Sync completed: ${l.successCount} succeeded, ${l.failureCount} failed`),o.methodExit("FeedSyncManager","syncPodcasts"),l}finally{this.isSyncing=!1}}async syncPodcast(e){o.methodEntry("FeedSyncManager","syncPodcast",e);let t=await this.subscriptionStore.getPodcast(e);if(!t)throw new Error(`Podcast not found: ${e}`);let r=await this.updatePodcast(t);return o.methodExit("FeedSyncManager","syncPodcast"),r}async batchUpdate(e,t){let r=[],i=[...e];for(;i.length>0;){let s=i.splice(0,t),a=await Promise.all(s.map(n=>this.updatePodcast(n)));r.push(...a),i.length>0&&await this.delay(1e3)}return r}async updatePodcast(e){o.debug(`Updating podcast: ${e.title}`);try{let{podcast:t,episodes:r,newEpisodes:i}=await this.feedService.updateFeed(e),s=e.episodes||[],a=[...i,...s],n=Array.from(new Map(a.map(l=>[l.id,l])).values());return n.sort((l,u)=>{let g=l.publishDate instanceof Date?l.publishDate:new Date(l.publishDate);return(u.publishDate instanceof Date?u.publishDate:new Date(u.publishDate)).getTime()-g.getTime()}),t.episodes=n,i.length>0&&e.autoAddRule&&e.autoAddRule.enabled&&await this.handleAutoAdd(e.autoAddRule,i),await this.subscriptionStore.updatePodcast(t),{podcastId:e.id,success:!0,newEpisodesCount:i.length}}catch(t){return o.error(`Failed to update podcast: ${e.title}`,t),{podcastId:e.id,success:!1,newEpisodesCount:0,error:t instanceof Error?t.message:"Unknown error"}}}async handleAutoAdd(e,t){try{let r=t.map(i=>i.id);if(e.targetType==="queue"){let i=await this.queueManager.getQueue(e.targetId);if(i){if(e.position==="top")for(let s=t.length-1;s>=0;s--)await this.queueManager.insertEpisode(e.targetId,t[s].id,0);else await this.queueManager.addEpisodes(e.targetId,r);new br.Notice(`Auto-added ${t.length} episodes to queue: ${i.name}`)}}else if(e.targetType==="playlist"){let i=await this.playlistManager.getPlaylist(e.targetId);if(i){if(e.position==="top"){let s=i.episodeIds,a=[...r,...s];await this.playlistManager.updatePlaylist(e.targetId,{episodeIds:a})}else await this.playlistManager.addEpisodes(e.targetId,r);new br.Notice(`Auto-added ${t.length} episodes to playlist: ${i.name}`)}}}catch(r){o.error("Failed to auto-add episodes",r)}}shouldUpdate(e,t){if(!e.lastFetchedAt)return!0;let r=Date.now(),i=new Date(e.lastFetchedAt).getTime();return r-i>=t}delay(e){return new Promise(t=>setTimeout(t,e))}getSyncStatus(){return{isSyncing:this.isSyncing,isAutoSyncEnabled:this.syncTimer!==null,lastSyncTime:this.lastSyncTime,syncInterval:this.syncInterval}}setSyncInterval(e){o.methodEntry("FeedSyncManager","setSyncInterval",e),this.syncInterval=e,this.syncTimer&&(this.stopAutoSync(),this.startAutoSync()),o.methodExit("FeedSyncManager","setSyncInterval")}};var qs=require("obsidian");var Fs=require("obsidian"),ge=class ge{async searchPodcasts(e,t={}){if(o.methodEntry("iTunesSearchService","searchPodcasts",e),!e||e.trim().length===0)return o.warn("Empty search query"),[];let{limit:r=ge.DEFAULT_LIMIT,timeout:i=ge.DEFAULT_TIMEOUT,country:s="US",includeExplicit:a=!0}=t,n=Math.min(Math.max(1,r),ge.MAX_LIMIT);try{let l=this.buildSearchUrl(e.trim(),n,s,a);o.debug("Searching iTunes API",l);let g=(await xt(async()=>{try{let m=await(0,Fs.requestUrl)({url:l,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json"},throw:!1});if(m.status!==200){if(m.status>=400&&m.status<500)return o.warn(`iTunes API returned status ${m.status}`),{status:m.status,json:{resultCount:0,results:[]}};throw new ce(`iTunes API returned status ${m.status}`,l)}return m}catch(m){o.warn("requestUrl failed, trying native fetch fallback",m);try{let y=await fetch(l);if(!y.ok)throw new Error(`Fetch failed with status ${y.status}`);return{status:200,json:await y.json()}}catch(y){throw o.error("Native fetch also failed",y),new ce("Failed to connect to iTunes API via both requestUrl and fetch.",l)}}},{maxRetries:2,initialDelay:1e3,maxDelay:5e3})).json;if(!g||!Array.isArray(g.results))return o.warn("Invalid iTunes API response format"),[];o.info(`Found ${g.resultCount} results`);let f=g.results.map(m=>this.transformResult(m));return o.methodExit("iTunesSearchService","searchPodcasts",`count=${f.length}`),f}catch(l){return o.error("iTunes search failed",l),l instanceof ce&&o.error("Network error details:",{message:l.message,url:l.url}),[]}}buildSearchUrl(e,t,r,i){let s=new URL(ge.API_BASE_URL);return s.searchParams.append("term",e),s.searchParams.append("media","podcast"),s.searchParams.append("entity","podcast"),s.searchParams.append("limit",t.toString()),s.searchParams.append("country",r),i||s.searchParams.append("explicit","No"),s.href}transformResult(e){var t;return{title:e.collectionName||"Untitled Podcast",author:e.artistName,feedUrl:e.feedUrl,artworkUrl:e.artworkUrl600||e.artworkUrl100||e.artworkUrl60||e.artworkUrl30,collectionId:(t=e.collectionId)==null?void 0:t.toString(),episodeCount:e.trackCount,genres:this.extractGenres(e)}}extractGenres(e){let t=[];return e.primaryGenreName&&t.push(e.primaryGenreName),e.genres&&Array.isArray(e.genres)&&t.push(...e.genres.filter(r=>r!==e.primaryGenreName)),t.length>0?t:void 0}static isAppleUrl(e){try{let t=new URL(e);return t.hostname.includes("apple.com")||t.hostname.includes("itunes.com")}catch(t){return!1}}};ge.API_BASE_URL="https://itunes.apple.com/search",ge.DEFAULT_TIMEOUT=15e3,ge.DEFAULT_LIMIT=10,ge.MAX_LIMIT=200;var zt=ge;var mt=class{constructor(e,t,r){this.imageCache=null;this.feedService=e,this.subscriptionStore=t,this.imageCache=r||null,this.searchService=new zt}async subscribe(e){o.methodEntry("PodcastService","subscribe",e);try{if(!Re.validateFeedUrl(e))return{success:!1,error:"Invalid feed URL"};let t=await this.subscriptionStore.getPodcastByFeedUrl(e);if(t)return o.info("Already subscribed to this podcast"),{success:!0,podcast:t};let{podcast:r,episodes:i}=await this.feedService.fetchFeed(e,{useCache:!1});return r.episodes=i,r.imageUrl&&this.imageCache&&await this.cacheImage(r.imageUrl).catch(s=>{o.warn("Failed to cache podcast image",s)}),await this.subscriptionStore.addPodcast(r),o.info(`Subscribed to podcast: ${r.title}`),o.methodExit("PodcastService","subscribe"),{success:!0,podcast:r}}catch(t){o.error("Failed to subscribe to podcast",t);let r="Failed to subscribe to podcast";return t instanceof ue?r="Failed to parse podcast feed":t instanceof ce&&(r="Failed to fetch podcast feed"),o.methodExit("PodcastService","subscribe","failed"),{success:!1,error:r}}}async unsubscribe(e){o.methodEntry("PodcastService","unsubscribe",e);let t=await this.subscriptionStore.getPodcast(e);if(!t)throw new Error(`Podcast not found: ${e}`);await this.subscriptionStore.removePodcast(e),await this.feedService.clearCache(t.feedUrl),o.info(`Unsubscribed from podcast: ${t.title}`),o.methodExit("PodcastService","unsubscribe")}async getPodcast(e){o.methodEntry("PodcastService","getPodcast",e);let t=await this.subscriptionStore.getPodcast(e);return o.methodExit("PodcastService","getPodcast"),t}async getPodcastByFeedUrl(e){o.methodEntry("PodcastService","getPodcastByFeedUrl",e);let t=await this.subscriptionStore.getPodcastByFeedUrl(e);return o.methodExit("PodcastService","getPodcastByFeedUrl"),t}async getAllPodcasts(){o.methodEntry("PodcastService","getAllPodcasts");let e=await this.subscriptionStore.getAllPodcasts();return o.methodExit("PodcastService","getAllPodcasts"),e}async getSubscriptionCount(){return await this.subscriptionStore.getSubscriptionCount()}async isSubscribed(e){return await this.subscriptionStore.isSubscribed(e)}async isSubscribedByFeedUrl(e){return await this.subscriptionStore.isSubscribedByFeedUrl(e)}async searchPodcasts(e){o.methodEntry("PodcastService","searchPodcasts",e);let t=await this.subscriptionStore.searchPodcasts(e);return o.methodExit("PodcastService","searchPodcasts"),t}async updatePodcastMetadata(e,t){o.methodEntry("PodcastService","updatePodcastMetadata",e);let r=await this.subscriptionStore.getPodcast(e);if(!r)throw new Error(`Podcast not found: ${e}`);let i={...r,...t,id:r.id,feedUrl:r.feedUrl,subscribedAt:r.subscribedAt};await this.subscriptionStore.updatePodcast(i),o.methodExit("PodcastService","updatePodcastMetadata")}async updatePodcastSettings(e,t){o.methodEntry("PodcastService","updatePodcastSettings",e),await this.subscriptionStore.updatePodcastSettings(e,t),o.methodExit("PodcastService","updatePodcastSettings")}async getPodcastSettings(e){let t=await this.subscriptionStore.getPodcast(e);return t==null?void 0:t.settings}async clearPodcastSettings(e){o.methodEntry("PodcastService","clearPodcastSettings",e),await this.subscriptionStore.updatePodcastSettings(e,void 0),o.methodExit("PodcastService","clearPodcastSettings")}async getEpisodes(e){o.methodEntry("PodcastService","getEpisodes",e);let t=await this.subscriptionStore.getPodcast(e);if(!t)throw new Error(`Podcast not found: ${e}`);return o.methodExit("PodcastService","getEpisodes"),t.episodes||[]}async getEpisode(e,t){o.methodEntry("PodcastService","getEpisode",t);let i=(await this.getEpisodes(e)).find(s=>s.id===t)||null;return o.methodExit("PodcastService","getEpisode"),i}async getLatestEpisodes(e=20){o.methodEntry("PodcastService","getLatestEpisodes",`limit=${e}`);let t=await this.subscriptionStore.getAllPodcasts(),r=[];for(let s of t)s.episodes&&r.push(...s.episodes);r.sort((s,a)=>{let n=s.publishDate instanceof Date?s.publishDate:new Date(s.publishDate);return(a.publishDate instanceof Date?a.publishDate:new Date(a.publishDate)).getTime()-n.getTime()});let i=r.slice(0,e);return o.methodExit("PodcastService","getLatestEpisodes"),i}async getPodcastsNeedingUpdate(e){return await this.subscriptionStore.getPodcastsNeedingUpdate(e)}async cacheImage(e){if(this.imageCache)try{if(await this.imageCache.getCachedImage(e)){o.debug("Image already cached",e);return}let r=await(0,qs.requestUrl)({url:e,method:"GET"});if(r.status!==200)throw new Error(`Failed to fetch image: ${r.status}`);let i=r.arrayBuffer;await this.imageCache.cacheImage(e,i),o.debug("Image cached successfully",e)}catch(t){o.warn("Failed to cache image",t)}}async getCachedImagePath(e){return this.imageCache?await this.imageCache.getCachedImage(e):null}async exportSubscriptions(){o.methodEntry("PodcastService","exportSubscriptions");let e=await this.subscriptionStore.exportSubscriptions();return o.methodExit("PodcastService","exportSubscriptions"),e}async importSubscriptions(e,t=!1){o.methodEntry("PodcastService","importSubscriptions",`replace=${t}`),await this.subscriptionStore.importSubscriptions(e,t),o.methodExit("PodcastService","importSubscriptions")}async searchOnline(e,t){o.methodEntry("PodcastService","searchOnline",e);let r=await this.searchService.searchPodcasts(e,t);return o.methodExit("PodcastService","searchOnline",`count=${r.length}`),r}async searchAndSubscribe(e,t=0,r){o.methodEntry("PodcastService","searchAndSubscribe",e);try{let i=await this.searchOnline(e,r);if(i.length===0)return{success:!1,error:"No podcasts found matching your search"};if(t<0||t>=i.length)return{success:!1,error:`Invalid result index: ${t}`};let s=i[t],a=await this.subscribe(s.feedUrl);return o.methodExit("PodcastService","searchAndSubscribe"),a}catch(i){return o.error("Search and subscribe failed",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}};var ft=class{constructor(e,t){this.progressStore=e,this.subscriptionStore=t}async getEpisodeWithProgress(e){o.methodEntry("EpisodeManager","getEpisodeWithProgress",e);let t=await this.subscriptionStore.getAllPodcasts(),r=null;for(let n of t)if(n.episodes){let l=n.episodes.find(u=>u.id===e);if(l){r=l;break}}if(!r)return o.methodExit("EpisodeManager","getEpisodeWithProgress","not found"),null;let i=await this.progressStore.getProgress(e),s=i?await this.progressStore.getCompletionPercentage(e):0,a={...r,progress:i||void 0,completionPercentage:s};return o.methodExit("EpisodeManager","getEpisodeWithProgress"),a}async getEpisodesWithProgress(e){o.methodEntry("EpisodeManager","getEpisodesWithProgress",`count=${e.length}`);let t=[];for(let r of e){let i=await this.getEpisodeWithProgress(r);i&&t.push(i)}return o.methodExit("EpisodeManager","getEpisodesWithProgress"),t}async getPodcastEpisodesWithProgress(e){o.methodEntry("EpisodeManager","getPodcastEpisodesWithProgress",e);let t=await this.subscriptionStore.getPodcast(e);if(!t||!t.episodes)return o.methodExit("EpisodeManager","getPodcastEpisodesWithProgress","not found"),[];let r=[];for(let i of t.episodes){let s=await this.progressStore.getProgress(i.id),a=s?await this.progressStore.getCompletionPercentage(i.id):0;r.push({...i,progress:s||void 0,completionPercentage:a})}return o.methodExit("EpisodeManager","getPodcastEpisodesWithProgress"),r}async filterEpisodes(e,t){o.methodEntry("EpisodeManager","filterEpisodes",`count=${e.length}`);let r=[...e];return t.podcastId&&(r=r.filter(i=>i.podcastId===t.podcastId)),t.completed!==void 0&&(r=r.filter(i=>{var a;return(((a=i.progress)==null?void 0:a.completed)||!1)===t.completed})),t.inProgress!==void 0&&(r=r.filter(i=>!!(i.progress&&!i.progress.completed&&i.progress.position>0)===t.inProgress)),t.newerThan&&(r=r.filter(i=>i.publishDate>=t.newerThan)),t.olderThan&&(r=r.filter(i=>i.publishDate<=t.olderThan)),t.episodeType&&(r=r.filter(i=>i.episodeType===t.episodeType)),t.seasonNumber!==void 0&&(r=r.filter(i=>i.seasonNumber===t.seasonNumber)),o.methodExit("EpisodeManager","filterEpisodes",`filtered=${r.length}`),r}sortEpisodes(e,t="publishDate",r="desc"){o.methodEntry("EpisodeManager","sortEpisodes",`sortBy=${t}, order=${r}`);let i=[...e].sort((s,a)=>{var l,u,g,f;let n=0;switch(t){case"publishDate":let m=s.publishDate instanceof Date?s.publishDate:new Date(s.publishDate),y=a.publishDate instanceof Date?a.publishDate:new Date(a.publishDate);n=m.getTime()-y.getTime();break;case"duration":n=s.duration-a.duration;break;case"title":n=s.title.localeCompare(a.title);break;case"episodeNumber":let P=s.episodeNumber||0,I=a.episodeNumber||0;n=P-I;break;case"lastPlayed":let A=((u=(l=s.progress)==null?void 0:l.lastPlayedAt)==null?void 0:u.getTime())||0,T=((f=(g=a.progress)==null?void 0:g.lastPlayedAt)==null?void 0:f.getTime())||0;n=A-T;break;default:n=0}return r==="asc"?n:-n});return o.methodExit("EpisodeManager","sortEpisodes"),i}searchEpisodes(e,t){o.methodEntry("EpisodeManager","searchEpisodes",t);let r=t.toLowerCase(),i=e.filter(s=>{let a=s.title.toLowerCase().includes(r),n=s.description.toLowerCase().includes(r);return a||n});return o.methodExit("EpisodeManager","searchEpisodes",`results=${i.length}`),i}async getUnplayedEpisodes(e){o.methodEntry("EpisodeManager","getUnplayedEpisodes",e);let t;e?t=await this.getPodcastEpisodesWithProgress(e):t=await this.getAllEpisodesWithProgress();let r=t.filter(i=>!i.progress||i.progress.position===0);return o.methodExit("EpisodeManager","getUnplayedEpisodes"),r}async getInProgressEpisodes(e){o.methodEntry("EpisodeManager","getInProgressEpisodes",e);let t=await this.progressStore.getInProgressEpisodes();if(!t.length)return o.methodExit("EpisodeManager","getInProgressEpisodes","empty"),[];let i=(e?t.filter(a=>a.podcastId===e):t).map(a=>a.episodeId),s=await this.getEpisodesWithProgress(i);return o.methodExit("EpisodeManager","getInProgressEpisodes"),s}async getCompletedEpisodes(e){o.methodEntry("EpisodeManager","getCompletedEpisodes",e);let t=await this.progressStore.getCompletedEpisodes();if(!t.length)return o.methodExit("EpisodeManager","getCompletedEpisodes","empty"),[];let i=(e?t.filter(a=>a.podcastId===e):t).map(a=>a.episodeId),s=await this.getEpisodesWithProgress(i);return o.methodExit("EpisodeManager","getCompletedEpisodes"),s}async getRecentlyPlayedEpisodes(e=10){o.methodEntry("EpisodeManager","getRecentlyPlayedEpisodes",`limit=${e}`);let t=await this.progressStore.getRecentlyPlayed(e);if(!t.length)return o.methodExit("EpisodeManager","getRecentlyPlayedEpisodes","empty"),[];let r=t.map(a=>a.episodeId),i=await this.getEpisodesWithProgress(r),s=r.map(a=>i.find(n=>n.id===a)).filter(a=>a!==void 0);return o.methodExit("EpisodeManager","getRecentlyPlayedEpisodes"),s}async getAllEpisodesWithProgress(){o.methodEntry("EpisodeManager","getAllEpisodesWithProgress");let e=await this.subscriptionStore.getAllPodcasts(),t=[];for(let r of e)if(r.episodes)for(let i of r.episodes){let s=await this.progressStore.getProgress(i.id),a=s?await this.progressStore.getCompletionPercentage(i.id):0;t.push({...i,progress:s||void 0,completionPercentage:a})}return o.methodExit("EpisodeManager","getAllEpisodesWithProgress"),t}async getPodcastStatistics(e){o.methodEntry("EpisodeManager","getPodcastStatistics",e);let t=await this.getPodcastEpisodesWithProgress(e),r={totalEpisodes:t.length,completedEpisodes:t.filter(i=>{var s;return(s=i.progress)==null?void 0:s.completed}).length,inProgressEpisodes:t.filter(i=>i.progress&&!i.progress.completed&&i.progress.position>0).length,unplayedEpisodes:t.filter(i=>!i.progress||i.progress.position===0).length,totalDuration:t.reduce((i,s)=>i+s.duration,0),totalListeningTime:t.reduce((i,s)=>{var a;return i+(((a=s.progress)==null?void 0:a.position)||0)},0),averageCompletionRate:0};return r.totalEpisodes>0&&r.totalDuration>0&&(r.averageCompletionRate=r.totalListeningTime/r.totalDuration*100),o.methodExit("EpisodeManager","getPodcastStatistics"),r}async getOverallStatistics(){o.methodEntry("EpisodeManager","getOverallStatistics");let e=await this.subscriptionStore.getAllPodcasts(),t=0,r=0;for(let u of e)u.episodes&&(t+=u.episodes.length,r+=u.episodes.reduce((g,f)=>g+f.duration,0));let i=await this.progressStore.getTotalListeningTime(),s=(await this.progressStore.getCompletedEpisodes()).length,a=(await this.progressStore.getInProgressEpisodes()).length,n=t-s-a,l={totalEpisodes:t,completedEpisodes:s,inProgressEpisodes:a,unplayedEpisodes:n,totalDuration:r,totalListeningTime:i,averageCompletionRate:0};return l.totalEpisodes>0&&l.totalDuration>0&&(l.averageCompletionRate=l.totalListeningTime/l.totalDuration*100),o.methodExit("EpisodeManager","getOverallStatistics"),l}async getEpisodesBySeason(e,t){o.methodEntry("EpisodeManager","getEpisodesBySeason",`${e}, season=${t}`);let i=(await this.getPodcastEpisodesWithProgress(e)).filter(s=>s.seasonNumber===t);return i.sort((s,a)=>(s.episodeNumber||0)-(a.episodeNumber||0)),o.methodExit("EpisodeManager","getEpisodesBySeason"),i}async getAvailableSeasons(e){o.methodEntry("EpisodeManager","getAvailableSeasons",e);let t=await this.subscriptionStore.getPodcast(e);if(!t||!t.episodes)return o.methodExit("EpisodeManager","getAvailableSeasons","not found"),[];let r=new Set;for(let s of t.episodes)s.seasonNumber!==void 0&&r.add(s.seasonNumber);let i=Array.from(r).sort((s,a)=>s-a);return o.methodExit("EpisodeManager","getAvailableSeasons"),i}};var yt=class{constructor(){this.audio=null;this.currentUrl=null;this.status="idle";this.eventHandlers={};this.progressInterval=null;o.methodEntry("PlaybackEngine","constructor"),this.initializeAudioElement(),o.methodExit("PlaybackEngine","constructor")}initializeAudioElement(){this.audio=new Audio,this.audio.preload="metadata",this.attachEventListeners()}attachEventListeners(){this.audio&&(this.audio.addEventListener("play",()=>{var e,t;o.debug("Audio play event"),this.status="playing",(t=(e=this.eventHandlers).onPlay)==null||t.call(e),this.startProgressTracking()}),this.audio.addEventListener("pause",()=>{var e,t;o.debug("Audio pause event"),this.status="paused",(t=(e=this.eventHandlers).onPause)==null||t.call(e),this.stopProgressTracking()}),this.audio.addEventListener("ended",()=>{var e,t;o.debug("Audio ended event"),this.status="ended",(t=(e=this.eventHandlers).onEnded)==null||t.call(e),this.stopProgressTracking()}),this.audio.addEventListener("timeupdate",()=>{var e,t;this.audio&&((t=(e=this.eventHandlers).onTimeUpdate)==null||t.call(e,this.audio.currentTime))}),this.audio.addEventListener("durationchange",()=>{var e,t;this.audio&&!isNaN(this.audio.duration)&&(o.debug("Duration changed",this.audio.duration),(t=(e=this.eventHandlers).onDurationChange)==null||t.call(e,this.audio.duration))}),this.audio.addEventListener("loadstart",()=>{var e,t;o.debug("Audio load start"),this.status="loading",(t=(e=this.eventHandlers).onLoadStart)==null||t.call(e)}),this.audio.addEventListener("loadedmetadata",()=>{var e,t;o.debug("Audio metadata loaded"),(t=(e=this.eventHandlers).onLoadedMetadata)==null||t.call(e)}),this.audio.addEventListener("canplay",()=>{var e,t;o.debug("Audio can play"),(t=(e=this.eventHandlers).onCanPlay)==null||t.call(e)}),this.audio.addEventListener("error",e=>{var r,i,s,a,n;o.error("Audio playback error",(r=this.audio)==null?void 0:r.error),this.status="error";let t=new Z(((s=(i=this.audio)==null?void 0:i.error)==null?void 0:s.message)||"Unknown playback error",this.currentUrl||void 0);(n=(a=this.eventHandlers).onError)==null||n.call(a,t)}),this.audio.addEventListener("volumechange",()=>{var e,t;this.audio&&((t=(e=this.eventHandlers).onVolumeChange)==null||t.call(e,this.audio.volume,this.audio.muted))}),this.audio.addEventListener("ratechange",()=>{var e,t;this.audio&&((t=(e=this.eventHandlers).onRateChange)==null||t.call(e,this.audio.playbackRate))}),this.audio.addEventListener("progress",()=>{var e,t;if(this.audio&&this.audio.buffered.length>0){let r=this.audio.buffered.end(this.audio.buffered.length-1);(t=(e=this.eventHandlers).onProgress)==null||t.call(e,r)}}))}setEventHandlers(e){this.eventHandlers={...this.eventHandlers,...e}}async load(e){if(o.methodEntry("PlaybackEngine","load",e),!this.audio)throw new Z("Audio element not initialized");try{this.status==="playing"&&this.pause(),this.currentUrl=e,this.audio.src=e,this.audio.load(),o.info("Audio loaded",e),o.methodExit("PlaybackEngine","load")}catch(t){throw o.error("Failed to load audio",t),this.status="error",new Z("Failed to load audio",e,t)}}async play(){if(o.methodEntry("PlaybackEngine","play"),!this.audio)throw new Z("Audio element not initialized");if(!this.currentUrl)throw new Z("No audio loaded");try{await this.audio.play(),o.info("Audio playing"),o.methodExit("PlaybackEngine","play")}catch(e){throw o.error("Failed to play audio",e),this.status="error",new Z("Failed to play audio",this.currentUrl,e)}}pause(){if(o.methodEntry("PlaybackEngine","pause"),!this.audio)throw new Z("Audio element not initialized");this.audio.pause(),o.info("Audio paused"),o.methodExit("PlaybackEngine","pause")}stop(){if(o.methodEntry("PlaybackEngine","stop"),!this.audio)throw new Z("Audio element not initialized");this.audio.pause(),this.audio.currentTime=0,this.status="idle",o.info("Audio stopped"),o.methodExit("PlaybackEngine","stop")}seek(e){if(o.methodEntry("PlaybackEngine","seek",e),!this.audio)throw new Z("Audio element not initialized");if(isNaN(this.audio.duration)){o.warn("Cannot seek: duration not available");return}let t=Math.max(0,Math.min(e,this.audio.duration));this.audio.currentTime=t,o.debug("Seeked to",t),o.methodExit("PlaybackEngine","seek")}setVolume(e){if(o.methodEntry("PlaybackEngine","setVolume",e),!this.audio)throw new Z("Audio element not initialized");let t=Ar(e);this.audio.volume=t,o.debug("Volume set to",t),o.methodExit("PlaybackEngine","setVolume")}setPlaybackRate(e){if(o.methodEntry("PlaybackEngine","setPlaybackRate",e),!this.audio)throw new Z("Audio element not initialized");let t=Mr(e);this.audio.playbackRate=t,o.debug("Playback rate set to",t),o.methodExit("PlaybackEngine","setPlaybackRate")}setMuted(e){if(o.methodEntry("PlaybackEngine","setMuted",e),!this.audio)throw new Z("Audio element not initialized");this.audio.muted=e,o.debug("Muted set to",e),o.methodExit("PlaybackEngine","setMuted")}getStatus(){return this.status}getMetadata(){if(!this.audio)return null;let e=this.audio.buffered.length>0?this.audio.buffered.end(this.audio.buffered.length-1):0;return{duration:this.audio.duration||0,currentTime:this.audio.currentTime||0,buffered:e,volume:this.audio.volume,playbackRate:this.audio.playbackRate,muted:this.audio.muted}}getCurrentTime(){var e;return((e=this.audio)==null?void 0:e.currentTime)||0}getDuration(){var e;return((e=this.audio)==null?void 0:e.duration)||0}getVolume(){var e;return((e=this.audio)==null?void 0:e.volume)||1}getPlaybackRate(){var e;return((e=this.audio)==null?void 0:e.playbackRate)||1}isMuted(){var e;return((e=this.audio)==null?void 0:e.muted)||!1}isPlaying(){return this.status==="playing"}isPaused(){return this.status==="paused"}isLoading(){return this.status==="loading"}startProgressTracking(){this.progressInterval===null&&(this.progressInterval=window.setInterval(()=>{var e,t;this.audio&&this.status==="playing"&&((t=(e=this.eventHandlers).onTimeUpdate)==null||t.call(e,this.audio.currentTime))},100))}stopProgressTracking(){this.progressInterval!==null&&(clearInterval(this.progressInterval),this.progressInterval=null)}destroy(){o.methodEntry("PlaybackEngine","destroy"),this.stopProgressTracking(),this.audio&&(this.audio.pause(),this.audio.src="",this.audio.load(),this.audio=null),this.currentUrl=null,this.status="idle",this.eventHandlers={},o.info("PlaybackEngine destroyed"),o.methodExit("PlaybackEngine","destroy")}};var Et=class{constructor(e,t={}){this.currentEpisode=null;this.lastSavedPosition=0;this.lastSavedTime=0;this.saveTimer=null;this.isTracking=!1;this.progressStore=e,this.saveInterval=t.saveInterval||5e3,this.minPositionChange=t.minPositionChange||2,this.completionThreshold=t.completionThreshold||30}async startTracking(e){o.methodEntry("ProgressTracker","startTracking",e.id),this.isTracking&&await this.stopTracking(),this.currentEpisode=e,this.isTracking=!0;let t=await this.progressStore.getProgress(e.id);t?this.lastSavedPosition=t.position:this.lastSavedPosition=0,this.lastSavedTime=Date.now(),this.startPeriodicSave(),o.info("Started tracking progress",e.id),o.methodExit("ProgressTracker","startTracking")}async stopTracking(e=!0){if(o.methodEntry("ProgressTracker","stopTracking",`save=${e}`),!this.isTracking){o.methodExit("ProgressTracker","stopTracking","not tracking");return}this.stopPeriodicSave(),e&&this.currentEpisode&&await this.saveProgress(this.lastSavedPosition,!0),this.currentEpisode=null,this.isTracking=!1,this.lastSavedPosition=0,this.lastSavedTime=0,o.info("Stopped tracking progress"),o.methodExit("ProgressTracker","stopTracking")}updatePosition(e){!this.isTracking||!this.currentEpisode||(this.lastSavedPosition=e)}async forceSave(e){if(o.methodEntry("ProgressTracker","forceSave"),!this.currentEpisode){o.warn("No episode to save progress for"),o.methodExit("ProgressTracker","forceSave","no episode");return}let t=e!==void 0?e:this.lastSavedPosition;await this.saveProgress(t,!0),o.methodExit("ProgressTracker","forceSave")}async markCompleted(){if(o.methodEntry("ProgressTracker","markCompleted"),!this.currentEpisode){o.warn("No episode to mark as completed"),o.methodExit("ProgressTracker","markCompleted","no episode");return}await this.progressStore.markCompleted(this.currentEpisode.id,this.currentEpisode.podcastId,this.currentEpisode.duration),o.info("Episode marked as completed",this.currentEpisode.id),o.methodExit("ProgressTracker","markCompleted")}getLastSavedPosition(){return this.lastSavedPosition}async getResumePosition(e){o.methodEntry("ProgressTracker","getResumePosition",e);let t=await this.progressStore.getProgress(e);return t?t.completed?(o.methodExit("ProgressTracker","getResumePosition","completed"),0):(o.methodExit("ProgressTracker","getResumePosition",t.position),t.position):(o.methodExit("ProgressTracker","getResumePosition","no progress"),0)}async shouldResume(e,t=10){return await this.getResumePosition(e)>=t}async resetProgress(e){o.methodEntry("ProgressTracker","resetProgress",e),await this.progressStore.resetProgress(e),this.currentEpisode&&this.currentEpisode.id===e&&(this.lastSavedPosition=0),o.info("Progress reset",e),o.methodExit("ProgressTracker","resetProgress")}startPeriodicSave(){this.saveTimer===null&&(this.saveTimer=window.setInterval(()=>{this.periodicSave().catch(e=>{o.error("Periodic save failed",e)})},this.saveInterval))}stopPeriodicSave(){this.saveTimer!==null&&(clearInterval(this.saveTimer),this.saveTimer=null)}async periodicSave(){if(!this.isTracking||!this.currentEpisode)return;let e=await this.progressStore.getProgress(this.currentEpisode.id),t=(e==null?void 0:e.position)||0;Math.abs(this.lastSavedPosition-t)<this.minPositionChange||await this.saveProgress(this.lastSavedPosition,!1)}async saveProgress(e,t){if(this.currentEpisode)try{let r=Ge(e,this.currentEpisode.duration,this.completionThreshold),i={episodeId:this.currentEpisode.id,podcastId:this.currentEpisode.podcastId,position:e,duration:this.currentEpisode.duration,lastPlayedAt:new Date,completed:r};await this.progressStore.updateProgress(i),this.lastSavedTime=Date.now(),o.debug("Progress saved",{episodeId:this.currentEpisode.id,position:e,completed:r})}catch(r){o.error("Failed to save progress",r)}}isCurrentlyTracking(){return this.isTracking}getCurrentEpisode(){return this.currentEpisode}getTimeSinceLastSave(){return this.lastSavedTime===0?0:Date.now()-this.lastSavedTime}};var Pt=class{constructor(e,t){this.currentEpisode=null;this.eventHandlers={};o.methodEntry("PlayerController","constructor"),this.engine=e,this.progressTracker=t,this.currentSettings={...fe.defaultPlaybackSettings},this.state={status:"stopped",position:0,volume:this.currentSettings.volume,playbackSpeed:this.currentSettings.playbackSpeed,muted:!1},this.setupEngineHandlers(),o.methodExit("PlayerController","constructor")}setupEngineHandlers(){let e={onPlay:()=>{this.updateState({status:"playing"})},onPause:()=>{this.updateState({status:"paused"})},onEnded:()=>{this.handleEpisodeEnded()},onTimeUpdate:t=>{this.updateState({position:t}),this.progressTracker.updatePosition(t)},onDurationChange:t=>{this.currentEpisode&&(this.currentEpisode.duration=t)},onLoadStart:()=>{this.updateState({status:"loading"})},onError:t=>{var r,i;this.updateState({status:"error",error:t.message}),(i=(r=this.eventHandlers).onError)==null||i.call(r,t)},onVolumeChange:(t,r)=>{this.updateState({volume:t,muted:r})},onRateChange:t=>{this.updateState({playbackSpeed:t})}};this.engine.setEventHandlers(e)}async loadEpisode(e,t=!1,r=!0){var i,s;o.methodEntry("PlayerController","loadEpisode",e.id);try{this.currentEpisode&&await this.progressTracker.stopTracking(!0),await this.engine.load(e.audioUrl),this.currentEpisode=e,this.updateState({currentEpisode:e,status:"paused",position:0,error:void 0}),e.podcastId,await this.progressTracker.startTracking(e),await this.waitForMetadata();let a=0;if(r)if(await this.progressTracker.shouldResume(e.id))a=await this.progressTracker.getResumePosition(e.id),o.info("Resuming from saved position",a);else{let u=this.currentSettings.skipIntroSeconds||0;u>0&&(a=u,o.info("Skipping intro",u))}this.engine.seek(a),await new Promise(l=>setTimeout(l,50));let n=this.engine.getCurrentTime();this.updateState({position:n}),o.info("Starting position set to",n),(s=(i=this.eventHandlers).onEpisodeChange)==null||s.call(i,e),t&&await this.play(),o.info("Episode loaded",e.title),o.methodExit("PlayerController","loadEpisode")}catch(a){throw o.error("Failed to load episode",a),this.updateState({status:"error",error:a instanceof Error?a.message:"Failed to load episode"}),a}}async waitForMetadata(){return new Promise(e=>{let t=()=>{let r=this.engine.getDuration();!isNaN(r)&&r>0?e():setTimeout(t,50)};t()})}async play(){if(o.methodEntry("PlayerController","play"),!this.currentEpisode)throw new Z("No episode loaded");await this.engine.play(),o.methodExit("PlayerController","play")}pause(){o.methodEntry("PlayerController","pause"),this.engine.pause(),o.methodExit("PlayerController","pause")}async togglePlayPause(){this.engine.isPlaying()?this.pause():await this.play()}async stop(){var e,t;o.methodEntry("PlayerController","stop"),this.engine.stop(),this.currentEpisode&&await this.progressTracker.stopTracking(!0),this.currentEpisode=null,this.updateState({currentEpisode:void 0,status:"stopped",position:0}),(t=(e=this.eventHandlers).onEpisodeChange)==null||t.call(e,null),o.methodExit("PlayerController","stop")}seek(e){o.methodEntry("PlayerController","seek",e),this.engine.seek(e),this.progressTracker.updatePosition(e),o.methodExit("PlayerController","seek")}skipForward(e){let t=this.engine.getCurrentTime(),r=this.engine.getDuration(),i=kr(t,r,e);this.seek(i)}skipBackward(e){let t=this.engine.getCurrentTime(),r=Fr(t,e);this.seek(r)}setVolume(e){o.methodEntry("PlayerController","setVolume",e),this.engine.setVolume(e),this.currentSettings.volume=e,o.methodExit("PlayerController","setVolume")}setPlaybackSpeed(e){o.methodEntry("PlayerController","setPlaybackSpeed",e),this.engine.setPlaybackRate(e),this.currentSettings.playbackSpeed=e,o.methodExit("PlayerController","setPlaybackSpeed")}cyclePlaybackSpeed(){let e=this.engine.getPlaybackRate(),t=Lr(e);this.setPlaybackSpeed(t)}setMuted(e){o.methodEntry("PlayerController","setMuted",e),this.engine.setMuted(e),o.methodExit("PlayerController","setMuted")}toggleMute(){let e=this.engine.isMuted();this.setMuted(!e)}applyPodcastSettings(e){o.methodEntry("PlayerController","applyPodcastSettings"),this.currentSettings={...e},this.engine.setVolume(e.volume),this.engine.setPlaybackRate(e.playbackSpeed),o.info("Podcast settings applied",e),o.methodExit("PlayerController","applyPodcastSettings")}getState(){return{...this.state}}getCurrentEpisode(){return this.currentEpisode}getCurrentPosition(){return this.engine.getCurrentTime()}getDuration(){return this.engine.getDuration()}isPlaying(){return this.engine.isPlaying()}isPaused(){return this.engine.isPaused()}setEventHandlers(e){this.eventHandlers={...this.eventHandlers,...e}}async markEpisodeCompleted(){this.currentEpisode&&(await this.progressTracker.markCompleted(),o.info("Episode marked as completed",this.currentEpisode.id))}async handleEpisodeEnded(){var e,t;o.methodEntry("PlayerController","handleEpisodeEnded"),this.currentEpisode&&(await this.progressTracker.markCompleted(),this.updateState({status:"stopped"}),(t=(e=this.eventHandlers).onEpisodeEnded)==null||t.call(e,this.currentEpisode),o.info("Episode ended",this.currentEpisode.title),o.methodExit("PlayerController","handleEpisodeEnded"))}updateState(e){var t,r;this.state={...this.state,...e},(r=(t=this.eventHandlers).onStateChange)==null||r.call(t,this.state)}async destroy(){o.methodEntry("PlayerController","destroy"),await this.progressTracker.stopTracking(!0),this.engine.destroy(),this.currentEpisode=null,this.eventHandlers={},o.info("PlayerController destroyed"),o.methodExit("PlayerController","destroy")}};function wt(c,e=!0){if(!isFinite(c)||c<0)return e?"0s":"0 seconds";let t=Math.floor(c/3600),r=Math.floor(c%3600/60),i=Math.floor(c%60),s=[];return t>0&&s.push(e?`${t}h`:`${t} hour${t>1?"s":""}`),r>0&&s.push(e?`${r}m`:`${r} minute${r>1?"s":""}`),(i>0||s.length===0)&&s.push(e?`${i}s`:`${i} second${i>1?"s":""}`),s.join(" ")}function Be(c){let e={year:"numeric",month:"short",day:"numeric"};return c.toLocaleDateString(void 0,e)}var Ve=require("obsidian");var vt=class{constructor(e){this.vault=e}async exportEpisode(e,t,r,i={}){o.methodEntry("NoteExporter","exportEpisode",e.id);let{includeFrontMatter:s=!0,includeDescription:a=!0,includeMetadata:n=!0,includeTimestamps:l=!0,includeProgress:u=!0,template:g,outputFolder:f="Podcasts",fileNameTemplate:m}=i,y=this.generateTemplateVariables(e,t,r),P="";g?P=this.applyTemplate(g,y):P=this.generateDefaultNote(e,t,r,{includeFrontMatter:s,includeDescription:a,includeMetadata:n,includeTimestamps:l,includeProgress:u});let I=this.generateFileName(e,t,m),A=(0,Ve.normalizePath)(`${f}/${I}`);await this.ensureFolderExists(f);let T=await this.createOrUpdateFile(A,P);return o.info("Episode exported to note",A),o.methodExit("NoteExporter","exportEpisode"),T}generateDefaultNote(e,t,r,i){let s=[];return i.includeFrontMatter&&s.push(this.generateFrontMatter(e,t,r)),s.push(`# ${e.title}
`),i.includeMetadata&&s.push(this.generateMetadataSection(e,t)),i.includeProgress&&r&&s.push(this.generateProgressSection(r)),i.includeDescription&&s.push(this.generateDescriptionSection(e)),i.includeTimestamps&&s.push(this.generateTimestampsSection()),s.push(this.generateNotesSection()),s.join(`
`)}generateFrontMatter(e,t,r){let i={title:e.title,podcast:t.title,author:t.author,episodeNumber:e.episodeNumber,seasonNumber:e.seasonNumber,publishDate:Be(e.publishDate),duration:wt(e.duration),audioUrl:e.audioUrl,episodeId:e.id,podcastId:e.podcastId};r&&(i.progress=Math.round(r.position/r.duration*100),i.completed=r.completed,i.lastPlayed=Be(r.lastPlayedAt)),e.guid&&(i.guid=e.guid),t.imageUrl&&(i.image=t.imageUrl);let s=["---"];for(let[a,n]of Object.entries(i))n!=null&&(typeof n=="string"&&n.includes(":")?s.push(`${a}: "${n}"`):s.push(`${a}: ${n}`));return s.push(`---
`),s.join(`
`)}generateMetadataSection(e,t){let r=[`## Episode Information
`,`**Podcast:** ${t.title}`,`**Author:** ${t.author}`,`**Published:** ${Be(e.publishDate)}`,`**Duration:** ${wt(e.duration)}`];return e.episodeNumber&&r.push(`**Episode:** ${e.episodeNumber}`),e.seasonNumber&&r.push(`**Season:** ${e.seasonNumber}`),e.episodeType&&r.push(`**Type:** ${e.episodeType}`),r.push(""),r.join(`
`)}generateProgressSection(e){let t=Math.round(e.position/e.duration*100);return[`## Listening Progress
`,`**Status:** ${e.completed?"Completed":"In Progress"}`,`**Progress:** ${t}%`,`**Last Played:** ${Be(e.lastPlayedAt)}`,""].join(`
`)}generateDescriptionSection(e){return[`## Description
`,e.description,""].join(`
`)}generateTimestampsSection(){return[`## Timestamps
`,"<!-- Add your timestamps here -->","<!-- Example: [12:34] Topic discussion -->",""].join(`
`)}generateNotesSection(){return[`## Notes
`,"<!-- Add your notes here -->",""].join(`
`)}generateTemplateVariables(e,t,r){let i={episodeTitle:e.title,episodeDescription:e.description,podcastTitle:t.title,podcastAuthor:t.author,episodeNumber:e.episodeNumber,seasonNumber:e.seasonNumber,publishDate:Be(e.publishDate),duration:wt(e.duration),audioUrl:e.audioUrl,episodeUrl:e.guid,imageUrl:e.imageUrl||t.imageUrl};if(r){let s=Math.round(r.position/r.duration*100);i.progress=wt(r.position),i.completionPercentage=`${s}%`}return i}applyTemplate(e,t){let r=e;for(let[i,s]of Object.entries(t))if(s!=null){let a=new RegExp(`{{${i}}}`,"g");r=r.replace(a,s.toString())}return r}generateFileName(e,t,r){if(r){let a=this.generateTemplateVariables(e,t),n=this.applyTemplate(r,a);return n=this.sanitizeFileName(n),n.endsWith(".md")||(n+=".md"),n}let i=this.sanitizeFileName(t.title),s=this.sanitizeFileName(e.title);return`${i} - ${s}.md`}sanitizeFileName(e){return e.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim()}async ensureFolderExists(e){let t=(0,Ve.normalizePath)(e);await this.vault.adapter.exists(t)||(await this.vault.createFolder(t),o.info("Created folder",t))}async createOrUpdateFile(e,t){let r=(0,Ve.normalizePath)(e),i=this.vault.getAbstractFileByPath(r);if(i instanceof Ve.TFile)return await this.vault.modify(i,t),o.info("Updated existing file",r),i;{let s=await this.vault.create(r,t);return o.info("Created new file",r),s}}async exportEpisodes(e,t={}){o.methodEntry("NoteExporter","exportEpisodes",`count=${e.length}`);let r=[];for(let{episode:i,podcast:s,progress:a}of e)try{let n=await this.exportEpisode(i,s,a,t);r.push(n)}catch(n){o.error(`Failed to export episode: ${i.title}`,n)}return o.info(`Exported ${r.length} episodes`),o.methodExit("NoteExporter","exportEpisodes"),r}async quickExport(e,t,r){return await this.exportEpisode(e,t,r,{includeFrontMatter:!0,includeDescription:!0,includeMetadata:!0,includeTimestamps:!0,includeProgress:!!r})}};var Da={enabled:!0,intervalMs:24*60*60*1e3,completedRetentionDays:30,inProgressRetentionDays:90,maxCacheSizeMB:100},Yt=class{constructor(e,t,r,i,s={}){this.intervalId=null;this.stats={completedRecordsRemoved:0,cacheEntriesRemoved:0,bytesFreed:0};this.progressStore=e,this.feedCacheStore=t,this.imageCacheStore=r,this.episodeManager=i,this.config={...Da,...s}}start(){if(!this.config.enabled){o.info("Cleanup service is disabled");return}if(this.intervalId!==null){o.warn("Cleanup service is already running");return}o.info(`Starting cleanup service with interval: ${this.config.intervalMs}ms`),this.runCleanup().catch(e=>{o.error("Initial cleanup failed:",e)}),this.intervalId=window.setInterval(()=>{this.runCleanup().catch(e=>{o.error("Scheduled cleanup failed:",e)})},this.config.intervalMs)}stop(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null,o.info("Cleanup service stopped"))}async runCleanup(){o.info("Running cleanup...");let e=Date.now(),t={lastCleanupAt:new Date,completedRecordsRemoved:0,cacheEntriesRemoved:0,bytesFreed:0};try{let r=await this.cleanupCompletedProgress();t.completedRecordsRemoved+=r.removed;let i=await this.cleanupExpiredCache();t.cacheEntriesRemoved+=i.removed,t.bytesFreed+=i.bytesFreed;let s=await this.cleanupImageCache();t.cacheEntriesRemoved+=s.removed,t.bytesFreed+=s.bytesFreed,this.stats=t;let a=Date.now()-e;return o.info(`Cleanup completed in ${a}ms:`,t),t}catch(r){throw o.error("Cleanup failed:",r),r}}async cleanupCompletedProgress(){try{let e=new Date;e.setDate(e.getDate()-this.config.completedRetentionDays),o.debug(`Cleaning up completed episodes older than ${e.toISOString()}`);let t=await this.episodeManager.getCompletedEpisodes(),r=0;for(let i of t){if(!i.progress)continue;let s=i.progress.lastPlayedAt;s&&new Date(s)<e&&(await this.progressStore.removeProgress(i.id),r++,o.debug(`Removed progress for completed episode: ${i.title}`))}return o.info(`Removed ${r} old completed episode progress records`),{removed:r}}catch(e){return o.error("Failed to cleanup completed progress:",e),{removed:0}}}async cleanupExpiredCache(){try{let e=await this.feedCacheStore.getCacheStats();await this.feedCacheStore.cleanupExpired();let t=await this.feedCacheStore.getCacheStats(),r=e.totalEntries-t.totalEntries,i=e.totalSize-t.totalSize;return o.info(`Removed ${r} expired cache entries, freed ${i} bytes`),{removed:r,bytesFreed:i}}catch(e){return o.error("Failed to cleanup expired cache:",e),{removed:0,bytesFreed:0}}}async cleanupImageCache(){try{let e=await this.imageCacheStore.getCacheStats(),t=this.config.maxCacheSizeMB*1024*1024;if(e.totalSize<=t)return o.debug(`Image cache size (${e.totalSize} bytes) is within limit (${t} bytes)`),{removed:0,bytesFreed:0};o.info(`Image cache size (${e.totalSize} bytes) exceeds limit (${t} bytes), cleaning up...`);let r=e.totalSize,i=e.totalImages,s=Math.max(Math.floor(e.totalImages/2),100);await this.imageCacheStore.cleanupOldImages(s);let a=await this.imageCacheStore.getCacheStats(),n=i-a.totalImages,l=r-a.totalSize;return o.info(`Removed ${n} old images, freed ${l} bytes`),{removed:n,bytesFreed:l}}catch(e){return o.error("Failed to cleanup image cache:",e),{removed:0,bytesFreed:0}}}updateConfig(e){let t=this.config.enabled;this.config={...this.config,...e},t!==this.config.enabled?this.config.enabled?this.start():this.stop():this.config.enabled&&this.intervalId!==null&&(this.stop(),this.start())}getStats(){return{...this.stats}}getConfig(){return{...this.config}}};var Kt=class extends bt.Plugin{async onload(){o.info("Loading Podcast Player plugin"),this.pathManager=new je(this.app.vault,fe.dataFolderPath),this.settingsStore=new Ke(this.app.vault,this.pathManager),await this.loadSettings(),await this.pathManager.ensureDirectories(),this.subscriptionStore=new We(this.app.vault,this.pathManager),this.progressStore=new Ye(this.app.vault,this.pathManager),this.playlistStore=new nt(this.app.vault,this.pathManager),this.queueStore=new ct(this.app.vault,this.pathManager),this.feedCacheStore=new Je(this.app.vault,this.pathManager),this.imageCacheStore=new Ze(this.app.vault,this.pathManager),this.feedService=new Re(this.feedCacheStore),this.podcastService=new mt(this.feedService,this.subscriptionStore,this.imageCacheStore),this.episodeManager=new ft(this.progressStore,this.subscriptionStore),this.playlistManager=new lt(this.playlistStore,this.app),this.queueManager=new ut(this.queueStore,this.app),this.feedSyncManager=new gt(this.feedService,this.subscriptionStore,this.queueManager,this.playlistManager,this.settings.feedUpdateInterval*60*1e3),this.playbackEngine=new yt,this.progressTracker=new Et(this.progressStore),this.playerController=new Pt(this.playbackEngine,this.progressTracker),this.playerController.setEventHandlers({onEpisodeEnded:async e=>{let t=await this.queueManager.getCurrentQueue();if(t&&t.autoPlayNext){let r=await this.queueManager.nextAndRemovePlayed(t.id);if(r){let i=await this.episodeManager.getEpisodeWithProgress(r);i&&await this.playerController.loadEpisode(i,!0,!0)}this.app.workspace.trigger("podcast:queue-changed")}}}),this.registerEvent(this.app.workspace.on("podcast:queue-updated",async e=>{let t=await this.queueManager.getQueue(e);if(t&&t.isPlaylist&&t.sourceId){let r=await this.playlistManager.getPlaylist(t.sourceId);if(r){let i=t.episodeIds,s=r.episodeIds;JSON.stringify(i)!==JSON.stringify(s)&&await this.playlistManager.updatePlaylist(r.id,{episodeIds:i})}}})),this.registerEvent(this.app.workspace.on("podcast:playlist-updated",async e=>{let r=(await this.queueManager.getAllQueues()).find(i=>i.sourceId===e);if(r){let i=await this.playlistManager.getPlaylist(e);if(i){let s=r.episodeIds,a=i.episodeIds;if(JSON.stringify(s)!==JSON.stringify(a)){let n=r.episodeIds[r.currentIndex];await this.queueManager.updateQueue(r.id,{episodeIds:a});let l=a.indexOf(n);l!==-1?await this.queueManager.jumpTo(r.id,l):await this.queueManager.jumpTo(r.id,0)}}}})),this.noteExporter=new vt(this.app.vault),this.cleanupService=new Yt(this.progressStore,this.feedCacheStore,this.imageCacheStore,this.episodeManager,{enabled:!0,intervalMs:24*60*60*1e3,completedRetentionDays:30,inProgressRetentionDays:90,maxCacheSizeMB:100}),this.cleanupService.start();try{this.registerView(Se,e=>new tt(e,this))}catch(e){o.warn(`View ${Se} might be already registered`,e)}try{this.registerView(De,e=>new at(e,this))}catch(e){o.warn(`View ${De} might be already registered`,e)}try{this.registerView(Ie,e=>new ot(e,this))}catch(e){o.warn(`View ${Ie} might be already registered`,e)}this.addSettingTab(new et(this.app,this)),this.addRibbonIcon("podcast","Podcast Player",async e=>{await this.activateSidebarView(),await this.activatePlayerView()}),this.addCommand({id:"open-podcast-player",name:"Open Podcast Player",callback:async()=>{await this.activatePlayerView()}}),this.addCommand({id:"open-podcast-sidebar",name:"Open Podcast Sidebar",callback:async()=>{await this.activateSidebarView()}}),this.addCommand({id:"subscribe-to-podcast",name:"Subscribe to Podcast",callback:()=>{new Fe(this.app,this,async e=>{o.info(`Successfully subscribed to podcast: ${e}`),await this.activateSidebarView()}).open()}}),this.addCommand({id:"open-playlist-queue",name:"Open Playlists & Queues",callback:async()=>{await this.activatePlaylistQueueView()}}),o.info("Podcast Player plugin loaded successfully")}onunload(){o.info("Unloading Podcast Player plugin"),this.feedSyncManager&&this.feedSyncManager.stopAutoSync(),this.playerController&&this.playerController.stop(),this.cleanupService&&this.cleanupService.stop(),this.app.workspace.detachLeavesOfType(Se),this.app.workspace.detachLeavesOfType(De),this.app.workspace.detachLeavesOfType(Ie)}async loadSettings(){o.methodEntry("PodcastPlayerPlugin","loadSettings");try{this.settings=await this.settingsStore.loadWithMigration(),this.pathManager.updateBasePath(this.settings.dataFolderPath),o.info("Settings loaded successfully")}catch(e){o.error("Failed to load settings, using defaults",e),this.settings={...fe}}o.methodExit("PodcastPlayerPlugin","loadSettings")}async saveSettings(){o.methodEntry("PodcastPlayerPlugin","saveSettings");try{await this.settingsStore.updateSettings(this.settings),this.pathManager.updateBasePath(this.settings.dataFolderPath),o.info("Settings saved successfully")}catch(e){o.error("Failed to save settings",e),new bt.Notice("Failed to save settings")}o.methodExit("PodcastPlayerPlugin","saveSettings")}async resetSettings(){o.methodEntry("PodcastPlayerPlugin","resetSettings");try{await this.settingsStore.resetToDefaults(),this.settings={...fe},this.pathManager.updateBasePath(this.settings.dataFolderPath),o.info("Settings reset to defaults")}catch(e){o.error("Failed to reset settings",e),new bt.Notice("Failed to reset settings")}o.methodExit("PodcastPlayerPlugin","resetSettings")}async activatePlayerView(){o.methodEntry("PodcastPlayerPlugin","activatePlayerView");let{workspace:e}=this.app,t=null,r=e.getLeavesOfType(Se);r.length>0?t=r[0]:(t=e.getRightLeaf(!1),t&&await t.setViewState({type:Se,active:!0})),t&&e.revealLeaf(t),o.methodExit("PodcastPlayerPlugin","activatePlayerView")}async activateSidebarView(){o.methodEntry("PodcastPlayerPlugin","activateSidebarView");let{workspace:e}=this.app,t=null,r=e.getLeavesOfType(De);r.length>0?t=r[0]:(t=e.getLeftLeaf(!1),t&&await t.setViewState({type:De,active:!0})),t&&e.revealLeaf(t),o.methodExit("PodcastPlayerPlugin","activateSidebarView")}getSubscriptionStore(){return this.subscriptionStore}getPodcastService(){return this.podcastService}getEpisodeManager(){return this.episodeManager}getPlaylistManager(){return this.playlistManager}getQueueManager(){return this.queueManager}getFeedSyncManager(){return this.feedSyncManager}getNoteExporter(){return this.noteExporter}async activatePlaylistQueueView(){o.methodEntry("PodcastPlayerPlugin","activatePlaylistQueueView");let{workspace:e}=this.app,t=null,r=e.getLeavesOfType(Ie);r.length>0?t=r[0]:(t=e.getRightLeaf(!1),t&&await t.setViewState({type:Ie,active:!0})),t&&e.revealLeaf(t),o.methodExit("PodcastPlayerPlugin","activatePlaylistQueueView")}};
/*! Bundled license information:

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)
*/

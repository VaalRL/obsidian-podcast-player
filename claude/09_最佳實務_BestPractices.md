# 09｜最佳實務摘要（Best Practices）

> 適用於 Obsidian Podcast Player 插件開發

## 核心原則
1. **先想再動手**：分析與計畫先行
2. **先找再做**：延伸既有，少造輪子
3. **全部要可測**：TDD 與自動化驗收
4. **結構要單純**：SSOT、早期整併
5. **工具要對**：長任務交給 Task Agent；不用被禁的指令
6. **債要早還**：技術債主動處理
7. **修正優先**：優先修正現有組件，而非創建替代組件

## Obsidian 插件特別注意
- **生命週期管理**：確保 `onload` 註冊的資源在 `onunload` 正確清理
- **非同步處理**：Obsidian API 多為非同步，確保正確處理 Promise
- **UI 元件**：繼承 `ItemView` 或使用官方 UI 套件
- **設定管理**：使用 `this.saveSettings()` 保存設定變更

## 音訊播放特別注意
- **播放器狀態**：正確管理播放、暫停、停止狀態
- **進度追蹤**：精確記錄播放位置，支援斷點續播
- **錯誤處理**：處理音訊載入失敗、網路中斷等情況
- **資源清理**：在組件卸載時正確釋放音訊資源

## Feed 解析特別注意
- **RSS/Atom 支援**：正確解析兩種格式的 Feed
- **錯誤容錯**：處理格式不正確的 Feed
- **更新檢測**：有效率地檢測 Feed 更新
- **快取策略**：合理快取 Feed 資料，減少網路請求

## Markdown 整合
- **Front Matter**：使用 YAML Front Matter 儲存 Podcast 元資料
- **雙向連結**：支援從 Obsidian 筆記連結到 Episode
- **時間戳記**：正確格式化並插入播放時間戳
- **筆記匯出**：提供快速匯出 Episode 資訊的功能

## 測試策略
- **單元測試**：核心業務邏輯（Feed 解析、播放控制）
- **整合測試**：服務層互動（PodcastService, PlayerController）
- **避免**：直接測試 Obsidian API（依賴模擬）

## 常見錯誤與避免
❌ **不要**：在 `onload` 後直接修改 DOM（等 UI 準備好）
❌ **不要**：阻塞主執行緒（使用非同步與 web worker）
❌ **不要**：硬編碼路徑（使用 Obsidian 插件資料目錄）
✅ **應該**：使用錯誤邊界捕捉並記錄
✅ **應該**：提供使用者友好的錯誤訊息
✅ **應該**：遵循單一職責原則（每個類別職責清晰）
